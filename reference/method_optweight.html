<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Stable Balancing Weights — method_optweight • WeightIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stable Balancing Weights — method_optweight"><meta name="description" content='This page explains the details of estimating stable balancing
weights (also known as optimization-based weights) by setting method = "optweight" in the call to weightit(). This method can be used with binary, multi-category, and continuous treatments.
In general, this method relies on estimating weights by solving a quadratic
programming problem subject to approximate or exact balance constraints. This
method relies on optweight::optweight.fit() from the optweight
package.
Because optweight::optweight() offers finer control and uses the same syntax as
weightit(), it is recommended that optweight() be used
instead of weightit() with method = "optweight".
Binary Treatments


For binary treatments, this method estimates the weights using
optweight::optweight.fit(). The following estimands are allowed: ATE, ATT,
and ATC. The weights are taken from the output of the optweight.fit fit object.



Multi-Category Treatments


For multi-category treatments, this method estimates the weights using
optweight::optweight.fit(). The following estimands are allowed: ATE and
ATT. The weights are taken from the output of the optweight.fit fit object.



Continuous Treatments


For continuous treatments, this method estimates the weights using
optweight::optweight.fit(). The weights are taken from the output of the
optweight.fit fit object.



Longitudinal Treatments


For longitudinal treatments, the weights are the product of the weights
estimated at each time point. This method is not guaranteed to yield exact
balance at each time point. NOTE: the use of stable balancing weights with
longitudinal treatments has not been validated and should not be done!



Sampling Weights


Sampling weights are supported through s.weights in all scenarios, but only
for versions of optweight greater than or equal to 1.0.0.



Missing Data


In the presence of missing data, the following value(s) for missing are
allowed:
"ind" (default)
First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is NA and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians (this value is arbitrary and does not affect estimation). The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting weightit object will be the original covariates with the NAs.







M-estimation


M-estimation is not supported.

'><meta property="og:description" content='This page explains the details of estimating stable balancing
weights (also known as optimization-based weights) by setting method = "optweight" in the call to weightit(). This method can be used with binary, multi-category, and continuous treatments.
In general, this method relies on estimating weights by solving a quadratic
programming problem subject to approximate or exact balance constraints. This
method relies on optweight::optweight.fit() from the optweight
package.
Because optweight::optweight() offers finer control and uses the same syntax as
weightit(), it is recommended that optweight() be used
instead of weightit() with method = "optweight".
Binary Treatments


For binary treatments, this method estimates the weights using
optweight::optweight.fit(). The following estimands are allowed: ATE, ATT,
and ATC. The weights are taken from the output of the optweight.fit fit object.



Multi-Category Treatments


For multi-category treatments, this method estimates the weights using
optweight::optweight.fit(). The following estimands are allowed: ATE and
ATT. The weights are taken from the output of the optweight.fit fit object.



Continuous Treatments


For continuous treatments, this method estimates the weights using
optweight::optweight.fit(). The weights are taken from the output of the
optweight.fit fit object.



Longitudinal Treatments


For longitudinal treatments, the weights are the product of the weights
estimated at each time point. This method is not guaranteed to yield exact
balance at each time point. NOTE: the use of stable balancing weights with
longitudinal treatments has not been validated and should not be done!



Sampling Weights


Sampling weights are supported through s.weights in all scenarios, but only
for versions of optweight greater than or equal to 1.0.0.



Missing Data


In the presence of missing data, the following value(s) for missing are
allowed:
"ind" (default)
First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is NA and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians (this value is arbitrary and does not affect estimation). The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting weightit object will be the original covariates with the NAs.







M-estimation


M-estimation is not supported.

'><meta property="og:image" content="https://ngreifer.github.io/WeightIt/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WeightIt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/WeightIt.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/estimating-effects.html">Estimating Effects After Weighting</a></li>
    <li><a class="dropdown-item" href="../articles/installing-packages.html">Installing Supporting Packages</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/WeightIt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Stable Balancing Weights</h1>
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/WeightIt/blob/master/R/weightit2optweight.R" class="external-link"><code>R/weightit2optweight.R</code></a></small>
      <div class="d-none name"><code>method_optweight.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This page explains the details of estimating stable balancing
weights (also known as optimization-based weights) by setting <code>method = "optweight"</code> in the call to <code><a href="weightit.html">weightit()</a></code>. This method can be used with binary, multi-category, and continuous treatments.</p>
<p>In general, this method relies on estimating weights by solving a quadratic
programming problem subject to approximate or exact balance constraints. This
method relies on <code><a href="https://ngreifer.github.io/optweight/reference/optweight.fit.html" class="external-link">optweight::optweight.fit()</a></code> from the <a href="https://CRAN.R-project.org/package=optweight" class="external-link"><span class="pkg">optweight</span></a>
package.</p>
<p>Because <code><a href="https://ngreifer.github.io/optweight/reference/optweight.html" class="external-link">optweight::optweight()</a></code> offers finer control and uses the same syntax as
<code><a href="weightit.html">weightit()</a></code>, it is recommended that <code>optweight()</code> be used
instead of <code><a href="weightit.html">weightit()</a></code> with <code>method = "optweight"</code>.</p><div class="section">
<h3 id="binary-treatments">Binary Treatments<a class="anchor" aria-label="anchor" href="#binary-treatments"></a></h3>


<p>For binary treatments, this method estimates the weights using
<code><a href="https://ngreifer.github.io/optweight/reference/optweight.fit.html" class="external-link">optweight::optweight.fit()</a></code>. The following estimands are allowed: ATE, ATT,
and ATC. The weights are taken from the output of the <code>optweight.fit</code> fit object.</p>
</div>

<div class="section">
<h3 id="multi-category-treatments">Multi-Category Treatments<a class="anchor" aria-label="anchor" href="#multi-category-treatments"></a></h3>


<p>For multi-category treatments, this method estimates the weights using
<code><a href="https://ngreifer.github.io/optweight/reference/optweight.fit.html" class="external-link">optweight::optweight.fit()</a></code>. The following estimands are allowed: ATE and
ATT. The weights are taken from the output of the <code>optweight.fit</code> fit object.</p>
</div>

<div class="section">
<h3 id="continuous-treatments">Continuous Treatments<a class="anchor" aria-label="anchor" href="#continuous-treatments"></a></h3>


<p>For continuous treatments, this method estimates the weights using
<code><a href="https://ngreifer.github.io/optweight/reference/optweight.fit.html" class="external-link">optweight::optweight.fit()</a></code>. The weights are taken from the output of the
<code>optweight.fit</code> fit object.</p>
</div>

<div class="section">
<h3 id="longitudinal-treatments">Longitudinal Treatments<a class="anchor" aria-label="anchor" href="#longitudinal-treatments"></a></h3>


<p>For longitudinal treatments, the weights are the product of the weights
estimated at each time point. This method is not guaranteed to yield exact
balance at each time point. <strong>NOTE: the use of stable balancing weights with
longitudinal treatments has not been validated and should not be done!</strong></p>
</div>

<div class="section">
<h3 id="sampling-weights">Sampling Weights<a class="anchor" aria-label="anchor" href="#sampling-weights"></a></h3>


<p>Sampling weights are supported through <code>s.weights</code> in all scenarios, but only
for versions of <span class="pkg">optweight</span> greater than or equal to 1.0.0.</p>
</div>

<div class="section">
<h3 id="missing-data">Missing Data<a class="anchor" aria-label="anchor" href="#missing-data"></a></h3>


<p>In the presence of missing data, the following value(s) for <code>missing</code> are
allowed:</p><dl><dt><code>"ind"</code> (default)</dt>
<dd><p>First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is <code>NA</code> and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians (this value is arbitrary and does not affect estimation). The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting <code>weightit</code> object will be the original covariates with the <code>NA</code>s.</p></dd>


</dl></div>

<div class="section">
<h3 id="m-estimation">M-estimation<a class="anchor" aria-label="anchor" href="#m-estimation"></a></h3>


<p>M-estimation is not supported.</p>
</div>

    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Stable balancing weights are weights that solve a constrained
optimization problem, where the constraints correspond to covariate balance
and the loss function is the variance (or other norm) of the weights. These
weights maximize the effective sample size of the weighted sample subject to
user-supplied balance constraints. An advantage of this method over entropy
balancing is the ability to allow approximate, rather than exact, balance
through the <code>tols</code> argument, which can increase precision even for slight
relaxations of the constraints.</p>
<p>The function of the weights that is optimized can be changed using the <code>norm</code> argument. The default <code>norm = "l2"</code>, minimizes the variance of the weights (i.e., maximizes the ESS). <code>norm = "entropy"</code> minimizes the negative entropy of the weights and is equivalent to entropy balancing, though in this implementation, inexact balance is allowed. <code>norm = "log"</code> minimizes the sum of the negative logs of the weights and is equivalent to nonparametric covariate balancing propensity score weighting (npCBPS). See <code><a href="https://ngreifer.github.io/optweight/reference/optweight.fit.html" class="external-link">optweight::optweight.fit()</a></code> for the other allowed options to <code>norm</code> and other arguments.</p>
<p><code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> can be used on the output of <code><a href="weightit.html">weightit()</a></code> with <code>method = "optweight"</code>
to display the dual variables; see Examples and <code><a href="plot.weightit.html">plot.weightit()</a></code> for more
details.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The specification of <code>tols</code> differs between <code><a href="weightit.html">weightit()</a></code> and
<code>optweight()</code>. In <code><a href="weightit.html">weightit()</a></code>, one tolerance value should be included per
level of each factor variable, whereas in <code>optweight()</code>, all levels of a
factor are given the same tolerance, and only one value needs to be supplied
for a factor variable. Because of the potential for confusion and ambiguity,
it is recommended to only supply one value for <code>tols</code> in <code><a href="weightit.html">weightit()</a></code> that
applies to all variables. For finer control, use <code>optweight()</code> directly.</p>
<p>Seriously, just use <code><a href="https://ngreifer.github.io/optweight/reference/optweight.html" class="external-link">optweight::optweight()</a></code>. The syntax is almost
identical and it's compatible with <span class="pkg">cobalt</span>, too.</p>
    </div>
    <div class="section level2">
    <h2 id="additional-arguments">Additional Arguments<a class="anchor" aria-label="anchor" href="#additional-arguments"></a></h2>



<dl><dt><code>moments</code></dt>
<dd><p><code>integer</code>; the highest power of each covariate to be balanced. For example, if <code>moments = 3</code>, each covariate, its square, and its cube will be balanced. Can also be a named vector with a value for each covariate (e.g., <code>moments = c(x1 = 2, x2 = 4)</code>). Values greater than 1 for categorical covariates are ignored. Default is 1 to balance covariate means.</p></dd>

<dt><code>int</code></dt>
<dd><p><code>logical</code>; whether first-order interactions of the covariates are to be balanced. Default is <code>FALSE</code>.</p></dd>

<dt><code>quantile</code></dt>
<dd><p>a named list of quantiles (values between 0 and 1) for each continuous covariate, which are used to create additional variables that when balanced ensure balance on the corresponding quantile of the variable. For example, setting <code>quantile = list(x1 = c(.25, .5. , .75))</code> ensures the 25th, 50th, and 75th percentiles of <code>x1</code> in each treatment group will be balanced in the weighted sample. Can also be a single number (e.g., <code>.5</code>) or a vector (e.g., <code>c(.25, .5, .75)</code>) to request the same quantile(s) for all continuous covariates. Only allowed with binary and multi-category treatments.</p></dd>


</dl><p>All arguments to <code>optweight.fit()</code> can be passed through <code><a href="weightit.html">weightit()</a></code> or <code><a href="weightitMSM.html">weightitMSM()</a></code>, with the following exception:</p><ul><li><p><code>targets</code> cannot be used and is ignored.</p></li>
</ul><p>All arguments take on the defaults of those in <code>optweight.fit()</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="additional-outputs">Additional Outputs<a class="anchor" aria-label="anchor" href="#additional-outputs"></a></h2>


<dl><dt><code>info</code></dt>
<dd><p>A list with one entry:</p><dl><dt><code>duals</code></dt>
<dd><p>A data frame of dual variables for each balance constraint.</p></dd>


</dl></dd>

<dt><code>obj</code></dt>
<dd><p>When <code>include.obj = TRUE</code>, the output of the call to <code><a href="https://ngreifer.github.io/optweight/reference/optweight.fit.html" class="external-link">optweight::optweight.fit()</a></code>.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<div class="section">
<h3 id="binary-treatments-1">Binary treatments<a class="anchor" aria-label="anchor" href="#binary-treatments-1"></a></h3>


<p>Wang, Y., &amp; Zubizarreta, J. R. (2020). Minimal dispersion approximately
balancing weights: Asymptotic properties and practical considerations.
<em>Biometrika</em>, 107(1), 93–105. <a href="https://doi.org/10.1093/biomet/asz050" class="external-link">doi:10.1093/biomet/asz050</a></p>
<p>Zubizarreta, J. R. (2015). Stable Weights that Balance Covariates for
Estimation With Incomplete Outcome Data. <em>Journal of the American Statistical Association</em>, 110(511), 910–922. <a href="https://doi.org/10.1080/01621459.2015.1023805" class="external-link">doi:10.1080/01621459.2015.1023805</a></p>
</div>

<div class="section">
<h3 id="multi-category-treatments-1">Multi-Category Treatments<a class="anchor" aria-label="anchor" href="#multi-category-treatments-1"></a></h3>


<p>de los Angeles Resa, M., &amp; Zubizarreta, J. R. (2020). Direct and Stable Weight Adjustment in Non-Experimental Studies With Multivalued Treatments: Analysis of the Effect of an Earthquake on Post-Traumatic Stress. <em>Journal of the Royal Statistical Society Series A: Statistics in Society</em>, 183(4), 1387–1410. <a href="https://doi.org/10.1111/rssa.12561" class="external-link">doi:10.1111/rssa.12561</a></p>
</div>

<div class="section">
<h3 id="continuous-treatments-1">Continuous treatments<a class="anchor" aria-label="anchor" href="#continuous-treatments-1"></a></h3>


<p>Greifer, N. (2020). <em>Estimating Balancing Weights for Continuous Treatments Using Constrained Optimization</em>. <a href="https://doi.org/10.17615/DYSS-B342" class="external-link">doi:10.17615/DYSS-B342</a></p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="weightit.html">weightit()</a></code>, <code><a href="weightitMSM.html">weightitMSM()</a></code></p>
<p><code><a href="https://ngreifer.github.io/optweight/reference/optweight.fit.html" class="external-link">optweight::optweight.fit()</a></code> for the fitting function</p>
<p><code><a href="method_ebal.html">method_entropy</a></code> for entropy balancing, which is a special case of stable balancing weights.</p>
<p><code><a href="method_npcbps.html">method_npcbps</a></code> for npCBPS weighting, which is also a special case of stable balancing weights.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates between treatment groups (binary)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"optweight"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span></span>
<span class="r-in"><span>                tols <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "optweight" (stable balancing weights)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Min                                 Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated   1           ||                  1.   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control   0 |---------------------------| 3.043</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              1     2     3    4     5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated     1     1     1    1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            404   226   224  111    84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 2.526 2.542 2.643 2.74 3.043</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated       0.000 0.000   0.000       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control       0.788 0.697   0.393      83</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    264.88     185</span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.       -0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.       -0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary       -0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary       -0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.       -0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted    264.88     185</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="method_optweight-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates with respect to race (multi-category)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">race</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"optweight"</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span>,</span></span>
<span class="r-in"><span>                tols <span class="op">=</span> <span class="fl">.01</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "optweight" (stable balancing weights)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 3-category (black, hispan, white)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Min                                 Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> black  0.443     |-----------------------| 3.574</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hispan 0.    |-------------------|         2.585</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> white  0.257   |---------|                 1.659</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           203   157   155   153   152</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   black 2.335 2.372 2.559 2.837 3.574</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            67    43    39    36    28</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  hispan 2.046 2.098 2.189 2.198 2.585</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           258   285   172   117     6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   white 1.571 1.571 1.573 1.597 1.659</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> black        0.550 0.443   0.130       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hispan       0.566 0.449   0.176       2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> white        0.353 0.295   0.065       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             black hispan  white</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted 243.     72.  299.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted   186.76   54.7 266.01</span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance summary across all treatment pairs</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Max.Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.         0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.         0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary         0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary         0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.         0.01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             black hispan  white</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 243.     72.  299.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   186.76   54.7 266.01</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="method_optweight-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates with respect to re75 (continuous)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W3</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">re75</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"optweight"</span>, tols <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W3</span><span class="op">)</span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

