<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Subgroup Balancing Propensity Score — sbps • WeightIt</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Subgroup Balancing Propensity Score — sbps" />
<meta property="og:description" content="Implements the subgroup balancing propensity score (SBPS), which is an algorithm that attempts to achieve balance in subgroups by sharing information from the overall sample and subgroups. (Dong, Zhang, Zeng, &amp;amp; Li, 2020; DZZL). Each subgroup can use either weights estimated using the whole sample, weights estimated using just that subgroup, or a combination of the two. The optimal combination is chosen as that which minimizes an imbalance criterion that includes subgroup as well as overall balance." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WeightIt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.12.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/WeightIt.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ngreifer/WeightIt/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Subgroup Balancing Propensity Score</h1>
    
    <div class="hidden name"><code>sbps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Implements the subgroup balancing propensity score (SBPS), which is an algorithm that attempts to achieve balance in subgroups by sharing information from the overall sample and subgroups. (Dong, Zhang, Zeng, &amp; Li, 2020; DZZL). Each subgroup can use either weights estimated using the whole sample, weights estimated using just that subgroup, or a combination of the two. The optimal combination is chosen as that which minimizes an imbalance criterion that includes subgroup as well as overall balance.</p>
    </div>

    <pre class="usage"><span class='fu'>sbps</span><span class='op'>(</span><span class='va'>obj</span>, obj2 <span class='op'>=</span> <span class='cn'>NULL</span>,
     moderator <span class='op'>=</span> <span class='cn'>NULL</span>,
     formula <span class='op'>=</span> <span class='cn'>NULL</span>,
     data <span class='op'>=</span> <span class='cn'>NULL</span>,
     smooth <span class='op'>=</span> <span class='cn'>FALSE</span>,
     <span class='va'>full.search</span><span class='op'>)</span>

<span class='co'># S3 method for weightit.sbps</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for weightit.sbps</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>object</span>, top <span class='op'>=</span> <span class='fl'>5</span>,
        ignore.s.weights <span class='op'>=</span> <span class='cn'>FALSE</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for summary.weightit.sbps</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>obj</th>
      <td><p>a <code>weightit</code> object containing weights estimated in the overall sample.</p></td>
    </tr>
    <tr>
      <th>obj2</th>
      <td><p>a <code>weightit</code> object containing weights estimated in the subgroups. Typically this has been estimated by including <code>by</code> in the call to <code><a href='weightit.html'>weightit()</a></code>. Either <code>obj2</code> or <code>moderator</code> must be specified.</p></td>
    </tr>
    <tr>
      <th>moderator</th>
      <td><p>optional; a string containing the name of the variable in <code>data</code> for which weighting is to be done within subgroups or a one-sided formula with the subgrouping variable on the right-hand side. This argument is analogous to the <code>by</code> argument in <code><a href='weightit.html'>weightit()</a></code>, and in fact it is passed on to <code>by</code>. Either <code>obj2</code> or <code>moderator</code> must be specified.</p></td>
    </tr>
    <tr>
      <th>formula</th>
      <td><p>an optional formula with the covariates for which balance is to be optimized. If not specified, the formula in <code>obj$call</code> will be used.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>an optional data set in the form of a data frame that contains the variables in <code>formula</code> or <code>moderator</code>.</p></td>
    </tr>
    <tr>
      <th>smooth</th>
      <td><p><code>logical</code>; whether the smooth version of the SBPS should be used. This is only compatible with <code>weightit</code> methods that return a propensity score.</p></td>
    </tr>
    <tr>
      <th>full.search</th>
      <td><p><code>logical</code>; when <code>smooth = FALSE</code>, whether every combination of subgroup and overall weights should be evaluated. If <code>FALSE</code>, a stochastic search as described in DZZL will be used instead. If <code>TRUE</code>, all 2^R combinations will be checked, where R is the number of subgroups, which can take a long time with many subgroups. If unspecified, will default to <code>TRUE</code> if R &lt;= 8 and <code>FALSE</code> otherwise.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>a <code>weightit.sbps</code> or <code>summary.weightit.sbps</code> object; the output of a call to <code>sbps()</code> or <code>summary.weightit.sbps()</code>.</p></td>
    </tr>
    <tr>
      <th>object</th>
      <td><p>a <code>weightit.sbps</code> object; the output of a call to <code>sbps()</code>.</p></td>
    </tr>
    <tr>
      <th>top</th>
      <td><p>how many of the largest and smallest weights to display. Default is 5.</p></td>
    </tr>
    <tr>
      <th>ignore.s.weights</th>
      <td><p>whether or not to ignore sampling weights when computing the weight summary. If <code>FALSE</code>, the default, the estimated weights will be multiplied by the sampling weights (if any) before values are computed.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>for <code>print</code>, arguments passed to <code><a href='https://rdrr.io/r/base/print.html'>print()</a></code>. Ignored otherwise.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The SBPS relies on two sets of weights: one estimated in the overall sample and one estimated within each subgroup. The algorithm decides whether each subgroup should use the weights estimated in the overall sample or those estimated in the subgroup. There are 2^R permutations of overall and subgroup weights, where R is the number of subgroups. The optimal permutation is chosen as that which minimizes a balance criterion as described in DZZL. The balance criterion used here is, for binary and multinomial treatments, the sum of the squared standardized mean differences within subgroups and overall, which are computed using <code><a href='https://ngreifer.github.io/cobalt/reference/balance.summary.html'>col_w_smd()</a></code> in <span class="pkg">cobalt</span>, and for continuous treatments, the sum of the squared correlations between each covariate and treatment within subgroups and overall, which are computed using <code><a href='https://ngreifer.github.io/cobalt/reference/balance.summary.html'>col_w_corr()</a></code> in <span class="pkg">cobalt</span>.</p>
<p>The smooth version estimates weights that determine the relative contribution of the overall and subgroup propensity scores to a weighted average propensity score for each subgroup. If P_O are the propensity scores estimated in the overall sample and P_S are the propensity scores estimated in each subgroup, the smooth SBPS finds R coefficients C so that for each subgroup, the ultimate propensity score is \(C*P_S + (1-C)*P_O\), and weights are computed from this propensity score. The coefficients are estimated using <code><a href='https://rdrr.io/r/stats/optim.html'>optim()</a></code> with <code>method = "L-BFGS-B"</code>. When C is estimated to be 1 or 0 for each subgroup, the smooth SBPS coincides with the standard SBPS.</p>
<p>If <code>obj2</code> is not specified and <code>moderator</code> is, <code>sbps()</code> will attempt to refit the model specified in <code>obj</code> with the <code>moderator</code> in the <code>by</code> argument. This relies on the environment in which <code>obj</code> was created to be intact and can take some time if <code>obj</code> was hard to fit. It's safer to estimate <code>obj</code> and <code>obj2</code> (the latter simply by including the moderator in the <code>by</code> argument) and supply these to <code>sbps()</code>.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code>weightit.sbps</code> object, which inherits from <code>weightit</code>. This contains all the information in <code>obj</code> with the weights, propensity scores, call, and possibly covariates updated from <code>sbps()</code>. In addition, the <code>prop.subgroup</code> component contains the values of the coefficients C for the subgroups (which are either 0 or 1 for the standard SBPS), and the <code>moderator</code> component contains a data.frame with the moderator.</p>
<p>This object has its own summary methods and is compatible with <span class="pkg">cobalt</span> functions. The <code>cluster</code> argument should be used with <span class="pkg">cobalt</span> functions to accurately reflect the performance of the weights in balancing the subgroups.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Dong, J., Zhang, J. L., Zeng, S., &amp; Li, F. (2020). Subgroup balancing propensity score. Statistical Methods in Medical Research, 29(3), 659–676. doi: <a href='https://doi.org/10.1177/0962280219870836'>10.1177/0962280219870836</a></p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Noah Greifer</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='weightit.html'>weightit()</a></code>, <code><a href='summary.weightit.html'>summary.weightit()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://ngreifer.github.io/cobalt/'>"cobalt"</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"lalonde"</span>, package <span class='op'>=</span> <span class='st'>"cobalt"</span><span class='op'>)</span>

<span class='co'>#Balancing covariates between treatment groups within races</span>
<span class='op'>(</span><span class='va'>W1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='weightit.html'>weightit</a></span><span class='op'>(</span><span class='va'>treat</span> <span class='op'>~</span> <span class='va'>age</span> <span class='op'>+</span> <span class='va'>educ</span> <span class='op'>+</span> <span class='va'>married</span> <span class='op'>+</span>
                <span class='va'>nodegree</span> <span class='op'>+</span> <span class='va'>race</span> <span class='op'>+</span> <span class='va'>re74</span>, data <span class='op'>=</span> <span class='va'>lalonde</span>,
                method <span class='op'>=</span> <span class='st'>"ps"</span>, estimand <span class='op'>=</span> <span class='st'>"ATT"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; A <span style='font-style: italic;'>weightit</span><span> object
#&gt;  - method: "ps" (propensity score weighting)
#&gt;  - number of obs.: 614
#&gt;  - sampling weights: none
#&gt;  - treatment: 2-category
#&gt;  - estimand: ATT (focal: 1)
#&gt;  - covariates: age, educ, married, nodegree, race, re74</div><div class='input'>
<span class='op'>(</span><span class='va'>W2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='weightit.html'>weightit</a></span><span class='op'>(</span><span class='va'>treat</span> <span class='op'>~</span> <span class='va'>age</span> <span class='op'>+</span> <span class='va'>educ</span> <span class='op'>+</span> <span class='va'>married</span> <span class='op'>+</span>
                <span class='va'>nodegree</span> <span class='op'>+</span> <span class='va'>race</span> <span class='op'>+</span> <span class='va'>re74</span>, data <span class='op'>=</span> <span class='va'>lalonde</span>,
                method <span class='op'>=</span> <span class='st'>"ps"</span>, estimand <span class='op'>=</span> <span class='st'>"ATT"</span>,
                by <span class='op'>=</span> <span class='st'>"race"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; A </span><span style='font-style: italic;'>weightit</span><span> object
#&gt;  - method: "ps" (propensity score weighting)
#&gt;  - number of obs.: 614
#&gt;  - sampling weights: none
#&gt;  - treatment: 2-category
#&gt;  - estimand: ATT (focal: 1)
#&gt;  - covariates: age, educ, married, nodegree, race, re74
#&gt;  - by: race</div><div class='input'><span class='va'>S</span> <span class='op'>&lt;-</span> <span class='fu'>sbps</span><span class='op'>(</span><span class='va'>W1</span>, <span class='va'>W2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>S</span><span class='op'>)</span>
</div><div class='output co'>#&gt; A weightit.sbps object
#&gt;  - method: "ps" (propensity score weighting)
#&gt;  - number of obs.: 614
#&gt;  - sampling weights: none
#&gt;  - treatment: 2-category
#&gt;  - estimand: ATT (focal: 1)
#&gt;  - covariates: age, educ, married, nodegree, race, re74
#&gt;  - moderator: race (3 subgroups)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>S</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Summary of weights:
#&gt; 
#&gt;  - Overall vs. subgroup proportion contribution:
#&gt;          race = black race = hispan race = white
#&gt; Overall             0             0            0
#&gt; Subgroup            1             1            1
#&gt; 
#&gt;  - - - - - - - Subgroup race = black - - - - - - -
#&gt; - Weight ranges:
#&gt;           Min                                  Max
#&gt; treated 1.000      ||                       1.0000
#&gt; control 0.466 |---------------------------| 3.5903
#&gt; 
#&gt; - Units with 5 greatest weights by group:
#&gt;                                           
#&gt;               1      2     4      5      6
#&gt;  treated      1      1     1      1      1
#&gt;             221    228   188    185    174
#&gt;  control 2.9494 2.9494 3.006 3.0637 3.5903
#&gt; 
#&gt;          Ratio Coef of Var
#&gt; treated 1.0000      0.0000
#&gt; control 7.7042      0.4250
#&gt; overall 7.7042      0.4616
#&gt; 
#&gt; - Effective Sample Sizes:
#&gt;            Control Treated
#&gt; Unweighted  87.000     156
#&gt; Weighted    73.818     156
#&gt; 
#&gt;  - - - - - - - Subgroup race = hispan - - - - - - -
#&gt; - Weight ranges:
#&gt;            Min                                    Max
#&gt; treated 1.0000                              || 1.0000
#&gt; control 0.0209   |------------|                0.5046
#&gt; 
#&gt; - Units with 5 greatest weights by group:
#&gt;                                            
#&gt;               1      2      3      4      5
#&gt;  treated      1      1      1      1      1
#&gt;              56     54     49     48     47
#&gt;  control 0.4117 0.4767 0.4835 0.4968 0.5046
#&gt; 
#&gt;           Ratio Coef of Var
#&gt; treated  1.0000      0.0000
#&gt; control 24.1741      0.7143
#&gt; overall 47.9120      1.0352
#&gt; 
#&gt; - Effective Sample Sizes:
#&gt;            Control Treated
#&gt; Unweighted  61.000      11
#&gt; Weighted    40.616      11
#&gt; 
#&gt;  - - - - - - - Subgroup race = white - - - - - - -
#&gt; - Weight ranges:
#&gt;            Min                                   Max
#&gt; treated 1.0000                              || 1.000
#&gt; control 0.0002   |---------|                   0.385
#&gt; 
#&gt; - Units with 5 greatest weights by group:
#&gt;                                           
#&gt;               1      3      4      5     6
#&gt;  treated      1      1      1      1     1
#&gt;             289    287    285    280   267
#&gt;  control 0.2393 0.2699 0.2937 0.2956 0.385
#&gt; 
#&gt;            Ratio Coef of Var
#&gt; treated    1.000      0.0000
#&gt; control 1825.569      1.1538
#&gt; overall 4742.159      1.9499
#&gt; 
#&gt; - Effective Sample Sizes:
#&gt;            Control Treated
#&gt; Unweighted 281.000      18
#&gt; Weighted   120.777      18</div><div class='input'><span class='fu'><a href='https://ngreifer.github.io/cobalt/reference/bal.tab.html'>bal.tab</a></span><span class='op'>(</span><span class='va'>S</span>, cluster <span class='op'>=</span> <span class='st'>"race"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='text-decoration: underline;'>Call</span><span>
#&gt;  sbps(obj = W1, obj2 = W2)
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Balance by cluster</span><span>
#&gt; 
#&gt;  - - - </span><span style='font-style: italic;'>Cluster: black</span><span> - - - 
#&gt; </span><span style='text-decoration: underline;'>Balance Measures</span><span>
#&gt;                Type Diff.Adj
#&gt; prop.score Distance   0.0016
#&gt; age         Contin.   0.0126
#&gt; educ        Contin.  -0.0332
#&gt; married      Binary   0.0030
#&gt; nodegree     Binary   0.0062
#&gt; re74        Contin.  -0.0826
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Effective sample sizes</span><span>
#&gt;            Control Treated
#&gt; Unadjusted   87.       156
#&gt; Adjusted     73.82     156
#&gt; 
#&gt;  - - - </span><span style='font-style: italic;'>Cluster: hispan</span><span> - - - 
#&gt; </span><span style='text-decoration: underline;'>Balance Measures</span><span>
#&gt;                Type Diff.Adj
#&gt; prop.score Distance  -0.2678
#&gt; age         Contin.   0.1196
#&gt; educ        Contin.  -0.0756
#&gt; married      Binary   0.0217
#&gt; nodegree     Binary   0.0018
#&gt; re74        Contin.   0.0114
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Effective sample sizes</span><span>
#&gt;            Control Treated
#&gt; Unadjusted   61.        11
#&gt; Adjusted     40.62      11
#&gt; 
#&gt;  - - - </span><span style='font-style: italic;'>Cluster: white</span><span> - - - 
#&gt; </span><span style='text-decoration: underline;'>Balance Measures</span><span>
#&gt;                Type Diff.Adj
#&gt; prop.score Distance   0.0652
#&gt; age         Contin.   0.0191
#&gt; educ        Contin.  -0.0185
#&gt; married      Binary  -0.0015
#&gt; nodegree     Binary   0.0039
#&gt; re74        Contin.  -0.0117
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Effective sample sizes</span><span>
#&gt;            Control Treated
#&gt; Unadjusted  281.        18
#&gt; Adjusted    120.78      18
#&gt;  - - - - - - - - - - - - - - 
#&gt; </div><div class='input'>
<span class='co'>#Could also have run</span>
<span class='co'>#  sbps(W1, moderator = "race")</span>

<span class='va'>S_</span> <span class='op'>&lt;-</span> <span class='fu'>sbps</span><span class='op'>(</span><span class='va'>W1</span>, <span class='va'>W2</span>, smooth <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>S_</span><span class='op'>)</span>
</div><div class='output co'>#&gt; A weightit.sbps object
#&gt;  - method: "ps" (propensity score weighting)
#&gt;  - number of obs.: 614
#&gt;  - sampling weights: none
#&gt;  - treatment: 2-category
#&gt;  - estimand: ATT (focal: 1)
#&gt;  - covariates: age, educ, married, nodegree, race, re74
#&gt;  - moderator: race (3 subgroups)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>S_</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Summary of weights:
#&gt; 
#&gt;  - Overall vs. subgroup proportion contribution:
#&gt;          race = black race = hispan race = white
#&gt; Overall          0.17          0.25            0
#&gt; Subgroup         0.83          0.75            1
#&gt; 
#&gt;  - - - - - - - Subgroup race = black - - - - - - -
#&gt; - Weight ranges:
#&gt;            Min                                  Max
#&gt; treated 1.0000      ||                       1.0000
#&gt; control 0.4654 |---------------------------| 3.5703
#&gt; 
#&gt; - Units with 5 greatest weights by group:
#&gt;                                            
#&gt;               2      4      5      6      7
#&gt;  treated      1      1      1      1      1
#&gt;             221    228    188    185    174
#&gt;  control 2.9787 2.9787 3.0338 3.0899 3.5703
#&gt; 
#&gt;          Ratio Coef of Var
#&gt; treated 1.0000      0.0000
#&gt; control 7.6708      0.4264
#&gt; overall 7.6708      0.4625
#&gt; 
#&gt; - Effective Sample Sizes:
#&gt;            Control Treated
#&gt; Unweighted  87.000     156
#&gt; Weighted    73.744     156
#&gt; 
#&gt;  - - - - - - - Subgroup race = hispan - - - - - - -
#&gt; - Weight ranges:
#&gt;            Min                                    Max
#&gt; treated 1.0000                              || 1.0000
#&gt; control 0.0254   |-----------|                 0.4743
#&gt; 
#&gt; - Units with 5 greatest weights by group:
#&gt;                                            
#&gt;               1      2      4      5      7
#&gt;  treated      1      1      1      1      1
#&gt;              56     54     48     47     28
#&gt;  control 0.3908 0.4496 0.4557 0.4704 0.4743
#&gt; 
#&gt;           Ratio Coef of Var
#&gt; treated  1.0000      0.0000
#&gt; control 18.6516      0.6795
#&gt; overall 39.3245      1.0314
#&gt; 
#&gt; - Effective Sample Sizes:
#&gt;            Control Treated
#&gt; Unweighted   61.00      11
#&gt; Weighted     41.95      11
#&gt; 
#&gt;  - - - - - - - Subgroup race = white - - - - - - -
#&gt; - Weight ranges:
#&gt;            Min                                   Max
#&gt; treated 1.0000                              || 1.000
#&gt; control 0.0002   |---------|                   0.385
#&gt; 
#&gt; - Units with 5 greatest weights by group:
#&gt;                                           
#&gt;               1      3      4      5     6
#&gt;  treated      1      1      1      1     1
#&gt;             289    287    285    280   267
#&gt;  control 0.2393 0.2699 0.2937 0.2956 0.385
#&gt; 
#&gt;            Ratio Coef of Var
#&gt; treated    1.000      0.0000
#&gt; control 1825.569      1.1538
#&gt; overall 4742.159      1.9499
#&gt; 
#&gt; - Effective Sample Sizes:
#&gt;            Control Treated
#&gt; Unweighted 281.000      18
#&gt; Weighted   120.777      18</div><div class='input'><span class='fu'><a href='https://ngreifer.github.io/cobalt/reference/bal.tab.html'>bal.tab</a></span><span class='op'>(</span><span class='va'>S_</span>, cluster <span class='op'>=</span> <span class='st'>"race"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='text-decoration: underline;'>Call</span><span>
#&gt;  sbps(obj = W1, obj2 = W2, smooth = TRUE)
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Balance by cluster</span><span>
#&gt; 
#&gt;  - - - </span><span style='font-style: italic;'>Cluster: black</span><span> - - - 
#&gt; </span><span style='text-decoration: underline;'>Balance Measures</span><span>
#&gt;                Type Diff.Adj
#&gt; prop.score Distance   0.0019
#&gt; age         Contin.   0.0388
#&gt; educ        Contin.  -0.0305
#&gt; married      Binary   0.0096
#&gt; nodegree     Binary   0.0086
#&gt; re74        Contin.  -0.0561
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Effective sample sizes</span><span>
#&gt;            Control Treated
#&gt; Unadjusted   87.       156
#&gt; Adjusted     73.74     156
#&gt; 
#&gt;  - - - </span><span style='font-style: italic;'>Cluster: hispan</span><span> - - - 
#&gt; </span><span style='text-decoration: underline;'>Balance Measures</span><span>
#&gt;                Type Diff.Adj
#&gt; prop.score Distance  -0.1909
#&gt; age         Contin.   0.0167
#&gt; educ        Contin.  -0.0654
#&gt; married      Binary   0.0314
#&gt; nodegree     Binary   0.0084
#&gt; re74        Contin.  -0.0175
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Effective sample sizes</span><span>
#&gt;            Control Treated
#&gt; Unadjusted   61.        11
#&gt; Adjusted     41.95      11
#&gt; 
#&gt;  - - - </span><span style='font-style: italic;'>Cluster: white</span><span> - - - 
#&gt; </span><span style='text-decoration: underline;'>Balance Measures</span><span>
#&gt;                Type Diff.Adj
#&gt; prop.score Distance   0.0652
#&gt; age         Contin.   0.0191
#&gt; educ        Contin.  -0.0185
#&gt; married      Binary  -0.0015
#&gt; nodegree     Binary   0.0039
#&gt; re74        Contin.  -0.0117
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Effective sample sizes</span><span>
#&gt;            Control Treated
#&gt; Unadjusted  281.        18
#&gt; Adjusted    120.78      18
#&gt;  - - - - - - - - - - - - - - 
#&gt; </div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


