<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Subgroup Balancing Propensity Score — sbps • WeightIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Subgroup Balancing Propensity Score — sbps"><meta name="description" content="Implements the subgroup balancing propensity score (SBPS), which
is an algorithm that attempts to achieve balance in subgroups by sharing
information from the overall sample and subgroups (Dong, Zhang, Zeng, &amp;amp; Li,
2020; DZZL). Each subgroup can use either weights estimated using the whole
sample, weights estimated using just that subgroup, or a combination of the
two. The optimal combination is chosen as that which minimizes an imbalance
criterion that includes subgroup as well as overall balance."><meta property="og:description" content="Implements the subgroup balancing propensity score (SBPS), which
is an algorithm that attempts to achieve balance in subgroups by sharing
information from the overall sample and subgroups (Dong, Zhang, Zeng, &amp;amp; Li,
2020; DZZL). Each subgroup can use either weights estimated using the whole
sample, weights estimated using just that subgroup, or a combination of the
two. The optimal combination is chosen as that which minimizes an imbalance
criterion that includes subgroup as well as overall balance."><meta property="og:image" content="https://ngreifer.github.io/WeightIt/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WeightIt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/WeightIt.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/estimating-effects.html">Estimating Effects After Weighting</a></li>
    <li><a class="dropdown-item" href="../articles/installing-packages.html">Installing Supporting Packages</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/WeightIt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Subgroup Balancing Propensity Score</h1>
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/WeightIt/blob/master/R/sbps.R" class="external-link"><code>R/sbps.R</code></a></small>
      <div class="d-none name"><code>sbps.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Implements the subgroup balancing propensity score (SBPS), which
is an algorithm that attempts to achieve balance in subgroups by sharing
information from the overall sample and subgroups (Dong, Zhang, Zeng, &amp; Li,
2020; DZZL). Each subgroup can use either weights estimated using the whole
sample, weights estimated using just that subgroup, or a combination of the
two. The optimal combination is chosen as that which minimizes an imbalance
criterion that includes subgroup as well as overall balance.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sbps</span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  obj2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  moderator <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  smooth <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">full.search</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-obj">obj<a class="anchor" aria-label="anchor" href="#arg-obj"></a></dt>
<dd><p>a <code>weightit</code> object containing weights estimated in the overall
sample.</p></dd>


<dt id="arg-obj-">obj2<a class="anchor" aria-label="anchor" href="#arg-obj-"></a></dt>
<dd><p>a <code>weightit</code> object containing weights estimated in the
subgroups. Typically this has been estimated by including <code>by</code> in the call
to <code><a href="weightit.html">weightit()</a></code>. Either <code>obj2</code> or <code>moderator</code> must be specified.</p></dd>


<dt id="arg-moderator">moderator<a class="anchor" aria-label="anchor" href="#arg-moderator"></a></dt>
<dd><p>optional; a string containing the name of the variable in
<code>data</code> for which weighting is to be done within subgroups or a one-sided
formula with the subgrouping variable on the right-hand side. This argument
is analogous to the <code>by</code> argument in <code><a href="weightit.html">weightit()</a></code>, and in fact it is passed
on to <code>by</code>. Either <code>obj2</code> or <code>moderator</code> must be specified.</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>an optional formula with the covariates for which balance is
to be optimized. If not specified, the formula in <code>obj$call</code> will be used.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>an optional data set in the form of a data frame that contains
the variables in <code>formula</code> or <code>moderator</code>.</p></dd>


<dt id="arg-smooth">smooth<a class="anchor" aria-label="anchor" href="#arg-smooth"></a></dt>
<dd><p><code>logical</code>; whether the smooth version of the SBPS should be
used. This is only compatible with <code>weightit</code> methods that return a
propensity score.</p></dd>


<dt id="arg-full-search">full.search<a class="anchor" aria-label="anchor" href="#arg-full-search"></a></dt>
<dd><p><code>logical</code>; when <code>smooth = FALSE</code>, whether every
combination of subgroup and overall weights should be evaluated. If
<code>FALSE</code>, a stochastic search as described in DZZL will be used instead. If
<code>TRUE</code>, all \(2^R\) combinations will be checked, where \(R\) is the
number of subgroups, which can take a long time with many subgroups. If
unspecified, will default to <code>TRUE</code> if \(R &lt;= 8\) and <code>FALSE</code> otherwise.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>weightit.sbps</code> object, which inherits from <code>weightit</code>. This
contains all the information in <code>obj</code> with the weights, propensity scores,
call, and possibly covariates updated from <code>sbps()</code>. In addition, the
<code>prop.subgroup</code> component contains the values of the coefficients C for the
subgroups (which are either 0 or 1 for the standard SBPS), and the
<code>moderator</code> component contains a data.frame with the moderator.</p>
<p>This object has its own summary method and is compatible with <span class="pkg">cobalt</span>
functions. The <code>cluster</code> argument should be used with <span class="pkg">cobalt</span> functions
to accurately reflect the performance of the weights in balancing the
subgroups.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The SBPS relies on two sets of weights: one estimated in the overall
sample and one estimated within each subgroup. The algorithm decides whether
each subgroup should use the weights estimated in the overall sample or those
estimated in the subgroup. There are 2^R permutations of overall and subgroup
weights, where R is the number of subgroups. The optimal permutation is
chosen as that which minimizes a balance criterion as described in DZZL. The
balance criterion used here is, for binary and multi-category treatments, the
sum of the squared standardized mean differences within subgroups and
overall, which are computed using <code><a href="https://ngreifer.github.io/cobalt/reference/balance-summary.html" class="external-link">cobalt::col_w_smd()</a></code>, and for continuous
treatments, the sum of the squared correlations between each covariate and
treatment within subgroups and overall, which are computed using
<code><a href="https://ngreifer.github.io/cobalt/reference/balance-summary.html" class="external-link">cobalt::col_w_corr()</a></code>.</p>
<p>The smooth version estimates weights that determine the relative contribution
of the overall and subgroup propensity scores to a weighted average
propensity score for each subgroup. If P_O are the propensity scores
estimated in the overall sample and P_S are the propensity scores estimated
in each subgroup, the smooth SBPS finds R coefficients C so that for each
subgroup, the ultimate propensity score is \(C*P_S + (1-C)*P_O\), and
weights are computed from this propensity score. The coefficients are
estimated using <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code> with <code>method = "L-BFGS-B"</code>. When C is estimated to
be 1 or 0 for each subgroup, the smooth SBPS coincides with the standard
SBPS.</p>
<p>If <code>obj2</code> is not specified and <code>moderator</code> is, <code>sbps()</code> will attempt to refit
the model specified in <code>obj</code> with the <code>moderator</code> in the <code>by</code> argument. This
relies on the environment in which <code>obj</code> was created to be intact and can
take some time if <code>obj</code> was hard to fit. It's safer to estimate <code>obj</code> and
<code>obj2</code> (the latter simply by including the moderator in the <code>by</code> argument)
and supply these to <code>sbps()</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Dong, J., Zhang, J. L., Zeng, S., &amp; Li, F. (2020). Subgroup
balancing propensity score. <em>Statistical Methods in Medical Research</em>, 29(3),
659–676. <a href="https://doi.org/10.1177/0962280219870836" class="external-link">doi:10.1177/0962280219870836</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="weightit.html">weightit()</a></code>, <code><a href="summary.weightit.html">summary.weightit()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ngreifer.github.io/cobalt/" class="external-link">"cobalt"</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates between treatment groups within races</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                <span class="va">nodegree</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"glm"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "glm" (propensity score weighting with GLM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, race, re74</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                <span class="va">nodegree</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"glm"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span></span>
<span class="r-in"><span>                by <span class="op">=</span> <span class="st">"race"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "glm" (propensity score weighting with GLM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, race, re74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - by: race</span>
<span class="r-in"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu">sbps</span><span class="op">(</span><span class="va">W1</span>, <span class="va">W2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit.sbps</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "glm" (propensity score weighting with GLM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, race, re74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - moderator: race (3 subgroups)</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of weights:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Overall vs. subgroup proportion contribution:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          race = black race = hispan race = white</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall             0             0            0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Subgroup            1             1            1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - - - - - Subgroup race = black - - - - - - -</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Weight ranges:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Min                                  Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.000      ||                       1.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.466 |---------------------------| 3.5903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Units with 5 greatest weights by group:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               1      2     3      4      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated      1      1     1      1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             221    228   188    185    174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 2.9494 2.9494 3.006 3.0637 3.5903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Ratio Coef of Var</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.0000      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 7.7042      0.4250</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> overall 7.7042      0.4616</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Effective Sample Sizes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  87.000     156</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    73.818     156</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - - - - - Subgroup race = hispan - - - - - - -</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Weight ranges:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Min                                    Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.0000                              || 1.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.0209   |------------|                0.5046</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Units with 5 greatest weights by group:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               1      2      3      4      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated      1      1      1      1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              56     54     49     48     47</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 0.4117 0.4767 0.4835 0.4968 0.5046</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Ratio Coef of Var</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated  1.0000      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 24.1741      0.7143</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> overall 47.9120      1.0352</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Effective Sample Sizes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  61.000      11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    40.616      11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - - - - - Subgroup race = white - - - - - - -</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Weight ranges:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Min                                   Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.0000                              || 1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.0002   |---------|                   0.385</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Units with 5 greatest weights by group:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               1      2      3      4     5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated      1      1      1      1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             289    287    285    280   267</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 0.2393 0.2699 0.2937 0.2956 0.385</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Ratio Coef of Var</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated    1.000      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 1825.568      1.1538</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> overall 4742.156      1.9499</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Effective Sample Sizes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted 281.000      18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted   120.777      18</span>
<span class="r-in"><span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">S</span>, cluster <span class="op">=</span> <span class="st">"race"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance by cluster</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - <span style="font-style: italic;">Cluster: black</span> - - - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score Distance   0.0016</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age         Contin.   0.0126</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ        Contin.  -0.0332</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      Binary   0.0030</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     Binary   0.0062</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        Contin.  -0.0826</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                0   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 87.   156</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   73.82 156</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - <span style="font-style: italic;">Cluster: hispan</span> - - - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score Distance  -0.2678</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age         Contin.   0.1196</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ        Contin.  -0.0756</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      Binary   0.0217</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     Binary   0.0018</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        Contin.   0.0114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                0  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 61.   11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   40.62 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - <span style="font-style: italic;">Cluster: white</span> - - - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score Distance   0.0652</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age         Contin.   0.0191</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ        Contin.  -0.0185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      Binary  -0.0015</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     Binary   0.0039</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        Contin.  -0.0117</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 0  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 281.   18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   120.78 18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - - - - - - - - - - - - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Could also have run</span></span></span>
<span class="r-in"><span><span class="co">#  sbps(W1, moderator = "race")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">S_</span> <span class="op">&lt;-</span> <span class="fu">sbps</span><span class="op">(</span><span class="va">W1</span>, <span class="va">W2</span>, smooth <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">S_</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit.sbps</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "glm" (propensity score weighting with GLM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, race, re74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - moderator: race (3 subgroups)</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">S_</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of weights:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Overall vs. subgroup proportion contribution:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          race = black race = hispan race = white</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Overall          0.17          0.25            0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Subgroup         0.83          0.75            1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - - - - - Subgroup race = black - - - - - - -</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Weight ranges:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Min                                  Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.0000      ||                       1.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.4654 |---------------------------| 3.5703</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Units with 5 greatest weights by group:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               1      2      3      4      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated      1      1      1      1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             221    228    188    185    174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 2.9787 2.9787 3.0338 3.0899 3.5703</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Ratio Coef of Var</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.0000      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 7.6708      0.4264</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> overall 7.6708      0.4625</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Effective Sample Sizes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  87.000     156</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    73.744     156</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - - - - - Subgroup race = hispan - - - - - - -</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Weight ranges:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Min                                    Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.0000                              || 1.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.0254   |-----------|                 0.4743</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Units with 5 greatest weights by group:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               1      2      3      4      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated      1      1      1      1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              56     54     48     47     28</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 0.3908 0.4496 0.4557 0.4704 0.4743</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Ratio Coef of Var</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated  1.0000      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 18.6516      0.6795</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> overall 39.3245      1.0314</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Effective Sample Sizes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted   61.00      11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted     41.95      11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - - - - - Subgroup race = white - - - - - - -</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Weight ranges:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Min                                   Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.0000                              || 1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.0002   |---------|                   0.385</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Units with 5 greatest weights by group:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               1      2      3      4     5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated      1      1      1      1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             289    287    285    280   267</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 0.2393 0.2699 0.2937 0.2956 0.385</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Ratio Coef of Var</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated    1.000      0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 1825.568      1.1538</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> overall 4742.156      1.9499</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Effective Sample Sizes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted 281.000      18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted   120.777      18</span>
<span class="r-in"><span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">S_</span>, cluster <span class="op">=</span> <span class="st">"race"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance by cluster</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - <span style="font-style: italic;">Cluster: black</span> - - - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score Distance   0.0019</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age         Contin.   0.0388</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ        Contin.  -0.0305</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      Binary   0.0096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     Binary   0.0086</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        Contin.  -0.0561</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                0   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 87.   156</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   73.74 156</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - <span style="font-style: italic;">Cluster: hispan</span> - - - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score Distance  -0.1909</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age         Contin.   0.0167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ        Contin.  -0.0654</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      Binary   0.0314</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     Binary   0.0084</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        Contin.  -0.0175</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                0  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 61.   11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   41.95 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - <span style="font-style: italic;">Cluster: white</span> - - - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score Distance   0.0652</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age         Contin.   0.0191</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ        Contin.  -0.0185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      Binary  -0.0015</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     Binary   0.0039</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        Contin.  -0.0117</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 0  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 281.   18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   120.78 18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - - - - - - - - - - - - - - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

