<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fitting Weighted Generalized Linear Models — glm_weightit • WeightIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting Weighted Generalized Linear Models — glm_weightit"><meta name="description" content="glm_weightit() is used to fit generalized linear models with a
covariance matrix that accounts for estimation of weights, if supplied.
lm_weightit() is a wrapper for glm_weightit() with the Gaussian family
and identity link (i.e., a linear model). ordinal_weightit() fits
proportional odds ordinal regression models. multinom_weightit() fits
multinomial logistic regression models. coxph_weightit() fits a Cox
proportional hazards model and is a wrapper for survival::coxph(). By
default, these functions use M-estimation to construct a robust covariance
matrix using the estimating equations for the weighting model and the outcome
model when available."><meta property="og:description" content="glm_weightit() is used to fit generalized linear models with a
covariance matrix that accounts for estimation of weights, if supplied.
lm_weightit() is a wrapper for glm_weightit() with the Gaussian family
and identity link (i.e., a linear model). ordinal_weightit() fits
proportional odds ordinal regression models. multinom_weightit() fits
multinomial logistic regression models. coxph_weightit() fits a Cox
proportional hazards model and is a wrapper for survival::coxph(). By
default, these functions use M-estimation to construct a robust covariance
matrix using the estimating equations for the weighting model and the outcome
model when available."><meta property="og:image" content="https://ngreifer.github.io/WeightIt/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WeightIt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/WeightIt.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/estimating-effects.html">Estimating Effects After Weighting</a></li>
    <li><a class="dropdown-item" href="../articles/installing-packages.html">Installing Supporting Packages</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/WeightIt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fitting Weighted Generalized Linear Models</h1>
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/WeightIt/blob/master/R/glm_weightit.R" class="external-link"><code>R/glm_weightit.R</code></a></small>
      <div class="d-none name"><code>glm_weightit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>glm_weightit()</code> is used to fit generalized linear models with a
covariance matrix that accounts for estimation of weights, if supplied.
<code>lm_weightit()</code> is a wrapper for <code>glm_weightit()</code> with the Gaussian family
and identity link (i.e., a linear model). <code>ordinal_weightit()</code> fits
proportional odds ordinal regression models. <code>multinom_weightit()</code> fits
multinomial logistic regression models. <code>coxph_weightit()</code> fits a Cox
proportional hazards model and is a wrapper for <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph()</a></code>. By
default, these functions use M-estimation to construct a robust covariance
matrix using the estimating equations for the weighting model and the outcome
model when available.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">glm_weightit</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  family <span class="op">=</span> <span class="va">gaussian</span>,</span>
<span>  weightit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vcov <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">cluster</span>,</span>
<span>  R <span class="op">=</span> <span class="fl">500L</span>,</span>
<span>  <span class="va">offset</span>,</span>
<span>  start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">etastart</span>,</span>
<span>  <span class="va">mustart</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fwb.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  br <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lm_weightit</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  weightit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vcov <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">cluster</span>,</span>
<span>  R <span class="op">=</span> <span class="fl">500L</span>,</span>
<span>  <span class="va">offset</span>,</span>
<span>  x <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fwb.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ordinal_weightit</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"logit"</span>,</span>
<span>  weightit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vcov <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">cluster</span>,</span>
<span>  R <span class="op">=</span> <span class="fl">500L</span>,</span>
<span>  <span class="va">offset</span>,</span>
<span>  start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fwb.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">multinom_weightit</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"logit"</span>,</span>
<span>  weightit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vcov <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">cluster</span>,</span>
<span>  R <span class="op">=</span> <span class="fl">500L</span>,</span>
<span>  <span class="va">offset</span>,</span>
<span>  start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fwb.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">coxph_weightit</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  weightit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vcov <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">cluster</span>,</span>
<span>  R <span class="op">=</span> <span class="fl">500L</span>,</span>
<span>  x <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fwb.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>an object of class "formula" (or one that can be coerced to
that class): a symbolic description of the model to be fitted. For
<code>coxph_weightit()</code>, see <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph()</a></code> for how this should be
specified.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>a data frame containing the variables in the model. If not found
in data, the variables are taken from <code>environment(formula)</code>, typically the
environment from which the function is called.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>a description of the error distribution and link function to be
used in the model. This can be a character string naming a family function,
a family function or the result of a call to a family function. See
<a href="https://rdrr.io/r/stats/family.html" class="external-link">family</a> for details of family functions.</p></dd>


<dt id="arg-weightit">weightit<a class="anchor" aria-label="anchor" href="#arg-weightit"></a></dt>
<dd><p>a <code>weightit</code> or <code>weightitMSM</code> object; the output of a call to
<code><a href="weightit.html">weightit()</a></code> or <code><a href="weightitMSM.html">weightitMSM()</a></code>. If not supplied, an unweighted model will
be fit.</p></dd>


<dt id="arg-vcov">vcov<a class="anchor" aria-label="anchor" href="#arg-vcov"></a></dt>
<dd><p>string; the method used to compute the variance of the estimated
parameters. Allowable options include <code>"asympt"</code>, which uses the
asymptotically correct M-estimation-based method that accounts for
estimation of the weights when available; <code>"const"</code>, which uses the usual
maximum likelihood estimates (only available when <code>weightit</code> is not
supplied); <code>"HC0"</code>, which computes the robust sandwich variance treating
weights (if supplied) as fixed; <code>"BS"</code>, which uses the traditional
bootstrap (including re-estimation of the weights, if supplied); <code>"FWB"</code>,
which uses the fractional weighted bootstrap as implemented in
<code><a href="https://ngreifer.github.io/fwb/reference/fwb.html" class="external-link">fwb::fwb()</a></code> (including re-estimation of the weights, if supplied);
and <code>"none"</code> to omit calculation of a variance matrix. If <code>NULL</code> (the
default), will use <code>"asympt"</code> if <code>weightit</code> is supplied and M-estimation is
available and <code>"HC0"</code> otherwise. See the <code>vcov_type</code> component of the
outcome object to see which was used.</p></dd>


<dt id="arg-cluster">cluster<a class="anchor" aria-label="anchor" href="#arg-cluster"></a></dt>
<dd><p>optional; for computing a cluster-robust variance matrix, a
variable indicating the clustering of observations, a list (or data frame)
thereof, or a one-sided formula specifying which variable(s) from the
fitted model should be used. Note the cluster-robust variance matrix uses a
correction for small samples, as is done in <code><a href="https://sandwich.R-Forge.R-project.org/reference/vcovCL.html" class="external-link">sandwich::vcovCL()</a></code> by
default. Cluster-robust variance calculations are available only when
<code>vcov</code> is <code>"asympt"</code>, <code>"HC0"</code>, <code>"BS"</code>, or <code>"FWB"</code>.</p></dd>


<dt id="arg-r">R<a class="anchor" aria-label="anchor" href="#arg-r"></a></dt>
<dd><p>the number of bootstrap replications when <code>vcov</code> is <code>"BS"</code> or
<code>"FWB"</code>. Default is 500. Ignored otherwise.</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>optional; a numeric vector containing the model offset. See
<code><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset()</a></code>. An offset can also be preset in the model formula.</p></dd>


<dt id="arg-start">start<a class="anchor" aria-label="anchor" href="#arg-start"></a></dt>
<dd><p>optional starting values for the coefficients.</p></dd>


<dt id="arg-etastart-mustart">etastart, mustart<a class="anchor" aria-label="anchor" href="#arg-etastart-mustart"></a></dt>
<dd><p>optional starting values for the linear predictor and
vector of means. Passed to <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>.</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>a list of parameters for controlling the fitting process.</p></dd>


<dt id="arg-x-y">x, y<a class="anchor" aria-label="anchor" href="#arg-x-y"></a></dt>
<dd><p>logical values indicating whether the response vector and model
matrix used in the fitting process should be returned as components of the
returned value.</p></dd>


<dt id="arg-contrasts">contrasts<a class="anchor" aria-label="anchor" href="#arg-contrasts"></a></dt>
<dd><p>an optional list defining contrasts for factor variables.
See <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code>.</p></dd>


<dt id="arg-fwb-args">fwb.args<a class="anchor" aria-label="anchor" href="#arg-fwb-args"></a></dt>
<dd><p>an optional list of further arguments to supply to
<code><a href="https://ngreifer.github.io/fwb/reference/fwb.html" class="external-link">fwb::fwb()</a></code> when <code>vcov = "FWB"</code>.</p></dd>


<dt id="arg-br">br<a class="anchor" aria-label="anchor" href="#arg-br"></a></dt>
<dd><p><code>logical</code>; whether to use bias-reduced regression as implemented by
<code><a href="https://rdrr.io/pkg/brglm2/man/brglmFit.html" class="external-link">brglm2::brglmFit()</a></code>. If <code>TRUE</code>, arguments passed to <code>control</code> or
... will be passed to <code><a href="https://rdrr.io/pkg/brglm2/man/brglmControl.html" class="external-link">brglm2::brglmControl()</a></code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>arguments to be used to form the default control argument if it
is not supplied directly.</p></dd>


<dt id="arg-link">link<a class="anchor" aria-label="anchor" href="#arg-link"></a></dt>
<dd><p>for <code>ordinal_weightit()</code> and <code>multinom_weightit()</code>, a string
corresponding to the desired link function. For <code>ordinal_weightit()</code>, any
allowed by <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code> are accepted; for <code>multinom_weightit()</code>, only
<code>"logit"</code> is allowed. Default is <code>"logit"</code> for ordinal or multinomial
logistic regression, respectively.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For <code>lm_weightit()</code> and <code>glm_weightit()</code>, a <code>glm_weightit</code> object,
which inherits from <code>glm</code>. For <code>ordinal_weightit()</code> and
<code>multinom_weightit()</code>, an <code>ordinal_weightit</code> or <code>multinom_weightit</code> object,
respectively. For <code>coxph_weightit()</code>, a <code>coxph_weightit</code> object, which
inherits from <code>coxph</code>. See <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph()</a></code> for details.</p>
<p>Unless <code>vcov = "none"</code>, the <code>vcov</code> component contains the covariance matrix
adjusted for the estimation of the weights if requested and a compatible
<code>weightit</code> object was supplied. The <code>vcov_type</code> component contains the type
of variance matrix requested. If <code>cluster</code> is supplied, it will be stored in
the <code>"cluster"</code> attribute of the output object, even if not used.</p>
<p>The <code>model</code> component of the output object (also the <code><a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame()</a></code> output)
will include two extra columns when <code>weightit</code> is supplied: <code>(weights)</code>
containing the weights used in the model (the product of the estimated
weights and the sampling weights, if any) and <code>(s.weights)</code> containing the
sampling weights, which will be 1 if <code>s.weights</code> is not supplied in the
original <code><a href="weightit.html">weightit()</a></code> call.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>glm_weightit()</code> is essentially a wrapper for <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> that
optionally computes a coefficient variance matrix that can be adjusted to
account for estimation of the weights if a <code>weightit</code> or <code>weightitMSM</code> object
is supplied to the <code>weightit</code> argument. When no argument is supplied to
<code>weightit</code> or there is no <code>"Mparts"</code> attribute in the supplied object, the
default variance matrix returned will be the "HC0" sandwich variance matrix,
which is robust to misspecification of the outcome family (including
heteroscedasticity). Otherwise, the default variance matrix uses M-estimation
to additionally adjust for estimation of the weights. When possible, this
often yields smaller (and more accurate) standard errors. See the individual
methods pages to see whether and when an <code>"Mparts"</code> attribute is included in
the supplied object. To request that a variance matrix be computed that
doesn't account for estimation of the weights even when a compatible
<code>weightit</code> object is supplied, set <code>vcov = "HC0"</code>, which treats the weights
as fixed.</p>
<p>Bootstrapping can also be used to compute the coefficient variance matrix;
when <code>vcov = "BS"</code> or <code>vcov = "FWB"</code>, which implement the traditional
resampling-based and fractional weighted bootstrap, respectively, the entire
process of estimating the weights and fitting the outcome model is repeated
in bootstrap samples (if a <code>weightit</code> object is supplied). This accounts for
estimation of the weights and can be used with any weighting method. It is
important to set a seed using <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> to ensure replicability of the
results. The fractional weighted bootstrap is more reliable but requires the
weighting method to accept sampling weights (which most do, and you'll get an
error if it doesn't). Setting <code>vcov = "FWB"</code> and supplying <code>fwb.args = list(wtype = "multinom")</code>
also performs the resampling-based bootstrap but
with the additional features <span class="pkg">fwb</span> provides (e.g., a progress bar and
parallelization) at the expense of needing to have <span class="pkg">fwb</span> installed.</p>
<p><code>multinom_weightit()</code> implements multinomial logistic regression using a
custom function in <span class="pkg">WeightIt</span>. This implementation is less robust to
failures than other multinomial logistic regression solvers and should be
used with caution. Estimation of coefficients should align with that from
<code><a href="https://rdrr.io/pkg/mlogit/man/mlogit.html" class="external-link">mlogit::mlogit()</a></code> and <code><a href="https://rdrr.io/pkg/mclogit/man/mblogit.html" class="external-link">mclogit::mblogit()</a></code>.</p>
<p><code>ordinal_weightit()</code> implements proportional odds ordinal regression using a
custom function in <span class="pkg">WeightIt</span>. Estimation of coefficients should align
with that from <code><a href="https://rdrr.io/pkg/MASS/man/polr.html" class="external-link">MASS::polr()</a></code>.</p>
<p><code>coxph_weightit()</code> is a wrapper for <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph()</a></code> to fit weighted
survival models. It differs from <code>coxph()</code> in that the <code>cluster</code> argument (if
used) should be specified as a one-sided formula (which can include multiple
clustering variables) and uses a small sample correction for cluster variance
estimates when specified. Currently, M-estimation is not supported, so
bootstrapping (i.e., <code>vcov = "BS"</code> or <code>"FWB"</code>) is the only way to correctly
adjust for estimation of the weights. By default, the robust variance is
estimated treating weights as fixed, which is the same variance returned when
<code>robust = TRUE</code> in <code>coxph()</code>.</p>
<p>Functions in the <span class="pkg">sandwich</span> package can be to compute standard errors
after fitting, regardless of how <code>vcov</code> was specified, though these will
ignore estimation of the weights, if any. When no adjustment is done for
estimation of the weights (i.e., because no <code>weightit</code> argument was supplied
or there was no <code>"Mparts"</code> component in the supplied object), the default
variance matrix produced by <code>glm_weightit()</code> should align with that from
<code>sandwich::vcovHC(. type = "HC0")</code> or <code>sandwich::vcovCL(., type = "HC0", cluster = cluster)</code>
when <code>cluster</code> is supplied. Not all types are available
for all models.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> and <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> for fitting generalized linear models without
adjusting standard errors for estimation of the weights. <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph()</a></code>
for fitting Cox proportional hazards models without adjusting standard errors
for estimation of the weights.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Logistic regression ATT weights</span></span></span>
<span class="r-in"><span><span class="va">w.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">lalonde</span>, method <span class="op">=</span> <span class="st">"glm"</span>,</span></span>
<span class="r-in"><span>                  estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Linear regression outcome model that adjusts</span></span></span>
<span class="r-in"><span><span class="co"># for estimation of weights</span></span></span>
<span class="r-in"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu">lm_weightit</span><span class="op">(</span><span class="va">re78</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                    weightit <span class="op">=</span> <span class="va">w.out</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Call:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm_weightit(formula = re78 ~ treat, data = lalonde, weightit = w.out)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Coefficients:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   5515.9      376.5  14.649   &lt;1e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treat          833.2      669.1   1.245    0.213    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Standard error: HC0 robust (adjusted for estimation of weights)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Linear regression outcome model that treats weights</span></span></span>
<span class="r-in"><span><span class="co"># as fixed</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu">lm_weightit</span><span class="op">(</span><span class="va">re78</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                    weightit <span class="op">=</span> <span class="va">w.out</span>,</span></span>
<span class="r-in"><span>                    vcov <span class="op">=</span> <span class="st">"HC0"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Call:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm_weightit(formula = re78 ~ treat, data = lalonde, weightit = w.out, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vcov = "HC0")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Coefficients:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   5515.9      353.5  15.604   &lt;1e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treat          833.2      676.6   1.232    0.218    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Standard error: HC0 robust</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Can also just call summary() with `vcov` option</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit1</span>, vcov <span class="op">=</span> <span class="st">"HC0"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Call:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm_weightit(formula = re78 ~ treat, data = lalonde, weightit = w.out)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Coefficients:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   5515.9      353.5  15.604   &lt;1e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treat          833.2      676.6   1.232    0.218    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Standard error: HC0 robust</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># Linear regression outcome model that bootstraps</span></span></span>
<span class="r-in"><span><span class="co"># estimation of weights and outcome model fitting</span></span></span>
<span class="r-in"><span><span class="co"># using fractional weighted bootstrap with "Mammen"</span></span></span>
<span class="r-in"><span><span class="co"># weights</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu">lm_weightit</span><span class="op">(</span><span class="va">re78</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                    weightit <span class="op">=</span> <span class="va">w.out</span>,</span></span>
<span class="r-in"><span>                    vcov <span class="op">=</span> <span class="st">"FWB"</span>,</span></span>
<span class="r-in"><span>                    R <span class="op">=</span> <span class="fl">50</span>, <span class="co">#should use way more</span></span></span>
<span class="r-in"><span>                    fwb.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wtype <span class="op">=</span> <span class="st">"mammen"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Call:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm_weightit(formula = re78 ~ treat, data = lalonde, weightit = w.out, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vcov = "FWB", R = 50, fwb.args = list(wtype = "mammen"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Coefficients:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   5515.9      361.5  15.257   &lt;1e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treat          833.2      644.4   1.293    0.196    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Standard error: fractional weighted bootstrap</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># Multinomial logistic regression outcome model</span></span></span>
<span class="r-in"><span><span class="co"># that adjusts for estimation of weights</span></span></span>
<span class="r-in"><span><span class="va">lalonde</span><span class="op">$</span><span class="va">re78_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/findInterval.html" class="external-link">findInterval</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">re78</span>,</span></span>
<span class="r-in"><span>                                      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5e3</span>, <span class="fl">1e4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit4</span> <span class="op">&lt;-</span> <span class="fu">multinom_weightit</span><span class="op">(</span><span class="va">re78_3</span> <span class="op">~</span> <span class="va">treat</span>,</span></span>
<span class="r-in"><span>                          data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                          weightit <span class="op">=</span> <span class="va">w.out</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Call:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> multinom_weightit(formula = re78_3 ~ treat, data = lalonde, weightit = w.out)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Coefficients:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2~(Intercept) -0.90398    0.14906  -6.064   &lt;1e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2~treat        0.05006    0.23633   0.212    0.832    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3~(Intercept) -1.02170    0.15699  -6.508   &lt;1e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3~treat        0.12015    0.23835   0.504    0.614    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Standard error: HC0 robust (adjusted for estimation of weights)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Ordinal probit regression that adjusts for estimation</span></span></span>
<span class="r-in"><span><span class="co"># of weights</span></span></span>
<span class="r-in"><span><span class="va">fit5</span> <span class="op">&lt;-</span> <span class="fu">ordinal_weightit</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">re78_3</span><span class="op">)</span> <span class="op">~</span> <span class="va">treat</span>,</span></span>
<span class="r-in"><span>                         data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                         link <span class="op">=</span> <span class="st">"probit"</span>,</span></span>
<span class="r-in"><span>                         weightit <span class="op">=</span> <span class="va">w.out</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Call:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ordinal_weightit(formula = ordered(re78_3) ~ treat, data = lalonde, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     link = "probit", weightit = w.out)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Coefficients:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Estimate Std. Error z value Pr(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treat   0.0554     0.1114   0.498    0.619</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Standard error: HC0 robust (adjusted for estimation of weights)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Thresholds:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1|2  0.16926    0.07479   2.263   0.0236 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2|3  0.82476    0.08193  10.066   &lt;1e-06 ***</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

