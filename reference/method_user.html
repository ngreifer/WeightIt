<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>User-Defined Functions for Estimating Weights — method_user • WeightIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="User-Defined Functions for Estimating Weights — method_user"><meta property="og:description" content="This page explains the details of estimating weights using a user-defined function. The function must take in arguments that are passed to it by weightit() or weightitMSM() and return a vector of weights or a list containing the weights.
To supply  user-defined function, the function object should be entered directly to method; for example, for a function fun, method = fun.

Point Treatments
The following arguments are automatically passed to the user-defined function, which should have named parameters corresponding to them:
treat: a vector of treatment status for each unit. This comes directly from the left hand side of the formula passed to weightit and so will have it's type (e.g., numeric, factor, etc.), which may need to be converted.
covs: a data frame of covariate values for each unit. This comes directly from the right hand side of the formula passed to weightit. The covariates are processed so that all columns are numeric; all factor variables are split into dummies and all interactions are evaluated. All levels of factor variables are given dummies, so the matrix of the covariates is not full rank. Users can use make_full_rank, which accepts a numeric matrix or data frame and removes columns to make it full rank, if a full rank covariate matrix is desired.
s.weights: a numeric vector of sampling weights, one for each unit.
ps: a numeric vector of propensity scores.
subset: a logical vector the same length as treat that is TRUE for units to be included in the estimation and FALSE otherwise. This is used to subset the input objects when exact is used. treat, covs, s.weights, and ps, if supplied, will already have been subsetted by subset.
estimand: a character vector of length 1 containing the desired estimand. The characters will have been converted to uppercase. If &quot;ATC&quot; was supplied to estimand, weightit sets focal to the control level (usually 0 or the lowest level of treat) and sets estimand to &quot;ATT&quot;.
focal: a character vector of length 1 containing the focal level of the treatment when the estimand is the ATT (or the ATC as detailed above). weightit() ensures the value of focal is a level of treat.
stabilize: a logical vector of length 1. It is not processed by weightit() before it reaches the fitting function.
moments: a numeric vector of length 1. It is not processed by weightit() before it reaches the fitting function except that as.integer is applied to it. This is used in other methods to determine whether polynomials of the entered covariates are to be used in the weight estimation.
int: a logical vector of length 1. It is not processed by weightit() before it reaches the fitting function. This is used in other methods to determine whether interactions of the entered covariates are to be used in the weight estimation.
None of these parameters are required to be in the fitting function. These are simply those that are automatically available.
In addition, any additional arguments supplied to weightit() will be passed on to the fitting function. weightit() ensures the arguments correspond to the parameters of the fitting function and throws an error if an incorrectly named argument is supplied and the fitting function doesn't include ... as a parameter.
The fitting function must output either a numeric vector of weights or a list (or list-like object) with an entry named wither &quot;w&quot; or &quot;weights&quot;. If a list, the list can contain other named entries, but only entries named &quot;w&quot;, &quot;weights&quot;, &quot;ps&quot;, and &quot;fit.obj&quot; will be processed. &quot;ps&quot; is a vector of propensity scores and &quot;fit.obj&quot; should be an object used in the fitting process that a user may want to examine and that is included in the weightit output object as &quot;obj&quot; when include.obj = TRUE. The &quot;ps&quot; and &quot;fit.obj&quot; components are optional, but &quot;weights&quot; or &quot;w&quot; is required.


Longitudinal Treatments
Longitudinal treatments can be handled either by running the fitting function for point treatments for each time point and multiplying the resulting weights together or by running a method that accommodates multiple time points and outputs a single set of weights. For the former, weightitMSM() can be used with the user-defined function just as it is with weightit(). The latter method is not yet accommodated by weightitMSM(), but will be someday, maybe.

"><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WeightIt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.13.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/WeightIt.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ngreifer/WeightIt/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>User-Defined Functions for Estimating Weights</h1>
    
    <div class="hidden name"><code>method_user.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This page explains the details of estimating weights using a user-defined function. The function must take in arguments that are passed to it by <code><a href="weightit.html">weightit()</a></code> or <code><a href="weightitMSM.html">weightitMSM()</a></code> and return a vector of weights or a list containing the weights.</p>
<p>To supply  user-defined function, the function object should be entered directly to <code>method</code>; for example, for a function <code>fun</code>, <code>method = fun</code>.</p>
<div class="section">
<h3 id="point-treatments">Point Treatments<a class="anchor" aria-label="anchor" href="#point-treatments"></a></h3>
<p>The following arguments are automatically passed to the user-defined function, which should have named parameters corresponding to them:</p><ul><li><p><code>treat</code>: a vector of treatment status for each unit. This comes directly from the left hand side of the formula passed to <code>weightit</code> and so will have it's type (e.g., numeric, factor, etc.), which may need to be converted.</p></li>
<li><p><code>covs</code>: a data frame of covariate values for each unit. This comes directly from the right hand side of the formula passed to <code>weightit</code>. The covariates are processed so that all columns are numeric; all factor variables are split into dummies and all interactions are evaluated. All levels of factor variables are given dummies, so the matrix of the covariates is not full rank. Users can use <code><a href="make_full_rank.html">make_full_rank</a></code>, which accepts a numeric matrix or data frame and removes columns to make it full rank, if a full rank covariate matrix is desired.</p></li>
<li><p><code>s.weights</code>: a numeric vector of sampling weights, one for each unit.</p></li>
<li><p><code>ps</code>: a numeric vector of propensity scores.</p></li>
<li><p><code>subset</code>: a logical vector the same length as <code>treat</code> that is <code>TRUE</code> for units to be included in the estimation and <code>FALSE</code> otherwise. This is used to subset the input objects when <code>exact</code> is used. <code>treat</code>, <code>covs</code>, <code>s.weights</code>, and <code>ps</code>, if supplied, will already have been subsetted by <code>subset</code>.</p></li>
<li><p><code>estimand</code>: a character vector of length 1 containing the desired estimand. The characters will have been converted to uppercase. If "ATC" was supplied to estimand, <code>weightit</code> sets <code>focal</code> to the control level (usually 0 or the lowest level of <code>treat</code>) and sets <code>estimand</code> to "ATT".</p></li>
<li><p><code>focal</code>: a character vector of length 1 containing the focal level of the treatment when the estimand is the ATT (or the ATC as detailed above). <code><a href="weightit.html">weightit()</a></code> ensures the value of focal is a level of <code>treat</code>.</p></li>
<li><p><code>stabilize</code>: a logical vector of length 1. It is not processed by <code><a href="weightit.html">weightit()</a></code> before it reaches the fitting function.</p></li>
<li><p><code>moments</code>: a numeric vector of length 1. It is not processed by <code><a href="weightit.html">weightit()</a></code> before it reaches the fitting function except that <code>as.integer</code> is applied to it. This is used in other methods to determine whether polynomials of the entered covariates are to be used in the weight estimation.</p></li>
<li><p><code>int</code>: a logical vector of length 1. It is not processed by <code><a href="weightit.html">weightit()</a></code> before it reaches the fitting function. This is used in other methods to determine whether interactions of the entered covariates are to be used in the weight estimation.</p></li>
</ul><p>None of these parameters are required to be in the fitting function. These are simply those that are automatically available.</p>
<p>In addition, any additional arguments supplied to <code><a href="weightit.html">weightit()</a></code> will be passed on to the fitting function. <code><a href="weightit.html">weightit()</a></code> ensures the arguments correspond to the parameters of the fitting function and throws an error if an incorrectly named argument is supplied and the fitting function doesn't include <code>...</code> as a parameter.</p>
<p>The fitting function must output either a numeric vector of weights or a list (or list-like object) with an entry named wither "w" or "weights". If a list, the list can contain other named entries, but only entries named "w", "weights", "ps", and "fit.obj" will be processed. "ps" is a vector of propensity scores and "fit.obj" should be an object used in the fitting process that a user may want to examine and that is included in the <code>weightit</code> output object as "obj" when <code>include.obj = TRUE</code>. The "ps" and "fit.obj" components are optional, but "weights" or "w" is required.</p>
</div>
<div class="section">
<h3 id="longitudinal-treatments">Longitudinal Treatments<a class="anchor" aria-label="anchor" href="#longitudinal-treatments"></a></h3>
<p>Longitudinal treatments can be handled either by running the fitting function for point treatments for each time point and multiplying the resulting weights together or by running a method that accommodates multiple time points and outputs a single set of weights. For the former, <code><a href="weightitMSM.html">weightitMSM()</a></code> can be used with the user-defined function just as it is with <code><a href="weightit.html">weightit()</a></code>. The latter method is not yet accommodated by <code><a href="weightitMSM.html">weightitMSM()</a></code>, but will be someday, maybe.</p>
</div>

    </div>


    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="weightit.html">weightit()</a></code>, <code><a href="weightitMSM.html">weightitMSM()</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ngreifer.github.io/cobalt/" class="external-link">"cobalt"</a></span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">#A user-defined version of method = "ps"</span></span>
<span class="r-in"><span class="va">my.ps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">treat</span>, <span class="va">covs</span>, <span class="va">estimand</span>, <span class="va">focal</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_full_rank.html">make_full_rank</a></span><span class="op">(</span><span class="va">covs</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">treat</span>, <span class="va">covs</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">d</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span><span class="op">$</span><span class="va">fitted</span></span>
<span class="r-in">  <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_w_from_ps.html">get_w_from_ps</a></span><span class="op">(</span><span class="va">ps</span>, treat <span class="op">=</span> <span class="va">treat</span>, estimand <span class="op">=</span> <span class="va">estimand</span>,</span>
<span class="r-in">                     focal <span class="op">=</span> <span class="va">focal</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>w <span class="op">=</span> <span class="va">w</span>, ps <span class="op">=</span> <span class="va">ps</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">#Balancing covariates between treatment groups (binary)</span></span>
<span class="r-in"><span class="op">(</span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                method <span class="op">=</span> <span class="va">my.ps</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "my.ps" (a user-defined method)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Min                                  Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.0000               ||              1.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.0222 |---------------------------| 2.0438</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               7      5      4      3      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated      1      1      1      1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             411    595    269    409    296</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 1.3303 1.4365 1.5005 1.6369 2.0438</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated       0.000 0.000   -0.00       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control       0.823 0.701    0.33       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    255.99     185</span>
<span class="r-in"><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Call</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  weightit(formula = treat ~ age + educ + married + nodegree + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     re74, data = lalonde, method = my.ps, estimand = "ATT")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score Distance   0.0199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age         Contin.   0.0459</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ        Contin.  -0.0360</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      Binary   0.0044</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     Binary   0.0080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        Contin.  -0.0275</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted    255.99     185</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">#Balancing covariates for longitudinal treatments</span></span>
<span class="r-in"><span class="co"># my.ps is used at each time point.</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"twang"</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> To reproduce results from prior versions of the twang package, please see the version="legacy" option described in the documentation.</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"iptwExWide"</span>, package <span class="op">=</span> <span class="st">"twang"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">(</span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightitMSM.html">weightitMSM</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">tx1</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">use0</span>,</span>
<span class="r-in">                        <span class="va">tx2</span> <span class="op">~</span> <span class="va">tx1</span> <span class="op">+</span> <span class="va">use1</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">use0</span>,</span>
<span class="r-in">                        <span class="va">tx3</span> <span class="op">~</span> <span class="va">tx2</span> <span class="op">+</span> <span class="va">use2</span> <span class="op">+</span> <span class="va">tx1</span> <span class="op">+</span> <span class="va">use1</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">use0</span><span class="op">)</span>,</span>
<span class="r-in">                   data <span class="op">=</span> <span class="va">iptwExWide</span>,</span>
<span class="r-in">                   method <span class="op">=</span> <span class="va">my.ps</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightitMSM</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "my.ps" (a user-defined method)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 1000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of time points: 3 (tx1, tx2, tx3)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     + time 1: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     + time 2: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     + time 3: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     + baseline: age, gender, use0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     + after time 1: tx1, use1, age, gender, use0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     + after time 2: tx2, use2, tx1, use1, age, gender, use0</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: line-through;">                      </span><span style="font-style: italic;"> Time 1 </span><span style="text-decoration: line-through;">                      </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: line-through;">                      </span><span style="font-style: italic;"> Time 2 </span><span style="text-decoration: line-through;">                      </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: line-through;">                      </span><span style="font-style: italic;"> Time 3 </span><span style="text-decoration: line-through;">                      </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Call</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  weightitMSM(formula.list = list(tx1 ~ age + gender + use0, tx2 ~ </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tx1 + use1 + age + gender + use0, tx3 ~ tx2 + use2 + tx1 + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     use1 + age + gender + use0), data = iptwExWide, method = my.ps)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance summary across all time points</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Times     Type Max.Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score 1, 2, 3 Distance       0.0251</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age        1, 2, 3  Contin.       0.0703</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gender     1, 2, 3   Binary       0.0263</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> use0       1, 2, 3  Contin.       0.0558</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> tx1           2, 3   Binary       0.0171</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> use1          2, 3  Contin.       0.0316</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> tx2              3   Binary       0.0085</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> use2             3  Contin.       0.0315</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - <span style="font-style: italic;">Time 1</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted  294.     706. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted    185.18   573.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - <span style="font-style: italic;">Time 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted   492.   508.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted     318.9  264.49</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - <span style="font-style: italic;">Time 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted  415.     585. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted    235.67   366.4</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Kernel balancing using the KBAL package, available</span></span>
<span class="r-in"><span class="co"># using devtools::install_github("chadhazlett/KBAL").</span></span>
<span class="r-in"><span class="co"># Only the ATT and ATC are available. Use 'kbal.method'</span></span>
<span class="r-in"><span class="co"># instead of 'method' in weightit() to choose between</span></span>
<span class="r-in"><span class="co"># "ebal" and "el".</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">kbal.fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">treat</span>, <span class="va">covs</span>, <span class="va">estimand</span>, <span class="va">focal</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">    <span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span class="r-in">    <span class="kw">if</span> <span class="op">(</span><span class="fu">is_not_null</span><span class="op">(</span><span class="va">focal</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">        <span class="va">treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">==</span> <span class="va">focal</span><span class="op">)</span></span>
<span class="r-in">    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">estimand</span> <span class="op">!=</span> <span class="st">"ATT"</span><span class="op">)</span></span>
<span class="r-in">        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"estimand must be 'ATT' or 'ATC'."</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in">    <span class="kw">if</span> <span class="op">(</span><span class="st">"kbal.method"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">        <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span> <span class="op">==</span> <span class="st">"kbal.method"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"method"</span></span>
<span class="r-in">    <span class="op">}</span></span>
<span class="r-in">    <span class="va">args</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">args</span><span class="op">)</span> <span class="op">%nin%</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="fu">KBAL</span><span class="fu">::</span><span class="va">kbal</span><span class="op">)</span><span class="op">)</span>,</span>
<span class="r-in">        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span class="r-in">    <span class="va">k.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">KBAL</span><span class="fu">::</span><span class="va">kbal</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">covs</span>, D <span class="op">=</span> <span class="va">treat</span><span class="op">)</span>,</span>
<span class="r-in">        <span class="va">args</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">    <span class="va">w</span> <span class="op">&lt;-</span> <span class="va">k.out</span><span class="op">$</span><span class="va">w</span></span>
<span class="r-in">    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>w <span class="op">=</span> <span class="va">w</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="op">(</span><span class="va">Wk</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                method <span class="op">=</span> <span class="va">kbal.fun</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span class="r-in">                kbal.method <span class="op">=</span> <span class="st">"ebal"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Wk</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">Wk</span>, disp.ks <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

