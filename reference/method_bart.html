<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Propensity Score Weighting Using BART — method_bart • WeightIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Propensity Score Weighting Using BART — method_bart"><meta property="og:description" content='This page explains the details of estimating weights from Bayesian additive regression trees (BART)-based propensity scores by setting method = "bart" in the call to weightit() or weightitMSM(). This method can be used with binary, multinomial, and continuous treatments.
In general, this method relies on estimating propensity scores using BART and then converting those propensity scores into weights using a formula that depends on the desired estimand. This method relies on bart2() from the dbarts package.

Binary Treatments
For binary treatments, this method estimates the propensity scores using bart2(). The following estimands are allowed: ATE, ATT, ATC, ATO, ATM, and ATOS. Weights can also be computed using marginal mean weighting through stratification for the ATE, ATT, and ATC. See get_w_from_ps() for details.


Multinomial Treatments
For multinomial treatments, the propensity scores are estimated using several calls to bart2(), one for each treatment group; the treatment probabilities are not normalized to sum to 1. The following estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights for each estimand are computed using the standard formulas or those mentioned above. Weights can also be computed using marginal mean weighting through stratification for the ATE, ATT, and ATC. See get_w_from_ps() for details.


Continuous Treatments
For continuous treatments, the generalized propensity score is estimated using bart2(). In addition, kernel density estimation can be used instead of assuming a normal density for the numerator and denominator of the generalized propensity score by setting use.kernel = TRUE. Other arguments to density() can be specified to refine the density estimation parameters. plot = TRUE can be specified to plot the density for the numerator and denominator, which can be helpful in diagnosing extreme weights.


Longitudinal Treatments
For longitudinal treatments, the weights are the product of the weights estimated at each time point.


Sampling Weights
Sampling weights are not supported.


Missing Data
In the presence of missing data, the following value(s) for missing are allowed:
"ind" (default)
First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is NA and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with 0s. The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting weightit object will be the original covariates with the NAs.





'><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WeightIt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.12.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/WeightIt.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ngreifer/WeightIt/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Propensity Score Weighting Using BART</h1>
    
    <div class="hidden name"><code>method_bart.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This page explains the details of estimating weights from Bayesian additive regression trees (BART)-based propensity scores by setting <code>method = "bart"</code> in the call to <code><a href="weightit.html">weightit()</a></code> or <code><a href="weightitMSM.html">weightitMSM()</a></code>. This method can be used with binary, multinomial, and continuous treatments.</p>
<p>In general, this method relies on estimating propensity scores using BART and then converting those propensity scores into weights using a formula that depends on the desired estimand. This method relies on <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">bart2()</a></code> from the <a href="https://CRAN.R-project.org/package=dbarts" class="external-link"><span class="pkg">dbarts</span></a> package.</p>
<div class="section">
<h3 id="binary-treatments">Binary Treatments<a class="anchor" aria-label="anchor" href="#binary-treatments"></a></h3>
<p>For binary treatments, this method estimates the propensity scores using <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">bart2()</a></code>. The following estimands are allowed: ATE, ATT, ATC, ATO, ATM, and ATOS. Weights can also be computed using marginal mean weighting through stratification for the ATE, ATT, and ATC. See <code><a href="get_w_from_ps.html">get_w_from_ps()</a></code> for details.</p>
</div>
<div class="section">
<h3 id="multinomial-treatments">Multinomial Treatments<a class="anchor" aria-label="anchor" href="#multinomial-treatments"></a></h3>
<p>For multinomial treatments, the propensity scores are estimated using several calls to <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">bart2()</a></code>, one for each treatment group; the treatment probabilities are not normalized to sum to 1. The following estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights for each estimand are computed using the standard formulas or those mentioned above. Weights can also be computed using marginal mean weighting through stratification for the ATE, ATT, and ATC. See <code><a href="get_w_from_ps.html">get_w_from_ps()</a></code> for details.</p>
</div>
<div class="section">
<h3 id="continuous-treatments">Continuous Treatments<a class="anchor" aria-label="anchor" href="#continuous-treatments"></a></h3>
<p>For continuous treatments, the generalized propensity score is estimated using <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">bart2()</a></code>. In addition, kernel density estimation can be used instead of assuming a normal density for the numerator and denominator of the generalized propensity score by setting <code>use.kernel = TRUE</code>. Other arguments to <code><a href="https://rdrr.io/r/stats/density.html" class="external-link">density()</a></code> can be specified to refine the density estimation parameters. <code>plot = TRUE</code> can be specified to plot the density for the numerator and denominator, which can be helpful in diagnosing extreme weights.</p>
</div>
<div class="section">
<h3 id="longitudinal-treatments">Longitudinal Treatments<a class="anchor" aria-label="anchor" href="#longitudinal-treatments"></a></h3>
<p>For longitudinal treatments, the weights are the product of the weights estimated at each time point.</p>
</div>
<div class="section">
<h3 id="sampling-weights">Sampling Weights<a class="anchor" aria-label="anchor" href="#sampling-weights"></a></h3>
<p>Sampling weights are not supported.</p>
</div>
<div class="section">
<h3 id="missing-data">Missing Data<a class="anchor" aria-label="anchor" href="#missing-data"></a></h3>
<p>In the presence of missing data, the following value(s) for <code>missing</code> are allowed:</p><dl><dt><code>"ind"</code> (default)</dt>
<dd><p>First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is <code>NA</code> and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with 0s. The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting <code>weightit</code> object will be the original covariates with the <code>NA</code>s.</p></dd>


</dl></div>

    </div>


    <div id="additional-arguments">
    <h2>Additional Arguments</h2>
    

<p>All arguments to <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">bart2()</a></code> can be passed through <code><a href="weightit.html">weightit()</a></code> or <code><a href="weightitMSM.html">weightitMSM()</a></code>, with the following exceptions:</p><ul><li><p><code>test</code>, <code>weights</code>, <code>subset</code>, <code>offset.test</code> are ignored</p></li>
<li><p><code>combine.chains</code> is always set to <code>TRUE</code></p></li>
<li><p><code>sampleronly</code> is always set to <code>FALSE</code></p></li>
</ul><p>For continuous treatments only, the following arguments may be supplied:</p><dl><dt><code>density</code></dt>
<dd><p>A function corresponding to the conditional density of the treatment. The standardized residuals of the treatment model will be fed through this function to produce the numerator and denominator of the generalized propensity score weights. If blank, <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm()</a></code> is used as recommended by Robins et al. (2000). This can also be supplied as a string containing the name of the function to be called. If the string contains underscores, the call will be split by the underscores and the latter splits will be supplied as arguments to the second argument and beyond. For example, if <code>density = "dt_2"</code> is specified, the density used will be that of a t-distribution with 2 degrees of freedom. Using a t-distribution can be useful when extreme outcome values are observed (Naimi et al., 2014). Ignored if <code>use.kernel = TRUE</code> (described below).</p></dd>

<dt><code>use.kernel</code></dt>
<dd><p>If <code>TRUE</code>, uses kernel density estimation through <code><a href="https://rdrr.io/r/stats/density.html" class="external-link">density()</a></code> to estimate the numerator and denominator densities for the weights. If <code>FALSE</code>, the argument to the <code>density</code> parameter is used instead.</p></dd>

<dt><code>bw</code>, <code>adjust</code>, <code>kernel</code>, <code>n</code></dt>
<dd><p>If <code>use.kernel = TRUE</code>, the arguments to the <code><a href="https://rdrr.io/r/stats/density.html" class="external-link">density()</a></code> function. The defaults are the same as those in <code>density</code> except that <code>n</code> is 10 times the number of units in the sample.</p></dd>

<dt><code>plot</code></dt>
<dd><p>If <code>use.kernel = TRUE</code>, whether to plot the estimated density.</p></dd>


</dl></div>
    <div id="additional-outputs">
    <h2>Additional Outputs</h2>
    
<dl><dt><code>obj</code></dt>
<dd><p>When <code>include.obj = TRUE</code>, the <code>bart2</code> fit(s) used to generate the predicted values. With multinomial treatments, this will be a list of the fits; otherwise, it will be a single fit. The predicted probabilities used to compute the propensity scores can be extracted using <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">fitted()</a></code>.</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>BART works by fitting a sum-of-trees model for the treatment or probability of treatment. The number of trees is determined by the <code>n.trees</code> argument. Bayesian priors are used for the hyperparameters, so the result is a posterior distribution of predicted values for each unit. The mean of these for each unit is taken for use in computing the (generalized) propensity score. Although the hyperparameters governing the priors can be modified by supplying arguments to <code><a href="weightit.html">weightit()</a></code> that are passed to the BART fitting function, the default values tend to work well and require little modification (though the defaults differ for continuous and categorical treatments; see the <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">bart2()</a></code> documentation for details). Unlike many other machine learning methods, no loss function is optimized and the hyperparameters do not need to be tuned (e.g., using cross-validation), though performance can benefit from tuning. BART tends to balance sparseness with flexibility by using very weak learners as the trees, which makes it suitable for capturing complex functions without specifying a particular functional form and without overfitting.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>With version 0.9-19 or below of <span class="pkg">dbarts</span>, special care has to be taken to ensure reproducibility when using <code>method = "bart"</code>. Setting a seed (either with <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> or by supplying an argument to <code>rngSeed</code>) will only work when only one thread is requested. The default is to use four threads. To request that only one thread is used, which is necessary for reproducible results, set <code>n.threads = 1</code> in the call to <code><a href="weightit.html">weightit()</a></code> and set a seed. Note that the fewer threads are used, the slower the estimation will be. One can set <code>n.chains</code> to a lower number (default 4) to speed up the estimation at the possible expense of statistical performance.</p>
<p>With version 0.9-20 and above, setting the seed with <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> works correctly and results will be reproducible.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    

<p>Hill, J., Weiss, C., &amp; Zhai, F. (2011). Challenges With Propensity Score Strategies in a High-Dimensional Setting and a Potential Alternative. Multivariate Behavioral Research, 46(3), 477–513. doi: <a href="https://doi.org/10.1080/00273171.2011.570161" class="external-link">10.1080/00273171.2011.570161</a></p>
<p>Chipman, H. A., George, E. I., &amp; McCulloch, R. E. (2010). BART: Bayesian additive regression trees. The Annals of Applied Statistics, 4(1), 266–298. doi: <a href="https://doi.org/10.1214/09-AOAS285" class="external-link">10.1214/09-AOAS285</a></p>
<p>Note that many references that deal with BART for causal inference focus on estimating potential outcomes with BART, not the propensity scores, and so are not directly relevant when using BART to estimate propensity scores for weights.</p>
<p>See <code><a href="method_ps.html">method_ps</a></code> for additional references on propensity score weighting more generally.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="weightit.html">weightit()</a></code>, <code><a href="weightitMSM.html">weightitMSM()</a></code>, <code><a href="get_w_from_ps.html">get_w_from_ps()</a></code></p>
<p><code><a href="method_super.html">method_super</a></code> for stacking predictions from several machine learning methods, including BART.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ngreifer.github.io/cobalt/" class="external-link">"cobalt"</a></span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">#Balancing covariates between treatment groups (binary)</span></span>
<span class="r-in"><span class="op">(</span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                method <span class="op">=</span> <span class="st">"bart"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "bart" (propensity score weighting with BART)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Min                                  Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.0000    ||                         1.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.0022 |---------------------------| 9.9512</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with 5 greatest weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               6      4      3      2      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated      1      1      1      1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             409    569    592    374    608</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 2.1186 2.9252 2.9871 3.5823 9.9512</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated       0.000 0.000  -0.000       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control       1.851 0.934   0.743       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted     97.06     185</span>
<span class="r-in"><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Call</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  weightit(formula = treat ~ age + educ + married + nodegree + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     re74, data = lalonde, method = "bart", estimand = "ATT")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score Distance   0.4871</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age         Contin.   0.0755</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ        Contin.  -0.0161</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      Binary  -0.0327</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     Binary   0.0295</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        Contin.  -0.0515</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted     97.06     185</span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="co">#Balancing covariates with respect to race (multinomial)</span></span>
<span class="r-in"><span class="op">(</span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">race</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                method <span class="op">=</span> <span class="st">"bart"</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "bart" (propensity score weighting with BART)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 3-category (black, hispan, white)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Min                                   Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> black  1.2311 |-----------------|            9.1726</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hispan 2.6994     |-----------------------| 13.0065</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> white  1.0514 |-----------------|            8.8790</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with 5 greatest weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             283    181     244     423     231</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   black   6.985 7.2611  8.0903  8.4461  9.1726</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             426    346     512     570     564</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  hispan 12.3054 12.529 12.6154 12.6614 13.0065</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              96     23      60      76     140</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   white  4.4853  5.367  5.7015  8.4922   8.879</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> black        0.579 0.373   0.126       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hispan       0.372 0.308   0.069       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> white        0.487 0.328   0.091       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             black hispan  white</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted 243.    72.   299.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted   182.16  63.34 241.86</span>
<span class="r-in"><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Call</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  weightit(formula = race ~ age + educ + married + nodegree + re74, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data = lalonde, method = "bart", estimand = "ATE")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance summary across all treatment pairs</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Max.Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.       0.1820</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.       0.1666</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary       0.0512</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary       0.0293</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.       0.1099</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             black hispan  white</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 243.    72.   299.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   182.16  63.34 241.86</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">#Balancing covariates with respect to re75 (continuous)</span></span>
<span class="r-in"><span class="co">#assuming t(3) conditional density for treatment</span></span>
<span class="r-in"><span class="op">(</span><span class="va">W3</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">re75</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                method <span class="op">=</span> <span class="st">"bart"</span>, density <span class="op">=</span> <span class="st">"dt_3"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "bart" (propensity score weighting with BART)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: continuous</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W3</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Min                                   Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> all 0.0801 |---------------------------| 21.1075</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with 5 greatest weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         486    310    469     487     484</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  all 7.7755 8.1862 8.9152 17.0539 21.1075</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> all       1.127 0.476   0.275       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted 614.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted   270.81</span>
<span class="r-in"><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W3</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Call</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  weightit(formula = re75 ~ age + educ + married + nodegree + re74, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data = lalonde, method = "bart", density = "dt_3")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Corr.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.   0.0300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.   0.0576</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary   0.0803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary  -0.0839</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.   0.1164</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 614.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   270.81</span>
<span class="r-in"><span class="co"># }</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

