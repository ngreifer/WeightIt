<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Propensity Score Weighting Using BART — method_bart • WeightIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Propensity Score Weighting Using BART — method_bart"><meta name="description" content='This page explains the details of estimating weights from
Bayesian additive regression trees (BART)-based propensity scores by setting
method = "bart" in the call to weightit() or weightitMSM(). This method
can be used with binary, multi-category, and continuous treatments.
In general, this method relies on estimating propensity scores using BART and
then converting those propensity scores into weights using a formula that
depends on the desired estimand. This method relies on dbarts::bart2()
from the dbarts package.
Binary Treatments


For binary treatments, this method estimates the propensity scores using
dbarts::bart2(). The following estimands are allowed: ATE, ATT, ATC,
ATO, ATM, and ATOS. Weights can also be computed using marginal mean
weighting through stratification for the ATE, ATT, and ATC. See
get_w_from_ps() for details.



Multi-Category Treatments


For multi-category treatments, the propensity scores are estimated using
several calls to dbarts::bart2(), one for each treatment group; the
treatment probabilities are not normalized to sum to 1. The following
estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights for each
estimand are computed using the standard formulas or those mentioned above.
Weights can also be computed using marginal mean weighting through
stratification for the ATE, ATT, and ATC. See get_w_from_ps() for details.



Continuous Treatments


For continuous treatments, weights are estimated as
\(w_i = f_A(a_i) / f_{A|X}(a_i)\), where \(f_A(a_i)\) (known as the
stabilization factor) is the unconditional density of treatment evaluated the
observed treatment value and \(f_{A|X}(a_i)\) (known as the generalized
propensity score) is the conditional density of treatment given the
covariates evaluated at the observed value of treatment. The shape of
\(f_A(.)\) and \(f_{A|X}(.)\) is controlled by the density argument
described below (normal distributions by default), and the predicted values
used for the mean of the conditional density are estimated using BART as
implemented in dbarts::bart2(). Kernel density estimation can be used
instead of assuming a specific density for the numerator and denominator by
setting density = "kernel". Other arguments to density() can be specified
to refine the density estimation parameters.



Longitudinal Treatments


For longitudinal treatments, the weights are the product of the weights
estimated at each time point.



Sampling Weights


Sampling weights are not supported.



Missing Data


In the presence of missing data, the following value(s) for missing are
allowed:
"ind" (default)
First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is NA and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians. The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting weightit object will be the original covariates with the NAs.







M-estimation


M-estimation is not supported.

'><meta property="og:description" content='This page explains the details of estimating weights from
Bayesian additive regression trees (BART)-based propensity scores by setting
method = "bart" in the call to weightit() or weightitMSM(). This method
can be used with binary, multi-category, and continuous treatments.
In general, this method relies on estimating propensity scores using BART and
then converting those propensity scores into weights using a formula that
depends on the desired estimand. This method relies on dbarts::bart2()
from the dbarts package.
Binary Treatments


For binary treatments, this method estimates the propensity scores using
dbarts::bart2(). The following estimands are allowed: ATE, ATT, ATC,
ATO, ATM, and ATOS. Weights can also be computed using marginal mean
weighting through stratification for the ATE, ATT, and ATC. See
get_w_from_ps() for details.



Multi-Category Treatments


For multi-category treatments, the propensity scores are estimated using
several calls to dbarts::bart2(), one for each treatment group; the
treatment probabilities are not normalized to sum to 1. The following
estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights for each
estimand are computed using the standard formulas or those mentioned above.
Weights can also be computed using marginal mean weighting through
stratification for the ATE, ATT, and ATC. See get_w_from_ps() for details.



Continuous Treatments


For continuous treatments, weights are estimated as
\(w_i = f_A(a_i) / f_{A|X}(a_i)\), where \(f_A(a_i)\) (known as the
stabilization factor) is the unconditional density of treatment evaluated the
observed treatment value and \(f_{A|X}(a_i)\) (known as the generalized
propensity score) is the conditional density of treatment given the
covariates evaluated at the observed value of treatment. The shape of
\(f_A(.)\) and \(f_{A|X}(.)\) is controlled by the density argument
described below (normal distributions by default), and the predicted values
used for the mean of the conditional density are estimated using BART as
implemented in dbarts::bart2(). Kernel density estimation can be used
instead of assuming a specific density for the numerator and denominator by
setting density = "kernel". Other arguments to density() can be specified
to refine the density estimation parameters.



Longitudinal Treatments


For longitudinal treatments, the weights are the product of the weights
estimated at each time point.



Sampling Weights


Sampling weights are not supported.



Missing Data


In the presence of missing data, the following value(s) for missing are
allowed:
"ind" (default)
First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is NA and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians. The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting weightit object will be the original covariates with the NAs.







M-estimation


M-estimation is not supported.

'><meta property="og:image" content="https://ngreifer.github.io/WeightIt/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WeightIt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/WeightIt.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/estimating-effects.html">Estimating Effects After Weighting</a></li>
    <li><a class="dropdown-item" href="../articles/installing-packages.html">Installing Supporting Packages</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/WeightIt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Propensity Score Weighting Using BART</h1>
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/WeightIt/blob/master/R/weightit2bart.R" class="external-link"><code>R/weightit2bart.R</code></a></small>
      <div class="d-none name"><code>method_bart.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This page explains the details of estimating weights from
Bayesian additive regression trees (BART)-based propensity scores by setting
<code>method = "bart"</code> in the call to <code><a href="weightit.html">weightit()</a></code> or <code><a href="weightitMSM.html">weightitMSM()</a></code>. This method
can be used with binary, multi-category, and continuous treatments.</p>
<p>In general, this method relies on estimating propensity scores using BART and
then converting those propensity scores into weights using a formula that
depends on the desired estimand. This method relies on <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">dbarts::bart2()</a></code>
from the <a href="https://CRAN.R-project.org/package=dbarts" class="external-link"><span class="pkg">dbarts</span></a> package.</p><div class="section">
<h3 id="binary-treatments">Binary Treatments<a class="anchor" aria-label="anchor" href="#binary-treatments"></a></h3>


<p>For binary treatments, this method estimates the propensity scores using
<code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">dbarts::bart2()</a></code>. The following estimands are allowed: ATE, ATT, ATC,
ATO, ATM, and ATOS. Weights can also be computed using marginal mean
weighting through stratification for the ATE, ATT, and ATC. See
<code><a href="get_w_from_ps.html">get_w_from_ps()</a></code> for details.</p>
</div>

<div class="section">
<h3 id="multi-category-treatments">Multi-Category Treatments<a class="anchor" aria-label="anchor" href="#multi-category-treatments"></a></h3>


<p>For multi-category treatments, the propensity scores are estimated using
several calls to <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">dbarts::bart2()</a></code>, one for each treatment group; the
treatment probabilities are not normalized to sum to 1. The following
estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights for each
estimand are computed using the standard formulas or those mentioned above.
Weights can also be computed using marginal mean weighting through
stratification for the ATE, ATT, and ATC. See <code><a href="get_w_from_ps.html">get_w_from_ps()</a></code> for details.</p>
</div>

<div class="section">
<h3 id="continuous-treatments">Continuous Treatments<a class="anchor" aria-label="anchor" href="#continuous-treatments"></a></h3>


<p>For continuous treatments, weights are estimated as
\(w_i = f_A(a_i) / f_{A|X}(a_i)\), where \(f_A(a_i)\) (known as the
stabilization factor) is the unconditional density of treatment evaluated the
observed treatment value and \(f_{A|X}(a_i)\) (known as the generalized
propensity score) is the conditional density of treatment given the
covariates evaluated at the observed value of treatment. The shape of
\(f_A(.)\) and \(f_{A|X}(.)\) is controlled by the <code>density</code> argument
described below (normal distributions by default), and the predicted values
used for the mean of the conditional density are estimated using BART as
implemented in <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">dbarts::bart2()</a></code>. Kernel density estimation can be used
instead of assuming a specific density for the numerator and denominator by
setting <code>density = "kernel"</code>. Other arguments to <code><a href="https://rdrr.io/r/stats/density.html" class="external-link">density()</a></code> can be specified
to refine the density estimation parameters.</p>
</div>

<div class="section">
<h3 id="longitudinal-treatments">Longitudinal Treatments<a class="anchor" aria-label="anchor" href="#longitudinal-treatments"></a></h3>


<p>For longitudinal treatments, the weights are the product of the weights
estimated at each time point.</p>
</div>

<div class="section">
<h3 id="sampling-weights">Sampling Weights<a class="anchor" aria-label="anchor" href="#sampling-weights"></a></h3>


<p>Sampling weights are not supported.</p>
</div>

<div class="section">
<h3 id="missing-data">Missing Data<a class="anchor" aria-label="anchor" href="#missing-data"></a></h3>


<p>In the presence of missing data, the following value(s) for <code>missing</code> are
allowed:</p><dl><dt><code>"ind"</code> (default)</dt>
<dd><p>First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is <code>NA</code> and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians. The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting <code>weightit</code> object will be the original covariates with the <code>NA</code>s.</p></dd>


</dl></div>

<div class="section">
<h3 id="m-estimation">M-estimation<a class="anchor" aria-label="anchor" href="#m-estimation"></a></h3>


<p>M-estimation is not supported.</p>
</div>

    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>BART works by fitting a sum-of-trees model for the treatment or
probability of treatment. The number of trees is determined by the <code>n.trees</code>
argument. Bayesian priors are used for the hyperparameters, so the result is
a posterior distribution of predicted values for each unit. The mean of these
for each unit is taken for use in computing the (generalized) propensity
score. Although the hyperparameters governing the priors can be modified by
supplying arguments to <code><a href="weightit.html">weightit()</a></code> that are passed to the BART fitting
function, the default values tend to work well and require little
modification (though the defaults differ for continuous and categorical
treatments; see the <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">dbarts::bart2()</a></code> documentation for details). Unlike
many other machine learning methods, no loss function is optimized and the
hyperparameters do not need to be tuned (e.g., using cross-validation),
though performance can benefit from tuning. BART tends to balance sparseness
with flexibility by using very weak learners as the trees, which makes it
suitable for capturing complex functions without specifying a particular
functional form and without overfitting.</p><div class="section">
<h3 id="reproducibility">Reproducibility<a class="anchor" aria-label="anchor" href="#reproducibility"></a></h3>


<p>BART has a random component, so some work must be done to ensure
reproducibility across runs. See the <em>Reproducibility</em> section at
<code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">dbarts::bart2()</a></code> for more details. To ensure reproducibility, one can
do one of two things:</p><ol><li><p>supply an argument to <code>seed</code>, which is passed to <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">dbarts::bart2()</a></code> and sets the seed for single- and multi-threaded uses, or</p></li>
<li><p>call <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> and set <code>n.threads = 1</code> to use single-threading.
Note that to ensure reproducibility on any machine, regardless of the number of
cores available, one should use single-threading by setting <code>n.threads = 1</code> and either supply <code>seed</code> or
call <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code>.</p></li>
</ol></div>

    </div>
    <div class="section level2">
    <h2 id="additional-arguments">Additional Arguments<a class="anchor" aria-label="anchor" href="#additional-arguments"></a></h2>



<p>All arguments to <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">dbarts::bart2()</a></code> can be passed through <code><a href="weightit.html">weightit()</a></code>
or <code><a href="weightitMSM.html">weightitMSM()</a></code>, with the following exceptions:</p><ul><li><p><code>test</code>, <code>weights</code>,<code>subset</code>, <code>offset.test</code> are ignored</p></li>
<li><p><code>combine.chains</code> is always set to <code>TRUE</code></p></li>
<li><p><code>sampleronly</code> is always set to <code>FALSE</code></p></li>
</ul><p>For binary and multi-category treatments, the following arguments may be supplied:</p><dl><dt><code>subclass</code></dt>
<dd><p><code>integer</code>; the number of subclasses to use for computing
weights using marginal mean weighting through stratification (MMWS). If <code>NULL</code>,
standard inverse probability weights (and their extensions) will be
computed; if a number greater than 1, subclasses will be formed and weights
will be computed based on subclass membership. See <code><a href="get_w_from_ps.html">get_w_from_ps()</a></code> for
details and references.</p></dd>


</dl><p>For continuous treatments, the following arguments may be supplied:</p><dl><dt><code>density</code></dt>
<dd><p>A function corresponding to the conditional density of the treatment. The standardized residuals of the treatment model will be fed through this function to produce the numerator and denominator of the generalized propensity score weights. If blank, <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm()</a></code> is used as recommended by Robins et al. (2000). This can also be supplied as a string containing the name of the function to be called. If the string contains underscores, the call will be split by the underscores and the latter splits will be supplied as arguments to the second argument and beyond. For example, if <code>density = "dt_2"</code> is specified, the density used will be that of a t-distribution with 2 degrees of freedom. Using a t-distribution can be useful when extreme outcome values are observed (Naimi et al., 2014).</p>
<p>Can also be <code>"kernel"</code> to use kernel density estimation, which calls <code><a href="https://rdrr.io/r/stats/density.html" class="external-link">density()</a></code> to estimate the numerator and denominator densities for the weights. (This used to be requested by setting <code>use.kernel = TRUE</code>, which is now deprecated.)</p></dd>

<dt><code>bw</code>, <code>adjust</code>, <code>kernel</code>, <code>n</code></dt>
<dd><p>If <code>density = "kernel"</code>, the arguments to <code><a href="https://rdrr.io/r/stats/density.html" class="external-link">density()</a></code>. The defaults are the same as those in <code><a href="https://rdrr.io/r/stats/density.html" class="external-link">density()</a></code> except that <code>n</code> is 10 times the number of units in the sample.</p></dd>

<dt><code>plot</code></dt>
<dd><p>If <code>density = "kernel"</code>, whether to plot the estimated densities.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="additional-outputs">Additional Outputs<a class="anchor" aria-label="anchor" href="#additional-outputs"></a></h2>


<dl><dt><code>obj</code></dt>
<dd><p>When <code>include.obj = TRUE</code>, the <code>bart2</code> fit(s) used to generate the predicted values. With multi-category treatments, this will be a list of the fits; otherwise, it will be a single fit. The predicted probabilities used to compute the propensity scores can be extracted using <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code>.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Hill, J., Weiss, C., &amp; Zhai, F. (2011). Challenges With
Propensity Score Strategies in a High-Dimensional Setting and a Potential
Alternative. <em>Multivariate Behavioral Research</em>, 46(3), 477–513.
<a href="https://doi.org/10.1080/00273171.2011.570161" class="external-link">doi:10.1080/00273171.2011.570161</a></p>
<p>Chipman, H. A., George, E. I., &amp; McCulloch, R. E. (2010). BART: Bayesian
additive regression trees. <em>The Annals of Applied Statistics</em>, 4(1), 266–298.
<a href="https://doi.org/10.1214/09-AOAS285" class="external-link">doi:10.1214/09-AOAS285</a></p>
<p>Note that many references that deal with BART for causal inference focus on
estimating potential outcomes with BART, not the propensity scores, and so
are not directly relevant when using BART to estimate propensity scores for
weights.</p>
<p>See <code><a href="method_glm.html">method_glm</a></code> for additional references on propensity score weighting
more generally.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="weightit.html">weightit()</a></code>, <code><a href="weightitMSM.html">weightitMSM()</a></code>, <code><a href="get_w_from_ps.html">get_w_from_ps()</a></code></p>
<p><code><a href="method_super.html">method_super</a></code> for stacking predictions from several machine learning
methods, including BART.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates between treatment groups (binary)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"bart"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "bart" (propensity score weighting with BART)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Min                                 Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.       ||                         1.   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.003 |---------------------------| 9.419</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              1     2     3     4     5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated     1     1     1     1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            423   407   384   269   189</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 2.287 2.806 3.081 3.295 9.419</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated       0.000 0.000   0.000       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control       1.806 0.933   0.733       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    100.85     185</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score Distance   0.4907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age         Contin.   0.0630</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ        Contin.  -0.0285</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      Binary  -0.0327</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     Binary   0.0345</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        Contin.  -0.0483</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted    100.85     185</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates with respect to race (multi-category)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">race</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"bart"</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "bart" (propensity score weighting with BART)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 3-category (black, hispan, white)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Min                                  Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> black  1.223 |-----------------|            9.423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hispan 2.661    |------------------------| 13.382</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> white  1.065 |--------------|               7.999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           192    166    164    163    152</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   black 7.041   7.43  7.643  8.618  9.423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            69     67     59     50     37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  hispan 12.14 12.194 12.479 12.864 13.382</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            15      7      6      5      3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   white  4.56  4.887   5.52  7.735  7.999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> black        0.587 0.379   0.129       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hispan       0.379 0.315   0.072       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> white        0.453 0.317   0.082       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             black hispan white</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted 243.    72.   299. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted   180.93  63.05 248.3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance summary across all treatment pairs</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Max.Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.       0.1854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.       0.1598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary       0.0536</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary       0.0269</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.       0.1168</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             black hispan white</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 243.    72.   299. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   180.93  63.05 248.3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates with respect to re75 (continuous)</span></span></span>
<span class="r-in"><span><span class="co">#assuming t(3) conditional density for treatment</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W3</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">re75</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"bart"</span>, density <span class="op">=</span> <span class="st">"dt_3"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "bart" (propensity score weighting with BART)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: continuous</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Min                                 Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> all 0.08 |---------------------------| 19.05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       490   487   486   484   469</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  all 7.57 8.601 8.933 16.86 19.05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> all         1.1 0.474   0.272       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted 614.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted   277.95</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Corr.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.   0.0320</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.   0.0599</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary   0.0818</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary  -0.0839</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.   0.1200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 614.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   277.95</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

