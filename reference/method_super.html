<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Propensity Score Weighting Using SuperLearner — method_super • WeightIt</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Propensity Score Weighting Using SuperLearner — method_super" />
<meta property="og:description" content="This page explains the details of estimating weights from SuperLearner-based propensity scores by setting method = &quot;super&quot; in the call to weightit() or weightitMSM(). This method can be used with binary, multinomial, and continuous treatments.
In general, this method relies on estimating propensity scores using the SuperLearner algorithm for stacking predictions and then converting those propensity scores into weights using a formula that depends on the desired estimand. For binary and multinomial treatments, one or more binary classification algorithms are used to estimate the propensity scores as the predicted probability of being in each treatment given the covariates. For continuous treatments, regression algorithms are used to estimate generalized propensity scores as the conditional density of treatment given the covariates. This method relies on SuperLearner() from the SuperLearner package.
Binary Treatments
For binary treatments, this method estimates the propensity scores using SuperLearner(). The following estimands are allowed: ATE, ATT, ATC, ATO, ATM, and ATOS. Weights can also be computed using marginal mean weighting through stratification for the ATE, ATT, and ATC. See get_w_from_ps() for details.
Multinomial Treatments
For multinomial treatments, the propensity scores are estimated using several calls to SuperLearner(), one for each treatment group; the treatment probabilities are not normalized to sum to 1. The following estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights for each estimand are computed using the standard formulas or those mentioned above. Weights can also be computed using marginal mean weighting through stratification for the ATE, ATT, and ATC. See get_w_from_ps() for details.
Continuous Treatments
For continuous treatments, the generalized propensity score is estimated using SuperLearner(). In addition, kernel density estimation can be used instead of assuming a normal density for the numerator and denominator of the generalized propensity score by setting use.kernel = TRUE. Other arguments to density() can be specified to refine the density estimation parameters. plot = TRUE can be specified to plot the density for the numerator and denominator, which can be helpful in diagnosing extreme weights.
Longitudinal Treatments
For longitudinal treatments, the weights are the product of the weights estimated at each time point.
Sampling Weights
Sampling weights are supported through s.weights in all scenarios.
Missing Data
In the presence of missing data, the following value(s) for missing are allowed:
&quot;ind&quot; (default)First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is NA and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with 0s. The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting weightit object will be the original covariates with the NAs.



" />
<meta property="og:image" content="/logo.png" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WeightIt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/WeightIt.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ngreifer/WeightIt/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Propensity Score Weighting Using SuperLearner</h1>
    
    <div class="hidden name"><code>method_super.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This page explains the details of estimating weights from SuperLearner-based propensity scores by setting <code>method = "super"</code> in the call to <code><a href='weightit.html'>weightit()</a></code> or <code><a href='weightitMSM.html'>weightitMSM()</a></code>. This method can be used with binary, multinomial, and continuous treatments.</p>
<p>In general, this method relies on estimating propensity scores using the SuperLearner algorithm for stacking predictions and then converting those propensity scores into weights using a formula that depends on the desired estimand. For binary and multinomial treatments, one or more binary classification algorithms are used to estimate the propensity scores as the predicted probability of being in each treatment given the covariates. For continuous treatments, regression algorithms are used to estimate generalized propensity scores as the conditional density of treatment given the covariates. This method relies on <code><a href='https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html'>SuperLearner()</a></code> from the <a href='https://CRAN.R-project.org/package=SuperLearner'><span class="pkg">SuperLearner</span></a> package.</p>
<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Binary Treatments</h3>
<p>For binary treatments, this method estimates the propensity scores using <code><a href='https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html'>SuperLearner()</a></code>. The following estimands are allowed: ATE, ATT, ATC, ATO, ATM, and ATOS. Weights can also be computed using marginal mean weighting through stratification for the ATE, ATT, and ATC. See <code><a href='get_w_from_ps.html'>get_w_from_ps()</a></code> for details.</p>
<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Multinomial Treatments</h3>
<p>For multinomial treatments, the propensity scores are estimated using several calls to <code><a href='https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html'>SuperLearner()</a></code>, one for each treatment group; the treatment probabilities are not normalized to sum to 1. The following estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights for each estimand are computed using the standard formulas or those mentioned above. Weights can also be computed using marginal mean weighting through stratification for the ATE, ATT, and ATC. See <code><a href='get_w_from_ps.html'>get_w_from_ps()</a></code> for details.</p>
<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Continuous Treatments</h3>
<p>For continuous treatments, the generalized propensity score is estimated using <code><a href='https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html'>SuperLearner()</a></code>. In addition, kernel density estimation can be used instead of assuming a normal density for the numerator and denominator of the generalized propensity score by setting <code>use.kernel = TRUE</code>. Other arguments to <code><a href='https://rdrr.io/r/stats/density.html'>density()</a></code> can be specified to refine the density estimation parameters. <code>plot = TRUE</code> can be specified to plot the density for the numerator and denominator, which can be helpful in diagnosing extreme weights.</p>
<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Longitudinal Treatments</h3>
<p>For longitudinal treatments, the weights are the product of the weights estimated at each time point.</p>
<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Sampling Weights</h3>
<p>Sampling weights are supported through <code>s.weights</code> in all scenarios.</p>
<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Missing Data</h3>
<p>In the presence of missing data, the following value(s) for <code>missing</code> are allowed:</p><dl>
<dt><code>"ind"</code> (default)</dt><dd><p>First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is <code>NA</code> and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with 0s. The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting <code>weightit</code> object will be the original covariates with the <code>NA</code>s.</p></dd>

</dl>


    </div>



    <h2 class="hasAnchor" id="additional-arguments"><a class="anchor" href="#additional-arguments"></a>Additional Arguments</h2>

    
<dl>
<dt><code>discrete</code></dt><dd><p>if <code>TRUE</code>, uses discrete SuperLearner, which simply selects the best performing method. Default <code>FALSE</code>, which finds the optimal combination of predictions for the libraries using <code>SL.method</code>.</p></dd>

</dl>

<p>An argument to <code>SL.library</code> <strong>must</strong> be supplied. To see a list of available entries, use <code><a href='https://rdrr.io/pkg/SuperLearner/man/listWrappers.html'>listWrappers()</a></code>.</p>
<p>All arguments to <code><a href='https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html'>SuperLearner()</a></code> can be passed through <code><a href='weightit.html'>weightit()</a></code> or <code><a href='weightitMSM.html'>weightitMSM()</a></code>, with the following exceptions:</p><ul>
<li><p><code>obsWeights</code> is ignored because sampling weights are passed using <code>s.weights</code>.</p></li>
<li><p><code>method</code> in <code>SuperLearner()</code> is replaced with the argument <code>SL.method</code> in <code><a href='weightit.html'>weightit()</a></code>.</p></li>
</ul>

<p>For continuous treatments only, the following arguments may be supplied:</p><dl>
<dt><code>density</code></dt><dd><p>A function corresponding to the conditional density of the treatment. The standardized residuals of the treatment model will be fed through this function to produce the numerator and denominator of the generalized propensity score weights. If blank, <code><a href='https://rdrr.io/r/stats/Normal.html'>dnorm()</a></code> is used as recommended by Robins et al. (2000). This can also be supplied as a string containing the name of the function to be called. If the string contains underscores, the call will be split by the underscores and the latter splits will be supplied as arguments to the second argument and beyond. For example, if <code>density = "dt_2"</code> is specified, the density used will be that of a t-distribution with 2 degrees of freedom. Using a t-distribution can be useful when extreme outcome values are observed (Naimi et al., 2014). Ignored if <code>use.kernel = TRUE</code> (described below).</p></dd>
<dt><code>use.kernel</code></dt><dd><p>If <code>TRUE</code>, uses kernel density estimation through the <code><a href='https://rdrr.io/r/stats/density.html'>density()</a></code> function to estimate the numerator and denominator densities for the weights. If <code>FALSE</code>, the argument to the <code>density</code> parameter is used instead.</p></dd>
<dt><code>bw</code>, <code>adjust</code>, <code>kernel</code>, <code>n</code></dt><dd><p>If <code>use.kernel = TRUE</code>, the arguments to the <code><a href='https://rdrr.io/r/stats/density.html'>density()</a></code> function. The defaults are the same as those in <code>density</code> except that <code>n</code> is 10 times the number of units in the sample.</p></dd>
<dt><code>plot</code></dt><dd><p>If <code>use.kernel = TRUE</code>, whether to plot the estimated density.</p></dd>

</dl>

<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Balance SuperLearner</h3>
<p>In addition to the methods allowed by <code>SuperLearner()</code>, one can specify <code>SL.method = "method.balance"</code> to use "Balance SuperLearner" as described by Pirracchio and Carone (2018), wherein covariate balance is used to choose the optimal combination of the predictions from the methods specified with <code>SL.library</code>. Coefficients are chosen (one for each prediction method) so that the weights generated from the weighted combination of the predictions optimize a balance criterion, which must be set with the <code>stop.method</code> argument, described below.</p><dl>
<dt><code>stop.method</code></dt><dd><p>A string describing the balance criterion used to select the best weights. See <code><a href='stop.method.html'>stop.method</a></code> for allowable options for each treatment type. For binary and multinomial treatments, the default is <code>"es.mean"</code>, which minimizes the average absolute standard mean difference among the covariates between treatment groups. For continuous treatments, the default is <code>"p.mean"</code>, which minimizes the average absolute Pearson correlation between the treatment and covariates.</p></dd>

</dl><p>Note that this implementation differs from that of Pirracchio and Carone (2018) in that here, balance is measured only on the terms included in the model formula (i.e., and not their interactions unless specifically included), and balance results from a sample weighted using the estimated predicted values as propensity scores, not a sample matched using propensity score matching on the predicted values. Binary and continuous treatments are supported, but currently multinomial treatments are not.</p>

    <h2 class="hasAnchor" id="additional-outputs"><a class="anchor" href="#additional-outputs"></a>Additional Outputs</h2>

    
<dl>
<dt><code>info</code></dt><dd><p>For binary and continuous treatments, a list with two entries, <code>coef</code> and <code>cvRisk</code>. For multinomial treatments, a list of lists with these two entries, one for each treatment level.
<dl>
<dt><code>coef</code></dt><dd><p>The coefficients in the linear combination of the predictions from each method in <code>SL.library</code>. Higher values indicate that the corresponding method plays a larger role in determining the resulting predicted value, and values close to zero indicate that the method plays little role in determining the predicted value. When <code>discrete = TRUE</code>, these correspond to the coefficients that would have been estimated had <code>discrete</code> been <code>FALSE</code>.</p></dd>
<dt><code>cvRisk</code></dt><dd><p>The cross-validation risk for each method in <code>SL.library</code>. Higher values indicate that the method has worse cross-validation accuracy. When <code>SL.method = "method.balance"</code>, the sample weighted balance statistic requested with <code>stop.method</code>. Higher values indicate worse balance.</p></dd></dl></p></dd>
<dt><code>obj</code></dt><dd><p>When <code>include.obj = TRUE</code>, the SuperLearner fit(s) used to generate the predicted values. For binary and continuous treatments, the output of the call to <code><a href='https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html'>SuperLearner::SuperLearner()</a></code>. For multinomial treatments, a list of outputs to calls to <code><a href='https://rdrr.io/pkg/SuperLearner/man/SuperLearner.html'>SuperLearner::SuperLearner()</a></code>.</p></dd>

</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>SuperLearner works by fitting several machine learning models to the treatment and covariates and then taking a weighted combination of the generated predicted values to use as the propensity scores, which are then used to construct weights. The machine learning models used are supplied using the <code>SL.library</code> argument; the more models are supplied, the higher the chance of correctly modeling the propensity score. The predicted values are combined using the method supplied in the <code>SL.method</code> argument (which is nonnegative least squares by default). A benefit of SuperLearner is that, asymptotically, it is guaranteed to perform as well as or better than the best-performing method included in the library. Using Balance SuperLearner by setting <code>SL.method = "method.balance"</code> works by selecting the combination of predicted values that minimizes an imbalance measure.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p><strong>Binary treatments</strong></p>
<p>Pirracchio, R., Petersen, M. L., &amp; van der Laan, M. (2015). Improving Propensity Score Estimators’ Robustness to Model Misspecification Using Super Learner. American Journal of Epidemiology, 181(2), 108–119. doi: <a href='https://doi.org/10.1093/aje/kwu253'>10.1093/aje/kwu253</a></p>
<p><strong>Continuous treatments</strong></p>
<p>Kreif, N., Grieve, R., Díaz, I., &amp; Harrison, D. (2015). Evaluation of the Effect of a Continuous Treatment: A Machine Learning Approach with an Application to Treatment for Traumatic Brain Injury. Health Economics, 24(9), 1213–1228. doi: <a href='https://doi.org/10.1002/hec.3189'>10.1002/hec.3189</a></p>
<p>- Balance SuperLearner (<code>SL.method = "method.balance"</code>)</p>
<p>Pirracchio, R., &amp; Carone, M. (2018). The Balance Super Learner: A robust adaptation of the Super Learner to improve estimation of the average treatment effect in the treated based on propensity score matching. Statistical Methods in Medical Research, 27(8), 2504–2518. doi: <a href='https://doi.org/10.1177/0962280216682055'>10.1177/0962280216682055</a></p>
<p>See <code><a href='method_ps.html'>method_ps</a></code> for additional references.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='weightit.html'>weightit()</a></code>, <code><a href='weightitMSM.html'>weightitMSM()</a></code>, <code><a href='get_w_from_ps.html'>get_w_from_ps()</a></code></p>
<p><code><a href='stop.method.html'>stop.method</a></code> for allowable arguments to <code>stop.method</code> when using <code>SL.method = "method.balance"</code></p></div>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Some methods formerly available in <span class="pkg">SuperLearner</span> are now in <span class="pkg">SuperLearnerExtra</span>, which can be found on GitHub at <a href='https://github.com/ecpolley/SuperLearnerExtra'>https://github.com/ecpolley/SuperLearnerExtra</a>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://ngreifer.github.io/cobalt/'>"cobalt"</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"lalonde"</span>, package <span class='op'>=</span> <span class='st'>"cobalt"</span><span class='op'>)</span>

<span class='co'>#Balancing covariates between treatment groups (binary)</span>
<span class='op'>(</span><span class='va'>W1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='weightit.html'>weightit</a></span><span class='op'>(</span><span class='va'>treat</span> <span class='op'>~</span> <span class='va'>age</span> <span class='op'>+</span> <span class='va'>educ</span> <span class='op'>+</span> <span class='va'>married</span> <span class='op'>+</span>
                  <span class='va'>nodegree</span> <span class='op'>+</span> <span class='va'>re74</span>, data <span class='op'>=</span> <span class='va'>lalonde</span>,
                method <span class='op'>=</span> <span class='st'>"super"</span>, estimand <span class='op'>=</span> <span class='st'>"ATT"</span>,
                SL.library <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"SL.glm"</span>, <span class='st'>"SL.stepAIC"</span>,
                               <span class='st'>"SL.glm.interaction"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Loading required package: nnls</span></div><div class='output co'>#&gt; A <span style='font-style: italic;'>weightit</span><span> object
#&gt;  - method: "super" (propensity score weighting with SuperLearner)
#&gt;  - number of obs.: 614
#&gt;  - sampling weights: none
#&gt;  - treatment: 2-category
#&gt;  - estimand: ATT (focal: 1)
#&gt;  - covariates: age, educ, married, nodegree, re74</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>W1</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                  </span><span style='text-decoration: underline;'>Summary of weights</span><span>
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight ranges</span><span>:
#&gt; 
#&gt;            Min                                  Max
#&gt; treated 1.0000      ||                       1.0000
#&gt; control 0.0062 |---------------------------| 5.6573
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Units with 5 greatest weights by group</span><span>:
#&gt;                                            
#&gt;               2      4      5      6      7
#&gt;  treated      1      1      1      1      1
#&gt;             589    411    409    296    269
#&gt;  control 2.4116 2.5004 2.7322 3.3402 5.6573
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight statistics</span><span>:
#&gt; 
#&gt;         Coef of Var   MAD Entropy # Zeros
#&gt; treated       0.000 0.000  -0.000       0
#&gt; control       1.116 0.738   0.442       0
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Effective Sample Sizes</span><span>:
#&gt; 
#&gt;            Control Treated
#&gt; Unweighted  429.       185
#&gt; Weighted    191.27     185</div><div class='input'><span class='fu'><a href='https://ngreifer.github.io/cobalt/reference/bal.tab.html'>bal.tab</a></span><span class='op'>(</span><span class='va'>W1</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='text-decoration: underline;'>Call</span><span>
#&gt;  weightit(formula = treat ~ age + educ + married + nodegree + 
#&gt;     re74, data = lalonde, method = "super", estimand = "ATT", 
#&gt;     SL.library = c("SL.glm", "SL.stepAIC", "SL.glm.interaction"))
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Balance Measures</span><span>
#&gt;                Type Diff.Adj
#&gt; prop.score Distance   0.0599
#&gt; age         Contin.  -0.1408
#&gt; educ        Contin.   0.0167
#&gt; married      Binary  -0.0049
#&gt; nodegree     Binary   0.0123
#&gt; re74        Contin.  -0.0251
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Effective sample sizes</span><span>
#&gt;            Control Treated
#&gt; Unadjusted  429.       185
#&gt; Adjusted    191.27     185</div><div class='input'>
<span class='co'>#Balancing covariates with respect to race (multinomial)</span>
<span class='op'>(</span><span class='va'>W2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='weightit.html'>weightit</a></span><span class='op'>(</span><span class='va'>race</span> <span class='op'>~</span> <span class='va'>age</span> <span class='op'>+</span> <span class='va'>educ</span> <span class='op'>+</span> <span class='va'>married</span> <span class='op'>+</span>
                  <span class='va'>nodegree</span> <span class='op'>+</span> <span class='va'>re74</span>, data <span class='op'>=</span> <span class='va'>lalonde</span>,
                method <span class='op'>=</span> <span class='st'>"super"</span>, estimand <span class='op'>=</span> <span class='st'>"ATE"</span>,
                SL.library <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"SL.glm"</span>, <span class='st'>"SL.stepAIC"</span>,
                               <span class='st'>"SL.glm.interaction"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; A </span><span style='font-style: italic;'>weightit</span><span> object
#&gt;  - method: "super" (propensity score weighting with SuperLearner)
#&gt;  - number of obs.: 614
#&gt;  - sampling weights: none
#&gt;  - treatment: 3-category (black, hispan, white)
#&gt;  - estimand: ATE
#&gt;  - covariates: age, educ, married, nodegree, re74</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>W2</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                  </span><span style='text-decoration: underline;'>Summary of weights</span><span>
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight ranges</span><span>:
#&gt; 
#&gt;           Min                                   Max
#&gt; black  1.3125 |-------------------|         14.0815
#&gt; hispan 1.7509  |--------------------------| 19.0788
#&gt; white  1.0815 |----|                         4.9344
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Units with 5 greatest weights by group</span><span>:
#&gt;                                                
#&gt;             485     244     184     182     181
#&gt;   black  7.5917  7.7461 10.1133 11.6337 14.0815
#&gt;             392     371     346     345     269
#&gt;  hispan 16.6957 17.1862 17.2636 17.8517 19.0788
#&gt;             589     457     409     296      23
#&gt;   white  4.0945  4.1846  4.3505  4.6072  4.9344
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight statistics</span><span>:
#&gt; 
#&gt;        Coef of Var   MAD Entropy # Zeros
#&gt; black        0.640 0.391   0.138       0
#&gt; hispan       0.476 0.372   0.110       0
#&gt; white        0.388 0.317   0.069       0
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Effective Sample Sizes</span><span>:
#&gt; 
#&gt;             black hispan  white
#&gt; Unweighted 243.    72.   299.  
#&gt; Weighted   172.57  58.85 260.06</div><div class='input'><span class='fu'><a href='https://ngreifer.github.io/cobalt/reference/bal.tab.html'>bal.tab</a></span><span class='op'>(</span><span class='va'>W2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='text-decoration: underline;'>Call</span><span>
#&gt;  weightit(formula = race ~ age + educ + married + nodegree + re74, 
#&gt;     data = lalonde, method = "super", estimand = "ATE", SL.library = c("SL.glm", 
#&gt;         "SL.stepAIC", "SL.glm.interaction"))
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Balance summary across all treatment pairs</span><span>
#&gt;             Type Max.Diff.Adj
#&gt; age      Contin.       0.0968
#&gt; educ     Contin.       0.0794
#&gt; married   Binary       0.0450
#&gt; nodegree  Binary       0.0246
#&gt; re74     Contin.       0.0328
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Effective sample sizes</span><span>
#&gt;             black hispan  white
#&gt; Unadjusted 243.    72.   299.  
#&gt; Adjusted   172.57  58.85 260.06</div><div class='input'>
<span class='co'>#Balancing covariates with respect to re75 (continuous)</span>
<span class='co'>#assuming t(8) conditional density for treatment</span>
<span class='op'>(</span><span class='va'>W3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='weightit.html'>weightit</a></span><span class='op'>(</span><span class='va'>re75</span> <span class='op'>~</span> <span class='va'>age</span> <span class='op'>+</span> <span class='va'>educ</span> <span class='op'>+</span> <span class='va'>married</span> <span class='op'>+</span>
                  <span class='va'>nodegree</span> <span class='op'>+</span> <span class='va'>re74</span>, data <span class='op'>=</span> <span class='va'>lalonde</span>,
                method <span class='op'>=</span> <span class='st'>"super"</span>, density <span class='op'>=</span> <span class='st'>"dt_8"</span>,
                SL.library <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"SL.glm"</span>, <span class='st'>"SL.ridge"</span>,
                               <span class='st'>"SL.glm.interaction"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; A </span><span style='font-style: italic;'>weightit</span><span> object
#&gt;  - method: "super" (propensity score weighting with SuperLearner)
#&gt;  - number of obs.: 614
#&gt;  - sampling weights: none
#&gt;  - treatment: continuous
#&gt;  - covariates: age, educ, married, nodegree, re74</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>W3</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                  </span><span style='text-decoration: underline;'>Summary of weights</span><span>
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight ranges</span><span>:
#&gt; 
#&gt;        Min                                   Max
#&gt; all 0.0439 |---------------------------| 21.0528
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Units with 5 greatest weights by group</span><span>:
#&gt;                                           
#&gt;         485    484     483     431     354
#&gt;  all 9.4162 16.527 18.1028 19.0692 21.0528
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight statistics</span><span>:
#&gt; 
#&gt;     Coef of Var   MAD Entropy # Zeros
#&gt; all       1.334 0.504   0.341       0
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Effective Sample Sizes</span><span>:
#&gt; 
#&gt;             Total
#&gt; Unweighted 614.  
#&gt; Weighted   221.04</div><div class='input'><span class='fu'><a href='https://ngreifer.github.io/cobalt/reference/bal.tab.html'>bal.tab</a></span><span class='op'>(</span><span class='va'>W3</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='text-decoration: underline;'>Call</span><span>
#&gt;  weightit(formula = re75 ~ age + educ + married + nodegree + re74, 
#&gt;     data = lalonde, method = "super", density = "dt_8", SL.library = c("SL.glm", 
#&gt;         "SL.ridge", "SL.glm.interaction"))
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Balance Measures</span><span>
#&gt;             Type Corr.Adj
#&gt; age      Contin.   0.0311
#&gt; educ     Contin.   0.0348
#&gt; married   Binary   0.0613
#&gt; nodegree  Binary  -0.0599
#&gt; re74     Contin.   0.0405
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Effective sample sizes</span><span>
#&gt;             Total
#&gt; Unadjusted 614.  
#&gt; Adjusted   221.04</div><div class='input'>
<span class='co'>#Balancing covariates between treatment groups (binary)</span>
<span class='co'># using balance SuperLearner to minimize the average</span>
<span class='co'># KS statistic</span>
<span class='op'>(</span><span class='va'>W4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='weightit.html'>weightit</a></span><span class='op'>(</span><span class='va'>treat</span> <span class='op'>~</span> <span class='va'>age</span> <span class='op'>+</span> <span class='va'>educ</span> <span class='op'>+</span> <span class='va'>married</span> <span class='op'>+</span>
                  <span class='va'>nodegree</span> <span class='op'>+</span> <span class='va'>re74</span>, data <span class='op'>=</span> <span class='va'>lalonde</span>,
                method <span class='op'>=</span> <span class='st'>"super"</span>, estimand <span class='op'>=</span> <span class='st'>"ATT"</span>,
                SL.library <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"SL.glm"</span>, <span class='st'>"SL.stepAIC"</span>,
                               <span class='st'>"SL.lda"</span><span class='op'>)</span>,
                SL.method <span class='op'>=</span> <span class='st'>"method.balance"</span>,
                stop.method <span class='op'>=</span> <span class='st'>"ks.mean"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; A </span><span style='font-style: italic;'>weightit</span><span> object
#&gt;  - method: "super" (propensity score weighting with SuperLearner)
#&gt;  - number of obs.: 614
#&gt;  - sampling weights: none
#&gt;  - treatment: 2-category
#&gt;  - estimand: ATT (focal: 1)
#&gt;  - covariates: age, educ, married, nodegree, re74</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>W4</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                  </span><span style='text-decoration: underline;'>Summary of weights</span><span>
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight ranges</span><span>:
#&gt; 
#&gt;            Min                                  Max
#&gt; treated 1.0000                    ||         1.0000
#&gt; control 0.0354 |---------------------------| 1.4688
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Units with 5 greatest weights by group</span><span>:
#&gt;                                            
#&gt;               1      2      3      4      5
#&gt;  treated      1      1      1      1      1
#&gt;             595    411    409    296    269
#&gt;  control 1.1051 1.1654 1.2041 1.2831 1.4688
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight statistics</span><span>:
#&gt; 
#&gt;         Coef of Var   MAD Entropy # Zeros
#&gt; treated       0.000 0.000  -0.000       0
#&gt; control       0.739 0.662   0.278       0
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Effective Sample Sizes</span><span>:
#&gt; 
#&gt;            Control Treated
#&gt; Unweighted  429.       185
#&gt; Weighted    277.67     185</div><div class='input'><span class='fu'><a href='https://ngreifer.github.io/cobalt/reference/bal.tab.html'>bal.tab</a></span><span class='op'>(</span><span class='va'>W4</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='text-decoration: underline;'>Call</span><span>
#&gt;  weightit(formula = treat ~ age + educ + married + nodegree + 
#&gt;     re74, data = lalonde, method = "super", estimand = "ATT", 
#&gt;     SL.library = c("SL.glm", "SL.stepAIC", "SL.lda"), SL.method = "method.balance", 
#&gt;     stop.method = "ks.mean")
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Balance Measures</span><span>
#&gt;                Type Diff.Adj
#&gt; prop.score Distance   0.0856
#&gt; age         Contin.   0.0855
#&gt; educ        Contin.  -0.0174
#&gt; married      Binary  -0.0045
#&gt; nodegree     Binary   0.0291
#&gt; re74        Contin.  -0.0760
#&gt; 
#&gt; </span><span style='text-decoration: underline;'>Effective sample sizes</span><span>
#&gt;            Control Treated
#&gt; Unadjusted  429.       185
#&gt; Adjusted    277.67     185</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


