<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Energy Balancing — method_energy • WeightIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Energy Balancing — method_energy"><meta name="description" content='This page explains the details of estimating weights using
energy balancing by setting method = "energy" in the call to weightit()
or weightitMSM(). This method can be used with binary, multi-category, and
continuous treatments.
In general, this method relies on estimating weights by minimizing an energy
statistic related to covariate balance. For binary and multi-category
treatments, this is the energy distance, which is a multivariate distance
between distributions, between the treatment groups. For continuous treatments,
this is the sum of the distance covariance between the treatment variable and
the covariates and the energy distances between the treatment and covariates
in the weighted sample and their distributions in the original sample. This
method relies on code written for WeightIt using osqp::osqp()
from the osqp package to perform the optimization. This method may
be slow or memory-intensive for large datasets.
Binary Treatments


For binary treatments, this method estimates the weights using osqp() using
formulas described by Huling and Mak (2024). The following estimands are
allowed: ATE, ATT, and ATC.



Multi-Category Treatments


For multi-category treatments, this method estimates the weights using
osqp() using formulas described by Huling and Mak (2024). The following
estimands are allowed: ATE and ATT.



Continuous Treatments


For continuous treatments, this method estimates the weights using osqp()
using formulas described by Huling, Greifer, and Chen (2023).



Longitudinal Treatments


For longitudinal treatments, the weights are the product of the weights
estimated at each time point. This method is not guaranteed to yield optimal
balance at each time point. NOTE: the use of energy balancing with longitudinal treatments has not been validated!



Sampling Weights


Sampling weights are supported through s.weights in all scenarios. In some
cases, sampling weights will cause the optimization to fail due to lack of
convexity or infeasible constraints.



Missing Data


In the presence of missing data, the following value(s) for missing are
allowed:
"ind" (default)
First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is NA and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians (this value is arbitrary and does not affect estimation). The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting weightit object will be the original covariates with the NAs.







M-estimation


M-estimation is not supported.

'><meta property="og:description" content='This page explains the details of estimating weights using
energy balancing by setting method = "energy" in the call to weightit()
or weightitMSM(). This method can be used with binary, multi-category, and
continuous treatments.
In general, this method relies on estimating weights by minimizing an energy
statistic related to covariate balance. For binary and multi-category
treatments, this is the energy distance, which is a multivariate distance
between distributions, between the treatment groups. For continuous treatments,
this is the sum of the distance covariance between the treatment variable and
the covariates and the energy distances between the treatment and covariates
in the weighted sample and their distributions in the original sample. This
method relies on code written for WeightIt using osqp::osqp()
from the osqp package to perform the optimization. This method may
be slow or memory-intensive for large datasets.
Binary Treatments


For binary treatments, this method estimates the weights using osqp() using
formulas described by Huling and Mak (2024). The following estimands are
allowed: ATE, ATT, and ATC.



Multi-Category Treatments


For multi-category treatments, this method estimates the weights using
osqp() using formulas described by Huling and Mak (2024). The following
estimands are allowed: ATE and ATT.



Continuous Treatments


For continuous treatments, this method estimates the weights using osqp()
using formulas described by Huling, Greifer, and Chen (2023).



Longitudinal Treatments


For longitudinal treatments, the weights are the product of the weights
estimated at each time point. This method is not guaranteed to yield optimal
balance at each time point. NOTE: the use of energy balancing with longitudinal treatments has not been validated!



Sampling Weights


Sampling weights are supported through s.weights in all scenarios. In some
cases, sampling weights will cause the optimization to fail due to lack of
convexity or infeasible constraints.



Missing Data


In the presence of missing data, the following value(s) for missing are
allowed:
"ind" (default)
First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is NA and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians (this value is arbitrary and does not affect estimation). The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting weightit object will be the original covariates with the NAs.







M-estimation


M-estimation is not supported.

'><meta property="og:image" content="https://ngreifer.github.io/WeightIt/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WeightIt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/WeightIt.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/estimating-effects.html">Estimating Effects After Weighting</a></li>
    <li><a class="dropdown-item" href="../articles/installing-packages.html">Installing Supporting Packages</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/WeightIt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Energy Balancing</h1>
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/WeightIt/blob/master/R/weightit2energy.R" class="external-link"><code>R/weightit2energy.R</code></a></small>
      <div class="d-none name"><code>method_energy.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This page explains the details of estimating weights using
energy balancing by setting <code>method = "energy"</code> in the call to <code><a href="weightit.html">weightit()</a></code>
or <code><a href="weightitMSM.html">weightitMSM()</a></code>. This method can be used with binary, multi-category, and
continuous treatments.</p>
<p>In general, this method relies on estimating weights by minimizing an energy
statistic related to covariate balance. For binary and multi-category
treatments, this is the energy distance, which is a multivariate distance
between distributions, between the treatment groups. For continuous treatments,
this is the sum of the distance covariance between the treatment variable and
the covariates and the energy distances between the treatment and covariates
in the weighted sample and their distributions in the original sample. This
method relies on code written for <span class="pkg">WeightIt</span> using <code><a href="https://rdrr.io/pkg/osqp/man/osqp.html" class="external-link">osqp::osqp()</a></code>
from the <a href="https://CRAN.R-project.org/package=osqp" class="external-link"><span class="pkg">osqp</span></a> package to perform the optimization. This method may
be slow or memory-intensive for large datasets.</p><div class="section">
<h3 id="binary-treatments">Binary Treatments<a class="anchor" aria-label="anchor" href="#binary-treatments"></a></h3>


<p>For binary treatments, this method estimates the weights using <code>osqp()</code> using
formulas described by Huling and Mak (2024). The following estimands are
allowed: ATE, ATT, and ATC.</p>
</div>

<div class="section">
<h3 id="multi-category-treatments">Multi-Category Treatments<a class="anchor" aria-label="anchor" href="#multi-category-treatments"></a></h3>


<p>For multi-category treatments, this method estimates the weights using
<code>osqp()</code> using formulas described by Huling and Mak (2024). The following
estimands are allowed: ATE and ATT.</p>
</div>

<div class="section">
<h3 id="continuous-treatments">Continuous Treatments<a class="anchor" aria-label="anchor" href="#continuous-treatments"></a></h3>


<p>For continuous treatments, this method estimates the weights using <code>osqp()</code>
using formulas described by Huling, Greifer, and Chen (2023).</p>
</div>

<div class="section">
<h3 id="longitudinal-treatments">Longitudinal Treatments<a class="anchor" aria-label="anchor" href="#longitudinal-treatments"></a></h3>


<p>For longitudinal treatments, the weights are the product of the weights
estimated at each time point. This method is not guaranteed to yield optimal
balance at each time point. <strong>NOTE: the use of energy balancing with longitudinal treatments has not been validated!</strong></p>
</div>

<div class="section">
<h3 id="sampling-weights">Sampling Weights<a class="anchor" aria-label="anchor" href="#sampling-weights"></a></h3>


<p>Sampling weights are supported through <code>s.weights</code> in all scenarios. In some
cases, sampling weights will cause the optimization to fail due to lack of
convexity or infeasible constraints.</p>
</div>

<div class="section">
<h3 id="missing-data">Missing Data<a class="anchor" aria-label="anchor" href="#missing-data"></a></h3>


<p>In the presence of missing data, the following value(s) for <code>missing</code> are
allowed:</p><dl><dt><code>"ind"</code> (default)</dt>
<dd><p>First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is <code>NA</code> and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians (this value is arbitrary and does not affect estimation). The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting <code>weightit</code> object will be the original covariates with the <code>NA</code>s.</p></dd>


</dl></div>

<div class="section">
<h3 id="m-estimation">M-estimation<a class="anchor" aria-label="anchor" href="#m-estimation"></a></h3>


<p>M-estimation is not supported.</p>
</div>

    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Energy balancing is a method of estimating weights using
optimization without a propensity score. The weights are the solution to a
constrain quadratic optimization problem where the objective function
concerns covariate balance as measured by the energy distance and (for
continuous treatments) the distance covariance.</p>
<p>Energy balancing for binary and multi-category treatments involves minimizing
the energy distance between the treatment groups and between each treatment
group and a target group (e.g., the full sample for the ATE). The energy
distance is a scalar measure of the difference between two multivariate
distributions and is equal to 0 when the two distributions are identical.</p>
<p>Energy balancing for continuous treatments involves minimizing the distance
covariance between the treatment and the covariates; the distance covariance
is a scalar measure of the association between two (possibly multivariate)
distributions that is equal to 0 when the two distributions are independent.
In addition, the energy distances between the treatment and covariate
distributions in the weighted sample and the treatment and covariate
distributions in the original sample are minimized.</p>
<p>The primary benefit of energy balancing is that all features of the covariate
distribution are balanced, not just means, as with other optimization-based
methods like entropy balancing. Still, it is possible to add additional
balance constraints to require balance on individual terms using the
<code>moments</code> argument, just like with entropy balancing. Energy balancing can
sometimes yield weights with high variability; the <code>lambda</code> argument can be
supplied to penalize highly variable weights to increase the effective sample
size at the expense of balance.</p><div class="section">
<h3 id="reproducibility">Reproducibility<a class="anchor" aria-label="anchor" href="#reproducibility"></a></h3>


<p>Although there are no stochastic components to the optimization, a feature
turned off by default is to update the optimization based on how long the
optimization has been running, which will vary across runs even when a seed
is set and no parameters have been changed. See the discussion
<a href="https://github.com/osqp/osqp-r/issues/19" class="external-link">here</a> for more details. To ensure
reproducibility by default, <code>adaptive_rho_interval</code> is set to 10. See
<code><a href="https://rdrr.io/pkg/osqp/man/osqpSettings.html" class="external-link">osqp::osqpSettings()</a></code> for details.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Sometimes the optimization can fail to converge because the problem is
not convex. A warning will be displayed if so. In these cases, try simply
re-fitting the weights without changing anything (but see the
<em>Reproducibility</em> section above). If the method repeatedly fails, you should
try another method or change the supplied parameters (though this is
uncommon). Increasing <code>max_iter</code> or changing <code>adaptive_rho_interval</code> might
help.</p>
<p>If it seems like the weights are balancing the covariates but you still get a
failure to converge, this usually indicates that more iterations are needs to
find the optimal solutions. This can occur when <code>moments</code> or <code>int</code> are
specified. <code>max_iter</code> should be increased, and setting <code>verbose = TRUE</code>
allows you to monitor the process and examine if the optimization is
approaching convergence.</p>
<p>If <code>min.w</code> is positive and you still get a warning about the presence of negative weights, try setting <code>eps</code> to a smaller number (e.g., to <code>1e-12</code>).</p>
<p>As of version 1.5.0, <code>polish</code> is now set to <code>TRUE</code> by default. This should yield slightly improved solutions but may be a little slower.</p>
    </div>
    <div class="section level2">
    <h2 id="additional-arguments">Additional Arguments<a class="anchor" aria-label="anchor" href="#additional-arguments"></a></h2>



<p>The following following additional arguments can be specified:</p>
<dl><dt><code>dist.mat</code></dt>
<dd><p>the name of the method used to compute the distance matrix of the covariates or the numeric distance matrix itself. Allowable options include <code>"scaled_euclidean"</code> for the Euclidean (L2) distance on the scaled covariates (the default), <code>"mahalanobis"</code> for the Mahalanobis distance, and <code>"euclidean"</code> for the raw Euclidean distance. Abbreviations allowed. Note that some user-supplied distance matrices can cause the R session to abort due to a bug within <span class="pkg">osqp</span>, so this argument should be used with caution. A distance matrix must be a square, symmetric, numeric matrix with zeros along the diagonal and a row and column for each unit. Can also be supplied as the output of a call to <code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist()</a></code>.</p></dd>

<dt><code>lambda</code></dt>
<dd><p>a positive numeric scalar used to penalize the square of the weights. This value divided by the square of the total sample size is added to the diagonal of the quadratic part of the loss function. Higher values favor weights with less variability. Note this is distinct from the lambda value described in Huling and Mak (2024), which penalizes the complexity of individual treatment rules rather than the weights, but does correspond to lambda from Huling et al. (2023). Default is .0001, which is essentially 0.</p></dd>

<dt><code>moments</code></dt>
<dd><p><code>integer</code>; the highest power of each covariate to be balanced. For example, if <code>moments = 3</code>, each covariate, its square, and its cube will be balanced. Can also be a named vector with a value for each covariate (e.g., <code>moments = c(x1 = 2, x2 = 4)</code>). Values greater than 1 for categorical covariates are ignored. Default is 0 to impose no constraint on balance.</p></dd>

<dt><code>int</code></dt>
<dd><p><code>logical</code>; whether first-order interactions of the covariates are to be balanced. Default is <code>FALSE</code>.</p></dd>

<dt><code>tols</code></dt>
<dd><p>when <code>moments</code> is positive, a number corresponding to the maximum allowed standardized mean difference (for binary and multi-category treatments) or treatment-covariate correlation (for continuous treatments) allowed. Default is 0. Ignored when <code>moments = 0</code>.</p></dd>


</dl><p>For binary and multi-category treatments, the following additional arguments can be specified:</p><dl><dt><code>improved</code></dt>
<dd><p><code>logical</code>; whether to use the improved energy balancing weights as described by Huling and Mak (2024) when <code>estimand = "ATE"</code>. This involves optimizing balance not only between each treatment group and the overall sample, but also between each pair of treatment groups. Huling and Mak (2024) found that the improved energy balancing weights generally outperformed standard energy balancing. Default is <code>TRUE</code>; set to <code>FALSE</code> to use the standard energy balancing weights instead (not recommended).</p></dd>

<dt><code>quantile</code></dt>
<dd><p>a named list of quantiles (values between 0 and 1) for each continuous covariate, which are used to create additional variables that when balanced ensure balance on the corresponding quantile of the variable. For example, setting <code>quantile = list(x1 = c(.25, .5. , .75))</code> ensures the 25th, 50th, and 75th percentiles of <code>x1</code> in each treatment group will be balanced in the weighted sample. Can also be a single number (e.g., <code>.5</code>) or a vector (e.g., <code>c(.25, .5, .75)</code>) to request the same quantile(s) for all continuous covariates.</p></dd>


</dl><p>For continuous treatments, the following additional arguments can be specified:</p>
<dl><dt><code>d.moments</code></dt>
<dd><p>The number of moments of the treatment and covariate distributions that are constrained to be the same in the weighted sample as in the original sample. For example, setting <code>d.moments = 3</code> ensures that the mean, variance, and skew of the treatment and covariates are the same in the weighted sample as in the unweighted sample. <code>d.moments</code> should be greater than or equal to <code>moments</code> and will be automatically set accordingly if not (or if not specified).</p></dd>

<dt><code>dimension.adj</code></dt>
<dd><p><code>logical</code>; whether to include the dimensionality adjustment described by Huling et al. (2023). If <code>TRUE</code>, the default, the energy distance for the covariates is weighted \(\sqrt{p}\) times as much as the energy distance for the treatment, where \(p\) is the number of covariates. If <code>FALSE</code>, the two energy distances are given equal weights. Default is <code>TRUE</code>.</p></dd>


</dl><p>The <code>moments</code> argument functions differently for <code>method = "energy"</code> from
how it does with other methods. When unspecified or set to zero, energy
balancing weights are estimated as described by Huling and Mak (2024) for
binary and multi-category treatments or by Huling et al. (2023) for
continuous treatments. When <code>moments</code> is set to an integer larger than 0,
additional balance constraints on the requested moments of the covariates
are also included, guaranteeing exact moment balance on these covariates
while minimizing the energy distance of the weighted sample. For binary and
multi-category treatments, this involves exact balance on the means of the
entered covariates; for continuous treatments, this involves exact balance
on the treatment-covariate correlations of the entered covariates. The constraint on exact balance can be relaxed using the <code>tols</code> argument.</p>
<p>Any other arguments will be passed to <code><a href="https://rdrr.io/pkg/osqp/man/osqpSettings.html" class="external-link">osqp::osqpSettings()</a></code>. Some
defaults differ from those in <code>osqpSettings()</code>; see <em>Reproducibility</em>
below.</p>
    </div>
    <div class="section level2">
    <h2 id="additional-outputs">Additional Outputs<a class="anchor" aria-label="anchor" href="#additional-outputs"></a></h2>



<dl><dt><code>obj</code></dt>
<dd><p>When <code>include.obj = TRUE</code>, the output of the call to <code><a href="https://rdrr.io/pkg/osqp/man/solve_osqp.html" class="external-link">osqp::solve_osqp()</a></code>, which contains the dual variables and convergence information.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<div class="section">
<h3 id="binary-and-multi-category-treatments">Binary and multi-category treatments<a class="anchor" aria-label="anchor" href="#binary-and-multi-category-treatments"></a></h3>


<p>Huling, J. D., &amp; Mak, S. (2024). Energy balancing of covariate distributions.
<em>Journal of Causal Inference</em>, 12(1). <a href="https://doi.org/10.1515/jci-2022-0029" class="external-link">doi:10.1515/jci-2022-0029</a></p>
</div>

<div class="section">
<h3 id="continuous-treatments-1">Continuous treatments<a class="anchor" aria-label="anchor" href="#continuous-treatments-1"></a></h3>


<p>Huling, J. D., Greifer, N., &amp; Chen, G. (2023). Independence weights for
causal inference with continuous treatments. <em>Journal of the American Statistical Association</em>, 0(ja), 1–25. <a href="https://doi.org/10.1080/01621459.2023.2213485" class="external-link">doi:10.1080/01621459.2023.2213485</a></p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="weightit.html">weightit()</a></code>, <code><a href="weightitMSM.html">weightitMSM()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Noah Greifer, using code from Jared Huling's <a href="https://CRAN.R-project.org/package=independenceWeights" class="external-link"><span class="pkg">independenceWeights</span></a> package for continuous treatments.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates between treatment groups (binary)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"energy"</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "energy" (energy balancing)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Min                                  Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated   0 |---------------|              7.527</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control   0 |---------------------------| 12.926</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            184   183   181   172    124</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated 3.797 3.946 4.725 5.738  7.527</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            423   382   189   118      7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 5.096  5.16 5.163 6.539 12.926</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated       1.148 0.852   0.551       9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control       1.162 0.765   0.467       7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  429.    185.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    182.79   80.09</span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.  -0.0235</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.   0.0052</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary  -0.0055</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary   0.0006</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.  -0.0061</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted  429.    185.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted    182.79   80.09</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates with respect to race (multi-category)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">race</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"energy"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span></span>
<span class="r-in"><span>                focal <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "energy" (energy balancing)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 3-category (black, hispan, white)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: black)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Min                                  Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> black    1   ||                           1.   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hispan   0 |---------|                    4.686</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> white    0 |---------------------------| 12.674</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             1     2     3      4      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   black     1     1     1      1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            69    48    40     28      2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  hispan 3.637 3.932  4.11  4.545  4.686</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           184    15    10      7      4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   white 7.642 7.659 9.391 11.166 12.674</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> black        0.000 0.000   0.000       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hispan       1.165 0.879   0.618      15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> white        1.733 1.073   0.967      91</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            black hispan  white</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted   243   72.  299.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted     243   30.8  74.86</span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance summary across all treatment pairs</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Max.Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.       0.0389</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.       0.0455</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary       0.0094</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary       0.0027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.       0.0259</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            hispan  white black</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted   72.  299.     243</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted     30.8  74.86   243</span>
<span class="r-in"><span><span class="co">#Balancing covariates with respect to re75 (continuous)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W3</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">re75</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                  method <span class="op">=</span> <span class="st">"energy"</span>, moments <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "energy" (energy balancing)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: continuous</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min                                 Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> all   0 |---------------------------| 9.787</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        501   486   180   171   166</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  all 6.781 6.832 7.705 9.345 9.787</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> all        1.21 0.819   0.565      98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted 614.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted   249.47</span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W3</span>, poly <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Corr.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.  -0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.   0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary   0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary  -0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.  -0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age²     Contin.  -0.0106</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ²    Contin.   0.0117</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74²    Contin.  -0.0440</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 614.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   249.47</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

