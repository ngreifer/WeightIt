<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Trim Large Weights — trim • WeightIt</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Trim Large Weights — trim" />
<meta property="og:description" content="Trims (i.e., truncates) large weights by setting all weights higher than that at a given quantile to the weight at the quantile. This can be useful in controlling extreme weights, which can reduce effective sample size by enlarging the variability of the weights." />
<meta property="og:image" content="/logo.png" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WeightIt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/WeightIt.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ngreifer/WeightIt/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Trim Large Weights</h1>
    
    <div class="hidden name"><code>trim.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Trims (i.e., truncates) large weights by setting all weights higher than that at a given quantile to the weight at the quantile. This can be useful in controlling extreme weights, which can reduce effective sample size by enlarging the variability of the weights.</p>
    </div>

    <pre class="usage"><span class='co'># S3 method for weightit</span>
<span class='fu'>trim</span><span class='op'>(</span><span class='va'>w</span>, at <span class='op'>=</span> <span class='fl'>0</span>, lower <span class='op'>=</span> <span class='cn'>FALSE</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for numeric</span>
<span class='fu'>trim</span><span class='op'>(</span><span class='va'>w</span>, at <span class='op'>=</span> <span class='fl'>0</span>, lower <span class='op'>=</span> <span class='cn'>FALSE</span>, treat <span class='op'>=</span> <span class='cn'>NULL</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>w</th>
      <td><p>A <code>weightit</code> object or a vector of weights.</p></td>
    </tr>
    <tr>
      <th>at</th>
      <td><p><code>numeric</code>; either the quantile of the weights above which weights are to be trimmed. A single number between .5 and 1, or the number of weights to be trimmed (e.g., <code>at = 3</code> for the top 3 weights to be set to the 4th largest weight).</p></td>
    </tr>
    <tr>
      <th>lower</th>
      <td><p><code>logical</code>; whether also to trim at the lower quantile (e.g., for <code>at = .9</code>, trimming at both .1 and .9, or for <code>at = 3</code>, trimming the top and bottom 3 weights).</p></td>
    </tr>
    <tr>
      <th>treat</th>
      <td><p>A vector of treatment status for each unit. This should always be included when <code>w</code> is numeric, but you can get away with leaving it out if the treatment is continuous or the estimand is the ATE for binary or multinomial treatments.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Not used.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>trim</code> takes in a <code>weightit</code> object (the output of a call to <code>weightit</code> or <code>weightitMSM</code>) or a numeric vector of weights and trims them to the specified quantile. All weights above that quantile are set to the weight at that quantile. If <code>lower = TRUE</code>, all weights below 1 minus the quantile are to set the weight at 1 minus the quantile. In general, trimming weights decreases balance but also decreases the variability of the weights, improving precision at the potential expense of unbiasedness (Cole &amp; Hernán, 2008). See Lee, Lessler, and Stuart (2011) and Thoemmes and Ong (2015) for discussions and simulation results of trimming weights at various quantiles. Note that trimming weights can also change the target population and therefore the estimand.</p>
<p>When using <code>trim</code> on a numeric vector of weights, it is helpful to include the treatment vector as well. The helps determine the type of treatment and estimand, which are used to specify how trimming is performed. In particular, if the estimand is determined to be the ATT or ATC, the weights of the target (i.e., focal) group are ignored, since they should all be equal to 1. Otherwise, if the estimand is the ATE or the treatment is continuous, all weights are considered for trimming. In general, weights for any group for which all the weights are the same will not be considered in the trimming.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If the input is a <code>weightit</code> object, the output will be a <code>weightit</code> object with the weights replaced by the trimmed weights, while will have an additional attribute, <code>"trim"</code>, equal to the quantile of trimming.</p>
<p>If the input is a numeric vector of weights, the output will be a numeric vector of the trimmed weights, again with the aforementioned attribute.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Cole, S. R., &amp; Hernán, M. Á. (2008). Constructing Inverse Probability Weights for Marginal Structural Models. American Journal of Epidemiology, 168(6), 656–664.</p>
<p>Lee, B. K., Lessler, J., &amp; Stuart, E. A. (2011). Weight Trimming and Propensity Score Weighting. PLoS ONE, 6(3), e18174.</p>
<p>Thoemmes, F., &amp; Ong, A. D. (2016). A Primer on Inverse Probability of Treatment Weighting and Marginal Structural Models. Emerging Adulthood, 4(1), 40–59.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Noah Greifer</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code>link{weightit}</code>, <code>link{weightitMSM}</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://ngreifer.github.io/cobalt/'>"cobalt"</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"lalonde"</span>, package <span class='op'>=</span> <span class='st'>"cobalt"</span><span class='op'>)</span>

<span class='op'>(</span><span class='va'>W</span> <span class='op'>&lt;-</span> <span class='fu'><a href='weightit.html'>weightit</a></span><span class='op'>(</span><span class='va'>treat</span> <span class='op'>~</span> <span class='va'>age</span> <span class='op'>+</span> <span class='va'>educ</span> <span class='op'>+</span> <span class='va'>married</span> <span class='op'>+</span>
                 <span class='va'>nodegree</span> <span class='op'>+</span> <span class='va'>re74</span>, data <span class='op'>=</span> <span class='va'>lalonde</span>,
               method <span class='op'>=</span> <span class='st'>"ps"</span>, estimand <span class='op'>=</span> <span class='st'>"ATT"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; A <span style='font-style: italic;'>weightit</span><span> object
#&gt;  - method: "ps" (propensity score weighting)
#&gt;  - number of obs.: 614
#&gt;  - sampling weights: none
#&gt;  - treatment: 2-category
#&gt;  - estimand: ATT (focal: 1)
#&gt;  - covariates: age, educ, married, nodegree, re74</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>W</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                  </span><span style='text-decoration: underline;'>Summary of weights</span><span>
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight ranges</span><span>:
#&gt; 
#&gt;            Min                                  Max
#&gt; treated 1.0000               ||              1.0000
#&gt; control 0.0222 |---------------------------| 2.0438
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Units with 5 greatest weights by group</span><span>:
#&gt;                                            
#&gt;               1      3      4      5      7
#&gt;  treated      1      1      1      1      1
#&gt;             595    411    409    296    269
#&gt;  control 1.3303 1.4365 1.5005 1.6369 2.0438
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight statistics</span><span>:
#&gt; 
#&gt;         Coef of Var   MAD Entropy # Zeros
#&gt; treated       0.000 0.000  -0.000       0
#&gt; control       0.823 0.701  -0.515       0
#&gt; overall       0.657 0.604  -0.257       0
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Effective Sample Sizes</span><span>:
#&gt; 
#&gt;            Control Treated
#&gt; Unweighted  429.       185
#&gt; Weighted    255.99     185</div><div class='input'>
<span class='co'>#Trimming the top and bottom 5 weights</span>
<span class='fu'>trim</span><span class='op'>(</span><span class='va'>W</span>, at <span class='op'>=</span> <span class='fl'>5</span>, lower <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Trimming the top and bottom 5 weights where treat is not 1.</span></div><div class='output co'>#&gt; A </span><span style='font-style: italic;'>weightit</span><span> object
#&gt;  - method: "ps" (propensity score weighting)
#&gt;  - number of obs.: 614
#&gt;  - sampling weights: none
#&gt;  - treatment: 2-category
#&gt;  - estimand: ATT (focal: 1)
#&gt;  - covariates: age, educ, married, nodegree, re74
#&gt;  - weights trimmed at the top and bottom 5 </div><div class='input'>
<span class='co'>#Trimming at 90th percentile</span>
<span class='op'>(</span><span class='va'>W.trim</span> <span class='op'>&lt;-</span> <span class='fu'>trim</span><span class='op'>(</span><span class='va'>W</span>, at <span class='op'>=</span> <span class='fl'>.9</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Trimming weights where treat is not 1 to 90%.</span></div><div class='output co'>#&gt; A </span><span style='font-style: italic;'>weightit</span><span> object
#&gt;  - method: "ps" (propensity score weighting)
#&gt;  - number of obs.: 614
#&gt;  - sampling weights: none
#&gt;  - treatment: 2-category
#&gt;  - estimand: ATT (focal: 1)
#&gt;  - covariates: age, educ, married, nodegree, re74
#&gt;  - weights trimmed at 90% </div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>W.trim</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                  </span><span style='text-decoration: underline;'>Summary of weights</span><span>
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight ranges</span><span>:
#&gt; 
#&gt;            Min                                    Max
#&gt; treated 1.0000                              || 1.0000
#&gt; control 0.0222   |-------------------------|   0.9407
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Units with 5 greatest weights by group</span><span>:
#&gt;                                            
#&gt;               1      3      4      5      7
#&gt;  treated      1      1      1      1      1
#&gt;             264    269    285    296    303
#&gt;  control 0.9407 0.9407 0.9407 0.9407 0.9407
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight statistics</span><span>:
#&gt; 
#&gt;         Coef of Var   MAD Entropy # Zeros
#&gt; treated       0.000 0.000  -0.000       0
#&gt; control       0.766 0.682  -0.583       0
#&gt; overall       0.641 0.597  -0.285       0
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Effective Sample Sizes</span><span>:
#&gt; 
#&gt;            Control Treated
#&gt; Unweighted  429.       185
#&gt; Weighted    270.58     185</div><div class='input'><span class='co'>#Note that only the control weights were trimmed</span>

<span class='co'>#Trimming a numeric vector of weights</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='fu'>trim</span><span class='op'>(</span><span class='va'>W</span><span class='op'>$</span><span class='va'>weights</span>, at <span class='op'>=</span> <span class='fl'>.9</span>, treat <span class='op'>=</span> <span class='va'>lalonde</span><span class='op'>$</span><span class='va'>treat</span><span class='op'>)</span>,
          <span class='va'>W.trim</span><span class='op'>$</span><span class='va'>weights</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Trimming weights where treat is not 1 to 90%.</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'>#Using made up data and as.weightit()</span>
<span class='va'>treat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span><span class='op'>(</span><span class='fl'>500</span>, <span class='fl'>1</span>, <span class='fl'>.3</span><span class='op'>)</span>
<span class='va'>weights</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Chisquare.html'>rchisq</a></span><span class='op'>(</span><span class='fl'>500</span>, df <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>W</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.weightit.html'>as.weightit</a></span><span class='op'>(</span>weights <span class='op'>=</span> <span class='va'>weights</span>, treat <span class='op'>=</span> <span class='va'>treat</span>,
                 estimand <span class='op'>=</span> <span class='st'>"ATE"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>W</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                  </span><span style='text-decoration: underline;'>Summary of weights</span><span>
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight ranges</span><span>:
#&gt; 
#&gt;            Min                                   Max
#&gt; treated 0.0465 |---------------------------| 12.6746
#&gt; control 0.0014 |---------------------|       10.1355
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Units with 5 greatest weights by group</span><span>:
#&gt;                                              
#&gt;             439    289    255     184     126
#&gt;  treated 9.2817 9.7981  9.871 12.1578 12.6746
#&gt;             499    263    222      55      48
#&gt;  control 8.3429 9.1458 9.5069 10.1335 10.1355
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight statistics</span><span>:
#&gt; 
#&gt;         Coef of Var   MAD Entropy # Zeros
#&gt; treated       1.052 0.760   1.251       0
#&gt; control       0.976 0.729   1.027       0
#&gt; overall       1.013 0.743   1.107       0
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Effective Sample Sizes</span><span>:
#&gt; 
#&gt;            Control Treated
#&gt; Unweighted   343.    157. 
#&gt; Weighted     175.9    74.8</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='fu'>trim</span><span class='op'>(</span><span class='va'>W</span>, at <span class='op'>=</span> <span class='fl'>.95</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Trimming weights to 95%.</span></div><div class='output co'>#&gt;                  </span><span style='text-decoration: underline;'>Summary of weights</span><span>
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight ranges</span><span>:
#&gt; 
#&gt;            Min                                  Max
#&gt; treated 0.0465 |---------------------------| 5.8054
#&gt; control 0.0014 |---------------------------| 5.8054
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Units with 5 greatest weights by group</span><span>:
#&gt;                                            
#&gt;               5     63    126    184    249
#&gt;  treated 5.8054 5.8054 5.8054 5.8054 5.8054
#&gt;               4     48     55     65    132
#&gt;  control 5.8054 5.8054 5.8054 5.8054 5.8054
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Weight statistics</span><span>:
#&gt; 
#&gt;         Coef of Var   MAD Entropy # Zeros
#&gt; treated       0.866 0.712   1.072       0
#&gt; control       0.888 0.709   0.953       0
#&gt; overall       0.883 0.712   0.993       0
#&gt; 
#&gt; - </span><span style='font-style: italic;'>Effective Sample Sizes</span><span>:
#&gt; 
#&gt;            Control Treated
#&gt; Unweighted  343.    157.  
#&gt; Weighted    191.94   89.94</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


