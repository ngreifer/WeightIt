<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Trim (Winsorize) Large Weights — trim • WeightIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Trim (Winsorize) Large Weights — trim"><meta name="description" content='Trims (i.e., winsorizes) large weights by setting all weights
higher than that at a given quantile to the weight at the quantile or to 0.
This can be useful in controlling extreme weights, which can reduce effective
sample size by enlarging the variability of the weights. Note that by
default, no observations are fully discarded when using trim(), which may
differ from the some uses of the word "trim" (see the drop argument below).'><meta property="og:description" content='Trims (i.e., winsorizes) large weights by setting all weights
higher than that at a given quantile to the weight at the quantile or to 0.
This can be useful in controlling extreme weights, which can reduce effective
sample size by enlarging the variability of the weights. Note that by
default, no observations are fully discarded when using trim(), which may
differ from the some uses of the word "trim" (see the drop argument below).'><meta property="og:image" content="https://ngreifer.github.io/WeightIt/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WeightIt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/WeightIt.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/estimating-effects.html">Estimating Effects After Weighting</a></li>
    <li><a class="dropdown-item" href="../articles/installing-packages.html">Installing Supporting Packages</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/WeightIt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Trim (Winsorize) Large Weights</h1>
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/WeightIt/blob/master/R/trim.R" class="external-link"><code>R/trim.R</code></a></small>
      <div class="d-none name"><code>trim.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Trims (i.e., winsorizes) large weights by setting all weights
higher than that at a given quantile to the weight at the quantile or to 0.
This can be useful in controlling extreme weights, which can reduce effective
sample size by enlarging the variability of the weights. Note that by
default, no observations are fully discarded when using <code>trim()</code>, which may
differ from the some uses of the word "trim" (see the <code>drop</code> argument below).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">trim</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'weightit'</span></span>
<span><span class="fu">trim</span><span class="op">(</span><span class="va">x</span>, at <span class="op">=</span> <span class="fl">0</span>, lower <span class="op">=</span> <span class="cn">FALSE</span>, drop <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">trim</span><span class="op">(</span><span class="va">x</span>, at <span class="op">=</span> <span class="fl">0</span>, lower <span class="op">=</span> <span class="cn">FALSE</span>, treat <span class="op">=</span> <span class="cn">NULL</span>, drop <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>a <code>weightit</code> object or a vector of weights.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>not used.</p></dd>


<dt id="arg-at">at<a class="anchor" aria-label="anchor" href="#arg-at"></a></dt>
<dd><p><code>numeric</code>; either the quantile of the weights above which weights
are to be trimmed. A single number between .5 and 1, or the number of
weights to be trimmed (e.g., <code>at = 3</code> for the top 3 weights to be set to
the 4th largest weight).</p></dd>


<dt id="arg-lower">lower<a class="anchor" aria-label="anchor" href="#arg-lower"></a></dt>
<dd><p><code>logical</code>; whether also to trim at the lower quantile (e.g., for
<code>at = .9</code>, trimming at both .1 and .9, or for <code>at = 3</code>, trimming the top
and bottom 3 weights). Default is <code>FALSE</code> to only trim the higher weights.</p></dd>


<dt id="arg-drop">drop<a class="anchor" aria-label="anchor" href="#arg-drop"></a></dt>
<dd><p><code>logical</code>; whether to set the weights of the trimmed units to 0
or not. Default is <code>FALSE</code> to retain all trimmed units. Setting to <code>TRUE</code>
may change the original targeted estimand when not the ATT or ATC.</p></dd>


<dt id="arg-treat">treat<a class="anchor" aria-label="anchor" href="#arg-treat"></a></dt>
<dd><p>a vector of treatment status for each unit. This should always
be included when <code>x</code> is numeric, but you can get away with leaving it out
if the treatment is continuous or the estimand is the ATE for binary or
multi-category treatments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If the input is a <code>weightit</code> object, the output will be a <code>weightit</code>
object with the weights replaced by the trimmed weights (or 0) and will have
an additional attribute, <code>"trim"</code>, equal to the quantile of trimming.</p>
<p>If the input is a numeric vector of weights, the output will be a numeric
vector of the trimmed weights, again with the aforementioned attribute.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>trim()</code> takes in a <code>weightit</code> object (the output of a call to
<code><a href="weightit.html">weightit()</a></code> or <code><a href="weightitMSM.html">weightitMSM()</a></code>) or a numeric vector of weights and trims
(winsorizes) them to the specified quantile. All weights above that quantile
are set to the weight at that quantile unless <code>drop = TRUE</code>, in which case
they are set to 0. If <code>lower = TRUE</code>, all weights below 1 minus the quantile
are trimmed. In general, trimming weights can increase imbalance but also
decreases the variability of the weights, improving precision at the
potential expense of unbiasedness (Cole &amp; Hernán, 2008). See Lee, Lessler,
and Stuart (2011) and Thoemmes and Ong (2015) for discussions and simulation
results of trimming weights at various quantiles. Note that trimming weights
can also change the target population and therefore the estimand.</p>
<p>When using <code>trim()</code> on a numeric vector of weights, it is helpful to include
the treatment vector as well. The helps determine the type of treatment and
estimand, which are used to specify how trimming is performed. In particular,
if the estimand is determined to be the ATT or ATC, the weights of the target
(i.e., focal) group are ignored, since they should all be equal to 1.
Otherwise, if the estimand is the ATE or the treatment is continuous, all
weights are considered for trimming. In general, weights for any group for
which all the weights are the same will not be considered in the trimming.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Cole, S. R., &amp; Hernán, M. Á. (2008). Constructing Inverse Probability Weights for Marginal Structural Models. <em>American Journal of Epidemiology</em>, 168(6), 656–664. <a href="https://doi.org/10.1093/aje/kwn164" class="external-link">doi:10.1093/aje/kwn164</a></p>
<p>Lee, B. K., Lessler, J., &amp; Stuart, E. A. (2011). Weight Trimming and Propensity Score Weighting. <em>PLoS ONE</em>, 6(3), e18174. <a href="https://doi.org/10.1371/journal.pone.0018174" class="external-link">doi:10.1371/journal.pone.0018174</a></p>
<p>Thoemmes, F., &amp; Ong, A. D. (2016). A Primer on Inverse Probability of Treatment Weighting and Marginal Structural Models. <em>Emerging Adulthood</em>, 4(1), 40–59. <a href="https://doi.org/10.1177/2167696815621645" class="external-link">doi:10.1177/2167696815621645</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="weightit.html">weightit()</a></code>, <code><a href="weightitMSM.html">weightitMSM()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ngreifer.github.io/cobalt/" class="external-link">"cobalt"</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                 <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>               method <span class="op">=</span> <span class="st">"glm"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "glm" (propensity score weighting with GLM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Min                                 Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.                  ||              1.   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.022 |---------------------------| 2.044</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             1     2   3     4     5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated    1     1   1     1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           410   226 224   111    84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 1.33 1.437 1.5 1.637 2.044</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated       0.000 0.000    0.00       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control       0.823 0.701    0.33       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    255.99     185</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Trimming the top and bottom 5 weights</span></span></span>
<span class="r-in"><span><span class="fu">trim</span><span class="op">(</span><span class="va">W</span>, at <span class="op">=</span> <span class="fl">5</span>, lower <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Trimming the top and bottom 5 weights where treat is not 1.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "glm" (propensity score weighting with GLM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - weights trimmed at the top and bottom 5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Trimming at 90th percentile</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W.trim</span> <span class="op">&lt;-</span> <span class="fu">trim</span><span class="op">(</span><span class="va">W</span>, at <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Trimming weights where treat is not 1 to 90%.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "glm" (propensity score weighting with GLM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - weights trimmed at 90%</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W.trim</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Min                                   Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.                                 || 1.   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.022   |-------------------------|   0.941</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              1     2     3     4     5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated     1     1     1     1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             79    84   100   111   118</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 0.941 0.941 0.941 0.941 0.941</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated       0.000 0.000   0.000       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control       0.766 0.682   0.303       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    270.58     185</span>
<span class="r-in"><span><span class="co">#Note that only the control weights were trimmed</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Trimming a numeric vector of weights</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu">trim</span><span class="op">(</span><span class="va">W</span><span class="op">$</span><span class="va">weights</span>, at <span class="op">=</span> <span class="fl">.9</span>, treat <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          <span class="va">W.trim</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Trimming weights where treat is not 1 to 90%.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Dropping trimmed units</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W.trim</span> <span class="op">&lt;-</span> <span class="fu">trim</span><span class="op">(</span><span class="va">W</span>, at <span class="op">=</span> <span class="fl">.9</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting weights beyond 90% where treat is not 1 to 0.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "glm" (propensity score weighting with GLM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - weights trimmed at 90% and units dropped</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W.trim</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Min                                   Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated   1                              || 1.   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control   0   |-------------------------|   0.941</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              1     2     3     4     5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated     1     1     1     1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            171   184   188   281   282</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 0.941 0.941 0.941 0.941 0.941</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated       0.000 0.000   0.000       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control       0.881 0.757   0.303      40</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    241.72     185</span>
<span class="r-in"><span><span class="co">#Note that we now have zeros in the control group</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Using made up data and as.weightit()</span></span></span>
<span class="r-in"><span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1</span>, <span class="fl">.3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">rchisq</a></span><span class="op">(</span><span class="fl">500</span>, df <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="as.weightit.html">as.weightit</a></span><span class="op">(</span><span class="va">weights</span>, treat <span class="op">=</span> <span class="va">treat</span>,</span></span>
<span class="r-in"><span>                 estimand <span class="op">=</span> <span class="st">"ATE"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Min                                  Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 0.005 |----------------------|      11.484</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.004 |---------------------------| 13.9  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              75     46    39     33      9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated  6.131  6.444 6.591  9.601 11.484</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             344    329   309    255      7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 10.478 11.104 11.27 13.524   13.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated       0.973 0.684   0.398       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control       1.039 0.772   0.454       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  361.    139.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    173.91   71.65</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">trim</span><span class="op">(</span><span class="va">W</span>, at <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Trimming weights to 95%.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Min                                 Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 0.005 |---------------------------| 6.404</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 0.004 |---------------------------| 6.404</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             75     9    33    39    46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated 6.131 6.404 6.404 6.404 6.404</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              2     3     7    16    37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control 6.404 6.404 6.404 6.404 6.404</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated       0.875 0.668   0.361       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control       0.918 0.745   0.402       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  361.    139.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    196.13   78.98</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

