<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Propensity Score Weighting Using Generalized Boosted Models — method_gbm • WeightIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Propensity Score Weighting Using Generalized Boosted Models — method_gbm"><meta name="description" content='This page explains the details of estimating weights from
generalized boosted model-based propensity scores by setting method = "gbm"
in the call to weightit() or weightitMSM(). This method can be used with
binary, multi-category, and continuous treatments.
In general, this method relies on estimating propensity scores using
generalized boosted modeling and then converting those propensity scores into
weights using a formula that depends on the desired estimand. The algorithm
involves using a balance-based or prediction-based criterion to optimize in
choosing the value of tuning parameters (the number of trees and possibly
others). The method relies on the gbm package.
This method mimics the functionality of functions in the twang package,
but has improved performance and more flexible options. See Details section
for more details.
Binary Treatments


For binary treatments, this method estimates the propensity scores using
gbm::gbm.fit() and then selects the optimal tuning parameter values
using the method specified in the criterion argument. The following
estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights are computed
from the estimated propensity scores using get_w_from_ps(), which
implements the standard formulas. Weights can also be computed using marginal
mean weighting through stratification for the ATE, ATT, and ATC. See
get_w_from_ps() for details.



Multi-Category Treatments


For binary treatments, this method estimates the propensity scores using
gbm::gbm.fit() and then selects the optimal tuning parameter values
using the method specified in the criterion argument. The following
estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights are computed
from the estimated propensity scores using get_w_from_ps(), which
implements the standard formulas. Weights can also be computed using marginal
mean weighting through stratification for the ATE, ATT, and ATC. See
get_w_from_ps() for details.



Continuous Treatments


For continuous treatments, this method estimates the generalized propensity
score using gbm::gbm.fit() and then selects the optimal tuning
parameter values using the method specified in the criterion argument.



Longitudinal Treatments


For longitudinal treatments, the weights are the product of the weights
estimated at each time point.



Sampling Weights


Sampling weights are supported through s.weights in all scenarios.



Missing Data


In the presence of missing data, the following value(s) for missing are allowed:
"ind" (default)
First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is NA and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians (this value is arbitrary and does not affect estimation). The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting weightit object will be the original covariates with the NAs.

"surr"
Surrogate splitting is used to process NAs. No missingness indicators are created. Nodes are split using only the non-missing values of each variable. To generate predicted values for each unit, a non-missing variable that operates similarly to the variable with missingness is used as a surrogate. Missing values are ignored when calculating balance statistics to choose the optimal tree.







M-estimation


M-estimation is not supported.

'><meta property="og:description" content='This page explains the details of estimating weights from
generalized boosted model-based propensity scores by setting method = "gbm"
in the call to weightit() or weightitMSM(). This method can be used with
binary, multi-category, and continuous treatments.
In general, this method relies on estimating propensity scores using
generalized boosted modeling and then converting those propensity scores into
weights using a formula that depends on the desired estimand. The algorithm
involves using a balance-based or prediction-based criterion to optimize in
choosing the value of tuning parameters (the number of trees and possibly
others). The method relies on the gbm package.
This method mimics the functionality of functions in the twang package,
but has improved performance and more flexible options. See Details section
for more details.
Binary Treatments


For binary treatments, this method estimates the propensity scores using
gbm::gbm.fit() and then selects the optimal tuning parameter values
using the method specified in the criterion argument. The following
estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights are computed
from the estimated propensity scores using get_w_from_ps(), which
implements the standard formulas. Weights can also be computed using marginal
mean weighting through stratification for the ATE, ATT, and ATC. See
get_w_from_ps() for details.



Multi-Category Treatments


For binary treatments, this method estimates the propensity scores using
gbm::gbm.fit() and then selects the optimal tuning parameter values
using the method specified in the criterion argument. The following
estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights are computed
from the estimated propensity scores using get_w_from_ps(), which
implements the standard formulas. Weights can also be computed using marginal
mean weighting through stratification for the ATE, ATT, and ATC. See
get_w_from_ps() for details.



Continuous Treatments


For continuous treatments, this method estimates the generalized propensity
score using gbm::gbm.fit() and then selects the optimal tuning
parameter values using the method specified in the criterion argument.



Longitudinal Treatments


For longitudinal treatments, the weights are the product of the weights
estimated at each time point.



Sampling Weights


Sampling weights are supported through s.weights in all scenarios.



Missing Data


In the presence of missing data, the following value(s) for missing are allowed:
"ind" (default)
First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is NA and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians (this value is arbitrary and does not affect estimation). The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting weightit object will be the original covariates with the NAs.

"surr"
Surrogate splitting is used to process NAs. No missingness indicators are created. Nodes are split using only the non-missing values of each variable. To generate predicted values for each unit, a non-missing variable that operates similarly to the variable with missingness is used as a surrogate. Missing values are ignored when calculating balance statistics to choose the optimal tree.







M-estimation


M-estimation is not supported.

'><meta property="og:image" content="https://ngreifer.github.io/WeightIt/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WeightIt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/WeightIt.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/estimating-effects.html">Estimating Effects After Weighting</a></li>
    <li><a class="dropdown-item" href="../articles/installing-packages.html">Installing Supporting Packages</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/WeightIt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Propensity Score Weighting Using Generalized Boosted Models</h1>
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/WeightIt/blob/master/R/weightit2gbm.R" class="external-link"><code>R/weightit2gbm.R</code></a></small>
      <div class="d-none name"><code>method_gbm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This page explains the details of estimating weights from
generalized boosted model-based propensity scores by setting <code>method = "gbm"</code>
in the call to <code><a href="weightit.html">weightit()</a></code> or <code><a href="weightitMSM.html">weightitMSM()</a></code>. This method can be used with
binary, multi-category, and continuous treatments.</p>
<p>In general, this method relies on estimating propensity scores using
generalized boosted modeling and then converting those propensity scores into
weights using a formula that depends on the desired estimand. The algorithm
involves using a balance-based or prediction-based criterion to optimize in
choosing the value of tuning parameters (the number of trees and possibly
others). The method relies on the <a href="https://CRAN.R-project.org/package=gbm" class="external-link"><span class="pkg">gbm</span></a> package.</p>
<p>This method mimics the functionality of functions in the <span class="pkg">twang</span> package,
but has improved performance and more flexible options. See Details section
for more details.</p><div class="section">
<h3 id="binary-treatments">Binary Treatments<a class="anchor" aria-label="anchor" href="#binary-treatments"></a></h3>


<p>For binary treatments, this method estimates the propensity scores using
<code><a href="https://rdrr.io/pkg/gbm/man/gbm.fit.html" class="external-link">gbm::gbm.fit()</a></code> and then selects the optimal tuning parameter values
using the method specified in the <code>criterion</code> argument. The following
estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights are computed
from the estimated propensity scores using <code><a href="get_w_from_ps.html">get_w_from_ps()</a></code>, which
implements the standard formulas. Weights can also be computed using marginal
mean weighting through stratification for the ATE, ATT, and ATC. See
<code><a href="get_w_from_ps.html">get_w_from_ps()</a></code> for details.</p>
</div>

<div class="section">
<h3 id="multi-category-treatments">Multi-Category Treatments<a class="anchor" aria-label="anchor" href="#multi-category-treatments"></a></h3>


<p>For binary treatments, this method estimates the propensity scores using
<code><a href="https://rdrr.io/pkg/gbm/man/gbm.fit.html" class="external-link">gbm::gbm.fit()</a></code> and then selects the optimal tuning parameter values
using the method specified in the <code>criterion</code> argument. The following
estimands are allowed: ATE, ATT, ATC, ATO, and ATM. The weights are computed
from the estimated propensity scores using <code><a href="get_w_from_ps.html">get_w_from_ps()</a></code>, which
implements the standard formulas. Weights can also be computed using marginal
mean weighting through stratification for the ATE, ATT, and ATC. See
<code><a href="get_w_from_ps.html">get_w_from_ps()</a></code> for details.</p>
</div>

<div class="section">
<h3 id="continuous-treatments">Continuous Treatments<a class="anchor" aria-label="anchor" href="#continuous-treatments"></a></h3>


<p>For continuous treatments, this method estimates the generalized propensity
score using <code><a href="https://rdrr.io/pkg/gbm/man/gbm.fit.html" class="external-link">gbm::gbm.fit()</a></code> and then selects the optimal tuning
parameter values using the method specified in the <code>criterion</code> argument.</p>
</div>

<div class="section">
<h3 id="longitudinal-treatments">Longitudinal Treatments<a class="anchor" aria-label="anchor" href="#longitudinal-treatments"></a></h3>


<p>For longitudinal treatments, the weights are the product of the weights
estimated at each time point.</p>
</div>

<div class="section">
<h3 id="sampling-weights">Sampling Weights<a class="anchor" aria-label="anchor" href="#sampling-weights"></a></h3>


<p>Sampling weights are supported through <code>s.weights</code> in all scenarios.</p>
</div>

<div class="section">
<h3 id="missing-data">Missing Data<a class="anchor" aria-label="anchor" href="#missing-data"></a></h3>


<p>In the presence of missing data, the following value(s) for <code>missing</code> are allowed:</p><dl><dt><code>"ind"</code> (default)</dt>
<dd><p>First, for each variable with missingness, a new missingness indicator variable is created which takes the value 1 if the original covariate is <code>NA</code> and 0 otherwise. The missingness indicators are added to the model formula as main effects. The missing values in the covariates are then replaced with the covariate medians (this value is arbitrary and does not affect estimation). The weight estimation then proceeds with this new formula and set of covariates. The covariates output in the resulting <code>weightit</code> object will be the original covariates with the <code>NA</code>s.</p></dd>

<dt><code>"surr"</code></dt>
<dd><p>Surrogate splitting is used to process <code>NA</code>s. No missingness indicators are created. Nodes are split using only the non-missing values of each variable. To generate predicted values for each unit, a non-missing variable that operates similarly to the variable with missingness is used as a surrogate. Missing values are ignored when calculating balance statistics to choose the optimal tree.</p></dd>


</dl></div>

<div class="section">
<h3 id="m-estimation">M-estimation<a class="anchor" aria-label="anchor" href="#m-estimation"></a></h3>


<p>M-estimation is not supported.</p>
</div>

    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Generalized boosted modeling (GBM, also known as gradient boosting
machines) is a machine learning method that generates predicted values from a
flexible regression of the treatment on the covariates, which are treated as
propensity scores and used to compute weights. It does this by building a
series of regression trees, each fit to the residuals of the last, minimizing
a loss function that depends on the distribution chosen. The optimal number
of trees is a tuning parameter that must be chosen; McCaffrey et al. (2004)
were innovative in using covariate balance to select this value rather than
traditional machine learning performance metrics such as cross-validation
accuracy. GBM is particularly effective for fitting nonlinear treatment
models characterized by curves and interactions, but performs worse for
simpler treatment models. It is unclear which balance measure should be used
to select the number of trees, though research has indicated that balance
measures tend to perform better than cross-validation accuracy for estimating
effective propensity score weights.</p>
<p><span class="pkg">WeightIt</span> offers almost identical functionality to <span class="pkg">twang</span>, the
first package to implement this method. Compared to the current version of
<span class="pkg">twang</span>, <span class="pkg">WeightIt</span> offers more options for the measure of balance
used to select the number of trees, improved performance, tuning of
hyperparameters, more estimands, and support for continuous treatments.
<span class="pkg">WeightIt</span> computes weights for multi-category treatments differently
from how <span class="pkg">twang</span> does; rather than fitting a separate binary GBM for each
pair of treatments, <span class="pkg">WeightIt</span> fits a single multi-class GBM model and
uses balance measures appropriate for multi-category treatments.</p>
<p><code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> can be used on the output of <code><a href="weightit.html">weightit()</a></code> with <code>method = "gbm"</code> to
display the results of the tuning process; see Examples and <code><a href="plot.weightit.html">plot.weightit()</a></code>
for more details.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The <code>criterion</code> argument used to be called <code>stop.method</code>, which is its
name in <span class="pkg">twang</span>. <code>stop.method</code> still works for backward compatibility.
Additionally, the criteria formerly named as <code>"es.mean"</code>, <code>"es.max"</code>, and
<code>"es.rms"</code> have been renamed to <code>"smd.mean"</code>, <code>"smd.max"</code>, and <code>"smd.rms"</code>.
The former are used in <span class="pkg">twang</span> and will still work with <code><a href="weightit.html">weightit()</a></code> for
backward compatibility.</p>
<p>Estimated propensity scores are trimmed to \(10^{-8}\) and \(1 - 10^{-8}\) to ensure balance statistics can be computed.</p>
    </div>
    <div class="section level2">
    <h2 id="additional-arguments">Additional Arguments<a class="anchor" aria-label="anchor" href="#additional-arguments"></a></h2>



<p>The following additional arguments can be specified:</p><dl><dt><code>criterion</code></dt>
<dd><p>A string describing the balance criterion used to select the best weights. See <code><a href="https://ngreifer.github.io/cobalt/reference/bal.compute.html" class="external-link">cobalt::bal.compute()</a></code> for allowable options for each treatment type. In addition, to optimize the cross-validation error instead of balance, <code>criterion</code> can be set as <code>"cv{#}</code>", where <code>{#}</code> is replaced by a number representing the number of cross-validation folds used (e.g., <code>"cv5"</code> for 5-fold cross-validation). For binary and multi-category treatments, the default is <code>"smd.mean"</code>, which minimizes the average absolute standard mean difference among the covariates between treatment groups. For continuous treatments, the default is <code>"p.mean"</code>, which minimizes the average absolute Pearson correlation between the treatment and covariates.</p></dd>

<dt><code>trim.at</code></dt>
<dd><p>A number supplied to <code>at</code> in <code><a href="trim.html">trim()</a></code> which trims the weights from all the trees before choosing the best tree. This can be valuable when some weights are extreme, which occurs especially with continuous treatments. The default is 0 (i.e., no trimming).</p></dd>

<dt><code>subclass</code></dt>
<dd><p><code>integer</code>; the number of subclasses to use for computing weights using marginal mean weighting through stratification (MMWS). If <code>NULL</code>, standard inverse probability weights (and their extensions) will be computed; if a number greater than 1, subclasses will be formed and weights will be computed based on subclass membership. Only allowed for binary and multi-category treatments. See <code><a href="get_w_from_ps.html">get_w_from_ps()</a></code> for details and references.</p></dd>

<dt><code>distribution</code></dt>
<dd><p>A string with the distribution used in the loss function of the boosted model. This is supplied to the <code>distribution</code> argument in <code><a href="https://rdrr.io/pkg/gbm/man/gbm.fit.html" class="external-link">gbm::gbm.fit()</a></code>. For binary treatments, <code>"bernoulli"</code> and <code>"adaboost"</code> are available, with <code>"bernoulli"</code> the default. For multi-category treatments, only <code>"multinomial"</code> is allowed. For continuous treatments <code>"gaussian"</code>, <code>"laplace"</code>, and <code>"tdist"</code> are available, with <code>"gaussian"</code> the default. This argument is tunable.</p></dd>

<dt><code>n.trees</code></dt>
<dd><p>The maximum number of trees used. This is passed onto the <code>n.trees</code> argument in <code>gbm.fit()</code>. The default is 10000 for binary and multi-category treatments and 20000 for continuous treatments.</p></dd>

<dt><code>start.tree</code></dt>
<dd><p>The tree at which to start balance checking. If you know the best balance isn't in the first 100 trees, for example, you can set <code>start.tree = 101</code> so that balance statistics are not computed on the first 100 trees. This can save some time since balance checking takes up the bulk of the run time for some balance-based stopping methods, and is especially useful when running the same model adding more and more trees. The default is 1, i.e., to start from the very first tree in assessing balance.</p></dd>

<dt><code>interaction.depth</code></dt>
<dd><p>The depth of the trees. This is passed onto the <code>interaction.depth</code> argument in <code>gbm.fit()</code>. Higher values indicate better ability to capture nonlinear and nonadditive relationships. The default is 3 for binary and multi-category treatments and 4 for continuous treatments. This argument is tunable.</p></dd>

<dt><code>shrinkage</code></dt>
<dd><p>The shrinkage parameter applied to the trees. This is passed onto the <code>shrinkage</code> argument in <code>gbm.fit()</code>. The default is .01 for binary and multi-category treatments and .0005 for continuous treatments. The lower this value is, the more trees one may have to include to reach the optimum. This argument is tunable.</p></dd>

<dt><code>bag.fraction</code></dt>
<dd><p>The fraction of the units randomly selected to propose the next tree in the expansion. This is passed onto the <code>bag.fraction</code> argument in <code>gbm.fit()</code>. The default is 1, but smaller values should be tried. For values less then 1, subsequent runs with the same parameters will yield different results due to random sampling; be sure to seed the seed using <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> to ensure replicability of results.</p></dd>

<dt><code>use.offset</code></dt>
<dd><p><code>logical</code>; whether to use the linear predictor resulting from a generalized linear model as an offset to the GBM model. If <code>TRUE</code>, this fits a logistic regression model (for binary treatments) or a linear regression model (for continuous treatments) and supplies the linear predict to the <code>offset</code> argument of <code>gbm.fit()</code>. This often improves performance generally but especially when the true propensity score model is well approximated by a GLM, and this yields uniformly superior performance over <code>method = "glm"</code> with respect to <code>criterion</code>. Default is <code>FALSE</code> to omit the offset. Only allowed for binary and continuous treatments. This argument is tunable.</p></dd>


</dl><p>All other arguments take on the defaults of those in <code><a href="https://rdrr.io/pkg/gbm/man/gbm.fit.html" class="external-link">gbm::gbm.fit()</a></code>,
and some are not used at all. For binary and multi-category treatments with
a with cross-validation used as the criterion, <code>class.stratify.cv</code> is set
to <code>TRUE</code> by default.</p>
<p>The <code>w</code> argument in <code>gbm.fit()</code> is ignored because sampling weights are
passed using <code>s.weights</code>.</p>
<p>For continuous treatments only, the following arguments may be supplied:</p><dl><dt><code>density</code></dt>
<dd><p>A function corresponding to the conditional density of the treatment. The standardized residuals of the treatment model will be fed through this function to produce the numerator and denominator of the generalized propensity score weights. This can also be supplied as a string containing the name of the function to be called. If the string contains underscores, the call will be split by the underscores and the latter splits will be supplied as arguments to the second argument and beyond. For example, if <code>density = "dt_2"</code> is specified, the density used will be that of a t-distribution with 2 degrees of freedom. Using a t-distribution can be useful when extreme outcome values are observed (Naimi et al., 2014).</p>
<p>Can also be <code>"kernel"</code> to use kernel density estimation, which calls <code><a href="https://rdrr.io/r/stats/density.html" class="external-link">density()</a></code> to estimate the numerator and denominator densities for the weights. (This used to be requested by setting <code>use.kernel = TRUE</code>, which is now deprecated.)</p>
<p>If unspecified, a density corresponding to the argument passed to <code>distribution</code>. If <code>"gaussian"</code> (the default), <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm()</a></code> is used. If <code>"tdist"</code>, a t-distribution with 4 degrees of freedom is used. If <code>"laplace"</code>, a laplace distribution is used.</p></dd>

<dt><code>bw</code>, <code>adjust</code>, <code>kernel</code>, <code>n</code></dt>
<dd><p>If <code>density = "kernel"</code>, the arguments to <code><a href="https://rdrr.io/r/stats/density.html" class="external-link">density()</a></code>. The defaults are the same as those in <code><a href="https://rdrr.io/r/stats/density.html" class="external-link">density()</a></code> except that <code>n</code> is 10 times the number of units in the sample.</p></dd>

<dt><code>plot</code></dt>
<dd><p>If <code>density = "kernel"</code>, whether to plot the estimated densities.</p></dd>


</dl><p>For tunable arguments, multiple entries may be supplied, and <code><a href="weightit.html">weightit()</a></code>
will choose the best value by optimizing the criterion specified in
<code>criterion</code>. See below for additional outputs that are included when
arguments are supplied to be tuned. See Examples for an example of tuning.
The same seed is used for every run to ensure any variation in performance
across tuning parameters is due to the specification and not to using a
random seed. This only matters when <code>bag.fraction</code> differs from 1 (its
default) or cross-validation is used as the criterion; otherwise, there are
no random components in the model.</p>
    </div>
    <div class="section level2">
    <h2 id="additional-outputs">Additional Outputs<a class="anchor" aria-label="anchor" href="#additional-outputs"></a></h2>



<dl><dt><code>info</code></dt>
<dd><p>A list with the following entries:</p><dl><dt><code>best.tree</code></dt>
<dd><p>The number of trees at the optimum. If this is close to <code>n.trees</code>, <code><a href="weightit.html">weightit()</a></code> should be rerun with a larger value for <code>n.trees</code>, and <code>start.tree</code> can be set to just below <code>best.tree</code>. When other parameters are tuned, this is the best tree value in the best combination of tuned parameters. See example.</p></dd>

<dt><code>tree.val</code></dt>
<dd><p>A data frame with two columns: the first is the number of trees and the second is the value of the criterion corresponding to that tree. When other parameters are tuned, these are the number of trees and the criterion values in the best combination of tuned parameters. See example.</p></dd>


</dl><p>If any arguments are to be tuned (i.e., they have been supplied more than one value), the following two additional components are included in <code>info</code>:</p><dl><dt><code>tune</code></dt>
<dd><p>A data frame with a column for each argument being tuned, the best value of the balance criterion for the given combination of parameters, and the number of trees at which the best value was reached.</p></dd>

<dt><code>best.tune</code></dt>
<dd><p>A one-row data frame containing the values of the arguments being tuned that were ultimately selected to estimate the returned weights.</p></dd>


</dl></dd>

<dt><code>obj</code></dt>
<dd><p>When <code>include.obj = TRUE</code>, the <code>gbm</code> fit used to generate the predicted values.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<div class="section">
<h3 id="binary-treatments-1">Binary treatments<a class="anchor" aria-label="anchor" href="#binary-treatments-1"></a></h3>


<p>McCaffrey, D. F., Ridgeway, G., &amp; Morral, A. R. (2004). Propensity Score Estimation With Boosted Regression for Evaluating Causal Effects in Observational Studies. <em>Psychological Methods</em>, 9(4), 403–425. <a href="https://doi.org/10.1037/1082-989X.9.4.403" class="external-link">doi:10.1037/1082-989X.9.4.403</a></p>
</div>

<div class="section">
<h3 id="multi-category-treatments-1">Multi-Category Treatments<a class="anchor" aria-label="anchor" href="#multi-category-treatments-1"></a></h3>


<p>McCaffrey, D. F., Griffin, B. A., Almirall, D., Slaughter, M. E., Ramchand, R., &amp; Burgette, L. F. (2013). A Tutorial on Propensity Score Estimation for Multiple Treatments Using Generalized Boosted Models. <em>Statistics in Medicine</em>, 32(19), 3388–3414. <a href="https://doi.org/10.1002/sim.5753" class="external-link">doi:10.1002/sim.5753</a></p>
</div>

<div class="section">
<h3 id="continuous-treatments-1">Continuous treatments<a class="anchor" aria-label="anchor" href="#continuous-treatments-1"></a></h3>


<p>Zhu, Y., Coffman, D. L., &amp; Ghosh, D. (2015). A Boosting Algorithm for Estimating Generalized Propensity Scores with Continuous Treatments. <em>Journal of Causal Inference</em>, 3(1). <a href="https://doi.org/10.1515/jci-2014-0022" class="external-link">doi:10.1515/jci-2014-0022</a></p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="weightit.html">weightit()</a></code>, <code><a href="weightitMSM.html">weightitMSM()</a></code></p>
<p><code><a href="https://rdrr.io/pkg/gbm/man/gbm.fit.html" class="external-link">gbm::gbm.fit()</a></code> for the fitting function.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates between treatment groups (binary)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"gbm"</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span>,</span></span>
<span class="r-in"><span>                criterion <span class="op">=</span> <span class="st">"smd.max"</span>,</span></span>
<span class="r-in"><span>                use.offset <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "gbm" (propensity score weighting with GBM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Min                                  Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated 1.133 |---------------------------| 22.939</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control 1.007 |------|                       6.886</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             184    183    182    181    177</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  treated 10.484 11.097 15.942 18.361 22.939</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             423    407    384    224    189</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  control  3.913  3.978  4.087  4.151  6.886</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treated       1.049 0.558   0.306       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> control       0.381 0.218   0.051       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted  429.    185.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted    374.69   88.35</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Type Diff.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score Distance   0.6920</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age         Contin.  -0.1894</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ        Contin.   0.0767</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      Binary  -0.0734</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     Binary   0.0249</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        Contin.   0.1111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted  429.    185.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted    374.69   88.35</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View information about the fitting process</span></span></span>
<span class="r-in"><span><span class="va">W1</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">best.tree</span> <span class="co">#best tree</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 464 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W1</span><span class="op">)</span> <span class="co">#plot of criterion value against number of trees</span></span></span>
<span class="r-plt img"><img src="method_gbm-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates with respect to race (multi-category)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">race</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"gbm"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span></span>
<span class="r-in"><span>                focal <span class="op">=</span> <span class="st">"hispan"</span>, criterion <span class="op">=</span> <span class="st">"ks.mean"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "gbm" (propensity score weighting with GBM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 3-category (black, hispan, white)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: hispan)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Min                                 Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> black  0.067  |------------------------|   1.059</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hispan 1.                             ||   1.   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> white  0.037 |---------------------------| 1.152</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           158   157   155   154   139</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   black 0.908 0.954 0.954 1.043 1.059</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             1     2     3     4     5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  hispan     1     1     1     1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           253   192   156    45     6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   white 0.688 0.721 0.813 0.834 1.152</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> black        0.719 0.523   0.211       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hispan       0.000 0.000   0.000       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> white        0.641 0.483   0.180       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             black hispan  white</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted 243.       72 299.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted   160.38     72 212.12</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W2</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"ks"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance summary across all treatment pairs</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Max.Diff.Adj Max.KS.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.       0.0823     0.0887</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.       0.2987     0.1272</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary       0.1170     0.1170</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary       0.0658     0.0658</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.       0.0308     0.0934</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             black  white hispan</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 243.   299.       72</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   160.38 212.12     72</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Balancing covariates with respect to re75 (continuous)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W3</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">re75</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"gbm"</span>, density <span class="op">=</span> <span class="st">"kernel"</span>,</span></span>
<span class="r-in"><span>                criterion <span class="op">=</span> <span class="st">"p.rms"</span>, trim.at <span class="op">=</span> <span class="fl">.97</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "gbm" (propensity score weighting with GBM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: continuous</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">W3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   <span style="text-decoration: underline;">Summary of weights</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight ranges</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Min                                  Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> all 0.07 |---------------------------| 11.818</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Units with the 5 most extreme weights</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         308    354    375    395    407</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  all 11.818 11.818 11.818 11.818 11.818</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Weight statistics</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Coef of Var   MAD Entropy # Zeros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> all       1.244 0.839   0.524       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - <span style="font-style: italic;">Effective Sample Sizes</span>:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unweighted 614.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weighted   241.25</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Corr.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.   0.0031</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.   0.0158</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary   0.0410</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary  -0.0242</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.   0.0927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 614.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   241.25</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Using a t(3) density and illustrating the search for</span></span></span>
<span class="r-in"><span><span class="co">#more trees.</span></span></span>
<span class="r-in"><span><span class="va">W4a</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">re75</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"gbm"</span>, density <span class="op">=</span> <span class="st">"dt_3"</span>,</span></span>
<span class="r-in"><span>                criterion <span class="op">=</span> <span class="st">"p.max"</span>,</span></span>
<span class="r-in"><span>                n.trees <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">W4a</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">best.tree</span> <span class="co">#10000; optimum hasn't been found</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10000 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W4a</span><span class="op">)</span> <span class="co">#decreasing at right edge</span></span></span>
<span class="r-plt img"><img src="method_gbm-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">W4b</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">re75</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"gbm"</span>, density <span class="op">=</span> <span class="st">"dt_3"</span>,</span></span>
<span class="r-in"><span>                criterion <span class="op">=</span> <span class="st">"p.max"</span>,</span></span>
<span class="r-in"><span>                start.tree <span class="op">=</span> <span class="fl">10000</span>,</span></span>
<span class="r-in"><span>                n.trees <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">W4b</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">best.tree</span> <span class="co">#13417; optimum has been found</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13417 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W4b</span><span class="op">)</span> <span class="co">#increasing at right edge</span></span></span>
<span class="r-plt img"><img src="method_gbm-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W4b</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Type Corr.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      Contin.   0.0362</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ     Contin.   0.0502</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married   Binary   0.0717</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree  Binary  -0.0665</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74     Contin.   0.1041</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted 614.  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted   251.08</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Tuning hyperparameters</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">W5</span> <span class="op">&lt;-</span> <span class="fu"><a href="weightit.html">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                method <span class="op">=</span> <span class="st">"gbm"</span>, estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span></span>
<span class="r-in"><span>                criterion <span class="op">=</span> <span class="st">"ks.max"</span>,</span></span>
<span class="r-in"><span>                interaction.depth <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,</span></span>
<span class="r-in"><span>                distribution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bernoulli"</span>, <span class="st">"adaboost"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A <span style="font-style: italic;">weightit</span> object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: "gbm" (propensity score weighting with GBM)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - treatment: 2-category</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - estimand: ATT (focal: 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, nodegree, re74</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">W5</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">tune</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   interaction.depth shrinkage distribution use.offset best.ks.max best.tree</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                 2      0.01    bernoulli      FALSE  0.06704768      4836</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                 3      0.01    bernoulli      FALSE  0.06517037      2171</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                 4      0.01    bernoulli      FALSE  0.06988698      1588</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4                 2      0.01     adaboost      FALSE  0.05894705      2311</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                 3      0.01     adaboost      FALSE  0.06485408      1514</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                 4      0.01     adaboost      FALSE  0.06591365      1232</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">W5</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">best.tune</span> <span class="co">#Best values of tuned parameters</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   interaction.depth shrinkage distribution use.offset best.ks.max best.tree</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4                 2      0.01     adaboost      FALSE  0.05894705      2311</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">W5</span><span class="op">)</span> <span class="co">#plot criterion values against number of trees</span></span></span>
<span class="r-plt img"><img src="method_gbm-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W5</span>, stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"ks"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Balance Measures</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Type Diff.Adj KS.Adj</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prop.score Distance   0.2909 0.1727</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age         Contin.   0.0596 0.0589</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ        Contin.  -0.0006 0.0547</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      Binary  -0.0135 0.0135</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     Binary   0.0547 0.0547</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        Contin.   0.0683 0.0309</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Effective sample sizes</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unadjusted  429.       185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adjusted     42.01     185</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

