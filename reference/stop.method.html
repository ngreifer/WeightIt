<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Balance criteria for tuning — stop.method • WeightIt</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Balance criteria for tuning — stop.method" />
<meta property="og:description" content="Some methods involve tuning of parameters and use some measure of covariate balance as the crierion to select the optimal parameter values. For example with method = &quot;gbm&quot;, a balance criterion can be used to select the optimal number of trees to use. In WeightIt, the argument stop.method controls which criterion is optimized, using the naming conventions originally used in twang. This page documents the available arguments to stop.method. There has been some research on which balance criteria perform better than others; see the References section for some articles. Of course, how each method fares in any given dataset depends on a variety of factors, and multiple methods should be tried and compared before moving forward with a set of weights.
Each treatment type has its own balance criteria available.
Binary Treatments


&quot;es.mean&quot;, &quot;es.max&quot;, &quot;es.rms&quot;The average, maximum, or root mean squared absolute standardized mean difference (ASMD) among the covariates, respectively. The ASMD is computed using col_w_smd() in cobalt. All covariates are standardized, including binary covariates (note that in cobalt, raw mean differences are used for binary variables by default). The standardization factor (i.e., s.d.denom) depends on the estimand requested and follows the conventions used in cobalt.
&quot;ks.mean&quot;, &quot;ks.max&quot;, &quot;ks.rms&quot;The average, maximum, or root mean squared Kolmogorov-Smirnov (KS) statistic among the covariates, respectively. The KS statistic is computed using col_w_ks() in cobalt.
&quot;mahalanobis&quot;The sample Mahalanobis distace in the weighted sample. This is similar to &quot;es.rms&quot; except that variables that are redundant with each other will be downweighted. The sample Mahalanobis distance is computed using the (generalized) inverse of the unweighted covariance matrix computed in the focal group when the estimand is the ATT or ATC and using the (generalized) inverse of the average of the unweighted covariance matrices computed within each treatment group (analogous the the ASMD, which uses the average of the group variances in its denominator).
&quot;energy.dist&quot;The energy distance between the weighted samples, as described by Huling &amp;amp; Mak (2020). The &quot;improved&quot; energy distance is used when the estimand is not the ATT. (Note that weights directly minimizing the energy distance can be found using method = &quot;energy&quot;.)
&quot;r2&quot;The pseudo-R2 of a logistic regression of the treatment on the covariates with the weights applied. Fraklin et al. (2014) consider a similar metric, the post-matching C-statistic, but the pseduo-R2 accomplishes the same goal without requiring a decision boundary. The pseudo-R2 used is the McKelvy &amp;amp; Zavoina pseudo-R2.



Multinomial Treatments


&quot;es.mean&quot;, &quot;es.max&quot;, &quot;es.rms&quot;The average, maximum, or root mean squared absolute standardized mean difference (ASMD) among the covariates, respectively, across all pairs of treatments. The ASMD is computed using col_w_smd() in cobalt. All covariates are standardized, including binary covariates (note that in cobalt, raw mean differences are used for binary variables by default). The standardization factor (i.e., s.d.denom) depends on the estimand requested and follows the conventions used in cobalt. The same standardization factor is used across treatment pairs for each covariate. When the estimand is the ATT, only differences between the focal group and each other group are computed.
&quot;ks.mean&quot;, &quot;ks.max&quot;, &quot;ks.rms&quot;The average, maximum, or root mean squared Kolmogorov-Smirnov (KS) statistic among the covariates, respectively, across all pairs of treatments. The KS statistic is computed using col_w_ks() in cobalt. When the estimand is the ATT, only differences between the focal group and each other group are computed.
&quot;energy.dist&quot;The total energy distance among the weighted samples, as described by Huling &amp;amp; Mak (2020). The &quot;improved&quot; energy distance is used when the estimand is not the ATT. (Note that weights directly minimizing the energy distance can be found using method = &quot;energy&quot;.)



Continuous Treatments


&quot;p.mean&quot;, &quot;p.max&quot;, &quot;p.rms&quot;The average, maximum, or root mean squared absolute Pearson correlation between the treatment and covariates, respectively. The Pearson correlation is computed using col_w_cov() in cobalt. The correlation uses the unweighted standard deviations of the treatment and covariates in the denominator.
&quot;s.mean&quot;, &quot;s.max&quot;, &quot;s.rms&quot;The average, maximum, or root mean squared absolute Spearman correlation between the treatment and covariates, respectively. The Spearman correlation is computed using col_w_cov() in cobalt. The correlation uses the unweighted standard deviations of the rank-transformed treatment and covariates in the denominator.
&quot;r2&quot;The model R2 of a linear regression of the treatment on the covariates with the weights applied. The standard R2 is used.



" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WeightIt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/WeightIt_A0_basic_use.html">Using WeightIt to Estimate Balancing Weights</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ngreifer/WeightIt/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Balance criteria for tuning</h1>
    
    <div class="hidden name"><code>stop.method.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Some methods involve tuning of parameters and use some measure of covariate balance as the crierion to select the optimal parameter values. For example with <code><a href='https://rdrr.io/pkg/WeightIt/man/method-gbm.html'>method = "gbm"</a></code>, a balance criterion can be used to select the optimal number of trees to use. In <span class="pkg">WeightIt</span>, the argument <code>stop.method</code> controls which criterion is optimized, using the naming conventions originally used in <span class="pkg">twang</span>. This page documents the available arguments to <code>stop.method</code>. There has been some research on which balance criteria perform better than others; see the References section for some articles. Of course, how each method fares in any given dataset depends on a variety of factors, and multiple methods should be tried and compared before moving forward with a set of weights.</p>
<p>Each treatment type has its own balance criteria available.</p>
<h3>Binary Treatments</h3>

<dl>
<dt><code>"es.mean"</code>, <code>"es.max"</code>, <code>"es.rms"</code></dt><dd><p>The average, maximum, or root mean squared absolute standardized mean difference (ASMD) among the covariates, respectively. The ASMD is computed using <code><a href='https://rdrr.io/pkg/cobalt/man/balance.summary.html'>col_w_smd()</a></code> in <span class="pkg">cobalt</span>. All covariates are standardized, including binary covariates (note that in <span class="pkg">cobalt</span>, raw mean differences are used for binary variables by default). The standardization factor (i.e., <code>s.d.denom</code>) depends on the estimand requested and follows the conventions used in <span class="pkg">cobalt</span>.</p></dd>
<dt><code>"ks.mean"</code>, <code>"ks.max"</code>, <code>"ks.rms"</code></dt><dd><p>The average, maximum, or root mean squared Kolmogorov-Smirnov (KS) statistic among the covariates, respectively. The KS statistic is computed using <code><a href='https://rdrr.io/pkg/cobalt/man/balance.summary.html'>col_w_ks()</a></code> in <span class="pkg">cobalt</span>.</p></dd>
<dt><code>"mahalanobis"</code></dt><dd><p>The sample Mahalanobis distace in the weighted sample. This is similar to <code>"es.rms"</code> except that variables that are redundant with each other will be downweighted. The sample Mahalanobis distance is computed using the (generalized) inverse of the unweighted covariance matrix computed in the focal group when the estimand is the ATT or ATC and using the (generalized) inverse of the average of the unweighted covariance matrices computed within each treatment group (analogous the the ASMD, which uses the average of the group variances in its denominator).</p></dd>
<dt><code>"energy.dist"</code></dt><dd><p>The energy distance between the weighted samples, as described by Huling &amp; Mak (2020). The "improved" energy distance is used when the estimand is not the ATT. (Note that weights directly minimizing the energy distance can be found using <code><a href='https://rdrr.io/pkg/WeightIt/man/method-energy.html'>method = "energy"</a></code>.)</p></dd>
<dt><code>"r2"</code></dt><dd><p>The pseudo-R2 of a logistic regression of the treatment on the covariates with the weights applied. Fraklin et al. (2014) consider a similar metric, the post-matching C-statistic, but the pseduo-R2 accomplishes the same goal without requiring a decision boundary. The pseudo-R2 used is the McKelvy &amp; Zavoina pseudo-R2.</p></dd>

</dl>

<h3>Multinomial Treatments</h3>

<dl>
<dt><code>"es.mean"</code>, <code>"es.max"</code>, <code>"es.rms"</code></dt><dd><p>The average, maximum, or root mean squared absolute standardized mean difference (ASMD) among the covariates, respectively, across all pairs of treatments. The ASMD is computed using <code><a href='https://rdrr.io/pkg/cobalt/man/balance.summary.html'>col_w_smd()</a></code> in <span class="pkg">cobalt</span>. All covariates are standardized, including binary covariates (note that in <span class="pkg">cobalt</span>, raw mean differences are used for binary variables by default). The standardization factor (i.e., <code>s.d.denom</code>) depends on the estimand requested and follows the conventions used in <span class="pkg">cobalt</span>. The same standardization factor is used across treatment pairs for each covariate. When the estimand is the ATT, only differences between the focal group and each other group are computed.</p></dd>
<dt><code>"ks.mean"</code>, <code>"ks.max"</code>, <code>"ks.rms"</code></dt><dd><p>The average, maximum, or root mean squared Kolmogorov-Smirnov (KS) statistic among the covariates, respectively, across all pairs of treatments. The KS statistic is computed using <code><a href='https://rdrr.io/pkg/cobalt/man/balance.summary.html'>col_w_ks()</a></code> in <span class="pkg">cobalt</span>. When the estimand is the ATT, only differences between the focal group and each other group are computed.</p></dd>
<dt><code>"energy.dist"</code></dt><dd><p>The total energy distance among the weighted samples, as described by Huling &amp; Mak (2020). The "improved" energy distance is used when the estimand is not the ATT. (Note that weights directly minimizing the energy distance can be found using <code><a href='https://rdrr.io/pkg/WeightIt/man/method-energy.html'>method = "energy"</a></code>.)</p></dd>

</dl>

<h3>Continuous Treatments</h3>

<dl>
<dt><code>"p.mean"</code>, <code>"p.max"</code>, <code>"p.rms"</code></dt><dd><p>The average, maximum, or root mean squared absolute Pearson correlation between the treatment and covariates, respectively. The Pearson correlation is computed using <code><a href='https://rdrr.io/pkg/cobalt/man/balance.summary.html'>col_w_cov()</a></code> in <span class="pkg">cobalt</span>. The correlation uses the unweighted standard deviations of the treatment and covariates in the denominator.</p></dd>
<dt><code>"s.mean"</code>, <code>"s.max"</code>, <code>"s.rms"</code></dt><dd><p>The average, maximum, or root mean squared absolute Spearman correlation between the treatment and covariates, respectively. The Spearman correlation is computed using <code><a href='https://rdrr.io/pkg/cobalt/man/balance.summary.html'>col_w_cov()</a></code> in <span class="pkg">cobalt</span>. The correlation uses the unweighted standard deviations of the rank-transformed treatment and covariates in the denominator.</p></dd>
<dt><code>"r2"</code></dt><dd><p>The model R2 of a linear regression of the treatment on the covariates with the weights applied. The standard R2 is used.</p></dd>

</dl>


    </div>



    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Ali, M. S., Groenwold, R. H. H., Pestman, W. R., Belitser, S. V., Roes, K. C. B., Hoes, A. W., de Boer, A., &amp; Klungel, O. H. (2014). Propensity score balance measures in pharmacoepidemiology: A simulation study. Pharmacoepidemiology and Drug Safety, 23(8), 802–811. doi: <a href='https://doi.org/10.1002/pds.3574'>10.1002/pds.3574</a></p>
<p>Belitser, S. V., Martens, E. P., Pestman, W. R., Groenwold, R. H. H., de Boer, A., &amp; Klungel, O. H. (2011). Measuring balance and model selection in propensity score methods. Pharmacoepidemiology and Drug Safety, 20(11), 1115–1129. doi: <a href='https://doi.org/10.1002/pds.2188'>10.1002/pds.2188</a></p>
<p>Franklin, J. M., Rassen, J. A., Ackermann, D., Bartels, D. B., &amp; Schneeweiss, S. (2014). Metrics for covariate balance in cohort studies of causal effects. Statistics in Medicine, 33(10), 1685–1699. doi: <a href='https://doi.org/10.1002/sim.6058'>10.1002/sim.6058</a></p>
<p>Huling, J. D., &amp; Mak, S. (2020). Energy Balancing of Covariate Distributions. ArXiv:2004.13962 [Stat]. http://arxiv.org/abs/2004.13962</p>
<p>Griffin, B. A., McCaffrey, D. F., Almirall, D., Burgette, L. F., &amp; Setodji, C. M. (2017). Chasing Balance and Other Recommendations for Improving Nonparametric Propensity Score Models. Journal of Causal Inference, 5(2). doi: <a href='https://doi.org/10.1515/jci-2015-0026'>10.1515/jci-2015-0026</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/pkg/WeightIt/man/method-gbm.html'>method_gbm</a></code>, <code><a href='https://rdrr.io/pkg/WeightIt/man/method-super.html'>method_super</a></code>
<code>balance summary</code> in <span class="pkg">cobalt</span> for details of some calculations.</p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


