<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Balance criteria for tuning — stop.method • WeightIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Balance criteria for tuning — stop.method"><meta property="og:description" content='Some methods involve tuning of parameters and use some measure of covariate balance as the criterion to select the optimal parameter values. For example with method = "gbm", a balance criterion can be used to select the optimal number of trees to use. In WeightIt, the argument stop.method controls which criterion is optimized, using the naming conventions originally used in twang. This page documents the available arguments to stop.method. There has been some research on which balance criteria perform better than others; see the References section for some articles. Of course, how each method fares in any given dataset depends on a variety of factors, and multiple methods should be tried and compared before moving forward with a set of weights.
Each treatment type has its own balance criteria available.

Binary Treatments


"es.mean", "es.max", "es.rms"
The average, maximum, or root mean squared absolute standardized mean difference (ASMD) among the covariates, respectively. The ASMD is computed using col_w_smd() in cobalt. All covariates are standardized, including binary covariates (note that in cobalt, raw mean differences are used for binary variables by default). The standardization factor (i.e., s.d.denom) depends on the estimand requested and follows the conventions used in cobalt.

"ks.mean", "ks.max", "ks.rms"
The average, maximum, or root mean squared Kolmogorov-Smirnov (KS) statistic among the covariates, respectively. The KS statistic is computed using col_w_ks() in cobalt.

"mahalanobis"
The sample Mahalanobis distance in the weighted sample. This is similar to "es.rms" except that variables that are redundant with each other will be downweighted. The sample Mahalanobis distance is computed using the (generalized) inverse of the unweighted covariance matrix computed in the focal group when the estimand is the ATT or ATC and using the (generalized) inverse of the average of the unweighted covariance matrices computed within each treatment group (analogous the the ASMD, which uses the average of the group variances in its denominator).

"energy.dist"
The energy distance between the weighted samples, as described by Huling &amp;amp; Mak (2020). The "improved" energy distance is used when the estimand is not the ATT. (Note that weights directly minimizing the energy distance can be found using method = "energy".)

"r2"
The pseudo-R2 of a logistic regression of the treatment on the covariates with the weights applied. Franklin et al. (2014) consider a similar metric, the post-matching C-statistic, but the pseudo-R2 accomplishes the same goal without requiring a decision boundary. The pseudo-R2 used is the McKelvy &amp;amp; Zavoina pseudo-R2.

"L1.med"
The L1 statistic of the weighted samples, which is half the average absolute difference in proportion for categories of a multidimensional histogram formed by coarsening the covariates. The coarsening used is the one that yields the median unweighted L1 statistic among 101 random coarsenings of the data. Each continuous covariate is coarsened into between 2 and 12 bins, and each categorical covariate is combined into between 2 and 12 levels (or however many levels are available). Because the coarsening is random, a seed should be set to ensure results are replicable.






Multinomial Treatments


"es.mean", "es.max", "es.rms"
The average, maximum, or root mean squared absolute standardized mean difference (ASMD) among the covariates, respectively, across all pairs of treatments. The ASMD is computed using col_w_smd() in cobalt. All covariates are standardized, including binary covariates (note that in cobalt, raw mean differences are used for binary variables by default). The standardization factor (i.e., s.d.denom) depends on the estimand requested and follows the conventions used in cobalt. The same standardization factor is used across treatment pairs for each covariate. When the estimand is the ATT, only differences between the focal group and each other group are computed.

"ks.mean", "ks.max", "ks.rms"
The average, maximum, or root mean squared Kolmogorov-Smirnov (KS) statistic among the covariates, respectively, across all pairs of treatments. The KS statistic is computed using col_w_ks() in cobalt. When the estimand is the ATT, only differences between the focal group and each other group are computed.

"energy.dist"
The total energy distance among the weighted samples, as described by Huling &amp;amp; Mak (2020). The "improved" energy distance is used when the estimand is not the ATT. (Note that weights directly minimizing the energy distance can be found using method = "energy".)

"L1.med"
The L1 statistic of the weighted samples, which is the average absolute difference in proportion for categories of a multidimensional histogram formed by coarsening the covariates, divided by the number of treatment levels. The coarsening used is the one that yields the median unweighted L1 statistic among 101 random coarsenings of the data. Each continuous covariate is coarsened into between 2 and 12 bins, and each categorical covariate is combined into between 2 and 12 levels (or however many levels are available). Because the coarsening is random, a seed should be set to ensure results are replicable.






Continuous Treatments


"p.mean", "p.max", "p.rms"
The average, maximum, or root mean squared absolute Pearson correlation between the treatment and covariates, respectively. The Pearson correlation is computed using col_w_cov() in cobalt. The correlation uses the unweighted standard deviations of the treatment and covariates in the denominator.

"s.mean", "s.max", "s.rms"
The average, maximum, or root mean squared absolute Spearman correlation between the treatment and covariates, respectively. The Spearman correlation is computed using col_w_cov() in cobalt. The correlation uses the unweighted standard deviations of the rank-transformed treatment and covariates in the denominator.

"r2"
The model R2 of a linear regression of the treatment on the covariates with the weights applied. The standard R2 is used.

"L1.med"
The L1 statistic of the weighted samples, which is the average absolute difference in proportion for categories of a multidimensional histogram formed by coarsening the covariates nd treatment, divided by the number of levels of the coarsened treatment. The coarsening used is the one that yields the median unweighted L1 statistic among 101 random coarsenings of the data. The treatment and each continuous covariate are coarsened into between 2 and 12 bins, and each categorical covariate is combined into between 2 and 12 levels (or however many levels are available). Because the coarsening is random, a seed should be set to ensure results are replicable.





'><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WeightIt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.13.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/WeightIt.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ngreifer/WeightIt/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Balance criteria for tuning</h1>
    
    <div class="hidden name"><code>stop.method.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Some methods involve tuning of parameters and use some measure of covariate balance as the criterion to select the optimal parameter values. For example with <code><a href="method_gbm.html">method = "gbm"</a></code>, a balance criterion can be used to select the optimal number of trees to use. In <span class="pkg">WeightIt</span>, the argument <code>stop.method</code> controls which criterion is optimized, using the naming conventions originally used in <span class="pkg">twang</span>. This page documents the available arguments to <code>stop.method</code>. There has been some research on which balance criteria perform better than others; see the References section for some articles. Of course, how each method fares in any given dataset depends on a variety of factors, and multiple methods should be tried and compared before moving forward with a set of weights.</p>
<p>Each treatment type has its own balance criteria available.</p>
<div class="section">
<h3 id="binary-treatments">Binary Treatments<a class="anchor" aria-label="anchor" href="#binary-treatments"></a></h3>

<dl><dt><code>"es.mean"</code>, <code>"es.max"</code>, <code>"es.rms"</code></dt>
<dd><p>The average, maximum, or root mean squared absolute standardized mean difference (ASMD) among the covariates, respectively. The ASMD is computed using <code><a href="https://ngreifer.github.io/cobalt/reference/balance.summary.html" class="external-link">col_w_smd()</a></code> in <span class="pkg">cobalt</span>. All covariates are standardized, including binary covariates (note that in <span class="pkg">cobalt</span>, raw mean differences are used for binary variables by default). The standardization factor (i.e., <code>s.d.denom</code>) depends on the estimand requested and follows the conventions used in <span class="pkg">cobalt</span>.</p></dd>

<dt><code>"ks.mean"</code>, <code>"ks.max"</code>, <code>"ks.rms"</code></dt>
<dd><p>The average, maximum, or root mean squared Kolmogorov-Smirnov (KS) statistic among the covariates, respectively. The KS statistic is computed using <code><a href="https://ngreifer.github.io/cobalt/reference/balance.summary.html" class="external-link">col_w_ks()</a></code> in <span class="pkg">cobalt</span>.</p></dd>

<dt><code>"mahalanobis"</code></dt>
<dd><p>The sample Mahalanobis distance in the weighted sample. This is similar to <code>"es.rms"</code> except that variables that are redundant with each other will be downweighted. The sample Mahalanobis distance is computed using the (generalized) inverse of the unweighted covariance matrix computed in the focal group when the estimand is the ATT or ATC and using the (generalized) inverse of the average of the unweighted covariance matrices computed within each treatment group (analogous the the ASMD, which uses the average of the group variances in its denominator).</p></dd>

<dt><code>"energy.dist"</code></dt>
<dd><p>The energy distance between the weighted samples, as described by Huling &amp; Mak (2020). The "improved" energy distance is used when the estimand is not the ATT. (Note that weights directly minimizing the energy distance can be found using <code><a href="method_energy.html">method = "energy"</a></code>.)</p></dd>

<dt><code>"r2"</code></dt>
<dd><p>The pseudo-R2 of a logistic regression of the treatment on the covariates with the weights applied. Franklin et al. (2014) consider a similar metric, the post-matching C-statistic, but the pseudo-R2 accomplishes the same goal without requiring a decision boundary. The pseudo-R2 used is the McKelvy &amp; Zavoina pseudo-R2.</p></dd>

<dt><code>"L1.med"</code></dt>
<dd><p>The L1 statistic of the weighted samples, which is half the average absolute difference in proportion for categories of a multidimensional histogram formed by coarsening the covariates. The coarsening used is the one that yields the median unweighted L1 statistic among 101 random coarsenings of the data. Each continuous covariate is coarsened into between 2 and 12 bins, and each categorical covariate is combined into between 2 and 12 levels (or however many levels are available). Because the coarsening is random, a seed should be set to ensure results are replicable.</p></dd>


</dl></div>
<div class="section">
<h3 id="multinomial-treatments">Multinomial Treatments<a class="anchor" aria-label="anchor" href="#multinomial-treatments"></a></h3>

<dl><dt><code>"es.mean"</code>, <code>"es.max"</code>, <code>"es.rms"</code></dt>
<dd><p>The average, maximum, or root mean squared absolute standardized mean difference (ASMD) among the covariates, respectively, across all pairs of treatments. The ASMD is computed using <code><a href="https://ngreifer.github.io/cobalt/reference/balance.summary.html" class="external-link">col_w_smd()</a></code> in <span class="pkg">cobalt</span>. All covariates are standardized, including binary covariates (note that in <span class="pkg">cobalt</span>, raw mean differences are used for binary variables by default). The standardization factor (i.e., <code>s.d.denom</code>) depends on the estimand requested and follows the conventions used in <span class="pkg">cobalt</span>. The same standardization factor is used across treatment pairs for each covariate. When the estimand is the ATT, only differences between the focal group and each other group are computed.</p></dd>

<dt><code>"ks.mean"</code>, <code>"ks.max"</code>, <code>"ks.rms"</code></dt>
<dd><p>The average, maximum, or root mean squared Kolmogorov-Smirnov (KS) statistic among the covariates, respectively, across all pairs of treatments. The KS statistic is computed using <code><a href="https://ngreifer.github.io/cobalt/reference/balance.summary.html" class="external-link">col_w_ks()</a></code> in <span class="pkg">cobalt</span>. When the estimand is the ATT, only differences between the focal group and each other group are computed.</p></dd>

<dt><code>"energy.dist"</code></dt>
<dd><p>The total energy distance among the weighted samples, as described by Huling &amp; Mak (2020). The "improved" energy distance is used when the estimand is not the ATT. (Note that weights directly minimizing the energy distance can be found using <code><a href="method_energy.html">method = "energy"</a></code>.)</p></dd>

<dt><code>"L1.med"</code></dt>
<dd><p>The L1 statistic of the weighted samples, which is the average absolute difference in proportion for categories of a multidimensional histogram formed by coarsening the covariates, divided by the number of treatment levels. The coarsening used is the one that yields the median unweighted L1 statistic among 101 random coarsenings of the data. Each continuous covariate is coarsened into between 2 and 12 bins, and each categorical covariate is combined into between 2 and 12 levels (or however many levels are available). Because the coarsening is random, a seed should be set to ensure results are replicable.</p></dd>


</dl></div>
<div class="section">
<h3 id="continuous-treatments">Continuous Treatments<a class="anchor" aria-label="anchor" href="#continuous-treatments"></a></h3>

<dl><dt><code>"p.mean"</code>, <code>"p.max"</code>, <code>"p.rms"</code></dt>
<dd><p>The average, maximum, or root mean squared absolute Pearson correlation between the treatment and covariates, respectively. The Pearson correlation is computed using <code><a href="https://ngreifer.github.io/cobalt/reference/balance.summary.html" class="external-link">col_w_cov()</a></code> in <span class="pkg">cobalt</span>. The correlation uses the unweighted standard deviations of the treatment and covariates in the denominator.</p></dd>

<dt><code>"s.mean"</code>, <code>"s.max"</code>, <code>"s.rms"</code></dt>
<dd><p>The average, maximum, or root mean squared absolute Spearman correlation between the treatment and covariates, respectively. The Spearman correlation is computed using <code><a href="https://ngreifer.github.io/cobalt/reference/balance.summary.html" class="external-link">col_w_cov()</a></code> in <span class="pkg">cobalt</span>. The correlation uses the unweighted standard deviations of the rank-transformed treatment and covariates in the denominator.</p></dd>

<dt><code>"r2"</code></dt>
<dd><p>The model R2 of a linear regression of the treatment on the covariates with the weights applied. The standard R2 is used.</p></dd>

<dt><code>"L1.med"</code></dt>
<dd><p>The L1 statistic of the weighted samples, which is the average absolute difference in proportion for categories of a multidimensional histogram formed by coarsening the covariates nd treatment, divided by the number of levels of the coarsened treatment. The coarsening used is the one that yields the median unweighted L1 statistic among 101 random coarsenings of the data. The treatment and each continuous covariate are coarsened into between 2 and 12 bins, and each categorical covariate is combined into between 2 and 12 levels (or however many levels are available). Because the coarsening is random, a seed should be set to ensure results are replicable.</p></dd>


</dl></div>

    </div>


    <div id="references">
    <h2>References</h2>
    <p>Ali, M. S., Groenwold, R. H. H., Pestman, W. R., Belitser, S. V., Roes, K. C. B., Hoes, A. W., de Boer, A., &amp; Klungel, O. H. (2014). Propensity score balance measures in pharmacoepidemiology: A simulation study. Pharmacoepidemiology and Drug Safety, 23(8), 802–811. doi: <a href="https://doi.org/10.1002/pds.3574" class="external-link">10.1002/pds.3574</a></p>
<p>Belitser, S. V., Martens, E. P., Pestman, W. R., Groenwold, R. H. H., de Boer, A., &amp; Klungel, O. H. (2011). Measuring balance and model selection in propensity score methods. Pharmacoepidemiology and Drug Safety, 20(11), 1115–1129. doi: <a href="https://doi.org/10.1002/pds.2188" class="external-link">10.1002/pds.2188</a></p>
<p>Franklin, J. M., Rassen, J. A., Ackermann, D., Bartels, D. B., &amp; Schneeweiss, S. (2014). Metrics for covariate balance in cohort studies of causal effects. Statistics in Medicine, 33(10), 1685–1699. doi: <a href="https://doi.org/10.1002/sim.6058" class="external-link">10.1002/sim.6058</a></p>
<p>Huling, J. D., &amp; Mak, S. (2020). Energy Balancing of Covariate Distributions. ArXiv:2004.13962 [Stat]. <a href="https://arxiv.org/abs/2004.13962" class="external-link">https://arxiv.org/abs/2004.13962</a></p>
<p>Griffin, B. A., McCaffrey, D. F., Almirall, D., Burgette, L. F., &amp; Setodji, C. M. (2017). Chasing Balance and Other Recommendations for Improving Nonparametric Propensity Score Models. Journal of Causal Inference, 5(2). doi: <a href="https://doi.org/10.1515/jci-2015-0026" class="external-link">10.1515/jci-2015-0026</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="method_gbm.html">method_gbm</a></code>, <code><a href="method_super.html">method_super</a></code>, which use these balance criteria.</p>
<p><code>balance summary</code> in <span class="pkg">cobalt</span> for details of some calculations.</p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

