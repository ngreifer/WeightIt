<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Compute weights from propensity scores — get_w_from_ps • WeightIt</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Compute weights from propensity scores — get_w_from_ps" />
<meta property="og:description" content="Given a vector or matrix of propensity scores, outputs a vector of weights that target the provided estimand." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WeightIt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/WeightIt_A0_basic_use.html">Using WeightIt to Estimate Balancing Weights</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ngreifer/WeightIt/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute weights from propensity scores</h1>
    
    <div class="hidden name"><code>get_w_from_ps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Given a vector or matrix of propensity scores, outputs a vector of weights that target the provided estimand.</p>
    </div>

    <pre class="usage"><span class='fu'>get_w_from_ps</span>(<span class='kw'>ps</span>,
              <span class='kw'>treat</span>,
              estimand = <span class='st'>"ATE"</span>,
              focal = <span class='kw'>NULL</span>,
              treated = <span class='kw'>NULL</span>,
              subclass = <span class='kw'>NULL</span>,
              stabilize = <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>ps</th>
      <td><p>A vector, matrix, or data frame of propensity scores. See Details.</p></td>
    </tr>
    <tr>
      <th>treat</th>
      <td><p>A vector of treatment status for each individual. See Details.</p></td>
    </tr>
    <tr>
      <th>estimand</th>
      <td><p>The desired estimand that the weights should target. Current options include "ATE" (average treatment effect), "ATT" (average treatment effect on the treated), "ATC" (average treatment effect on the control), "ATO" (average treatment effect in the overlap), "ATM" (average treatment effect in the matched sample), and "ATOS" (average treatment effect in the optimal subset).</p></td>
    </tr>
    <tr>
      <th>focal</th>
      <td><p>When the estimand is the ATT or ATC, which group should be consider the (focal) "treated" or "control" group, respectively. If not <code>NULL</code> and <code>estimand</code> is not "ATT" or "ATC", <code>estimand</code> will automatically be set to "ATT".</p></td>
    </tr>
    <tr>
      <th>treated</th>
      <td><p>When treatment is binary, the value of <code>treat</code> that is considered the "treated" group (i.e., the group for which the propensity scores are the probability of being in). If <code>NULL</code>, <code>get_w_from_ps</code> will attempt to figure it out on its own using some heuristics. This really only matters when <code>treat</code> has values other than 0 and 1 and when <code>ps</code> is given as a vector or an unnamed single-column matrix or data frame.</p></td>
    </tr>
    <tr>
      <th>subclass</th>
      <td><p><code>numeric</code>; the number of subclasses to use when computing weights using marginal mean weighting through stratification (also known as fine stratification). If <code>NULL</code>, standard inverse probability weights (and their extensions) will be computed; if a number greater than 1, subclasses will be formed and weights will be computed based on subclass membership. <code>estimand</code> must be ATE, ATT, or ATC if <code>subclass</code> is non-<code>NULL</code>. See Details.</p></td>
    </tr>
    <tr>
      <th>stabilize</th>
      <td><p><code>logical</code>; whether to compute stabilized weights or not. This simply involves multiplying each unit's weight by the proportion of units in their treatment group. For saturated outcome models and in balance checking, this won't make a difference; otherwise, this can improve performance.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>get_w_from_ps</code> applies the formula for computing weights from propensity scores for the desired estimand. See the References section for information on these estimands and the formulas.</p>
<p><code>ps</code> can be entered a variety of ways. For binary treatments, when <code>ps</code> is entered as a vector or unnamed single-column matrix or data frame, <code>get_w_from_ps</code> has to know which value of <code>treat</code> corresponds to the "treated" group. For 0/1 variables, 1 will be considered treated. For other types of variables, <code>get_w_from_ps</code> will try to figure it out using heuristics, but it's safer to supply an argument to <code>treated</code>. When <code>estimand</code> is "ATT" or "ATC", supplying a value to <code>focal</code> is sufficient (for ATT, <code>focal</code> is the treated group, and for ATC, <code>focal</code> is the control group). When entered as a matrix or data frame, the columns must be named with the levels of the treatment, and it is assumed that each column corresponds to the probability of being in that treatment group. This is the safest way to supply <code>ps</code> unless <code>treat</code> is a 0/1 variable.</p>
<p>For multi-category treatments, <code>ps</code> can be entered as a vector or a matrix or data frame. When entered as a vector, it is assumed the value corresponds to the probability of being in the treatment actually received; this is only possible when the estimand is "ATE". Otherwise, <code>ps</code> must be entered as a named matrix or data frame as described above for binary treatments. When the estimand is "ATT" or "ATC", a value for <code>focal</code> must be specified.</p>
<p>When <code>subclass</code> is not <code>NULL</code>, marginal mean weighting through stratification (MMWS) weights are computed. The implementation differs slightly from that described in Hong (2010, 2012). First, subclasses are formed by finding the quantiles of the propensity scores in the target group (for the ATE, all units; for the ATT or ATC, just the units in the focal group). Any subclasses lacking members of a treatment group will be filled in with them from neighboring subclasses so each subclass will always have at least one member of each treatment group. A new subclass-propensity score matrix is formed, where each unit's subclass-propensity score for each treatment value is computed as the proportion of units with that treatment value in the unit's subclass. For example, if a subclass had 10 treated units and 90 control units in it, the subclass-propensity score for being treated would be .1 and the subclass-propensity score for being control would be .9 for all units in the subclass. For multi-category treatments, the propensity scores for each treatment are stratified separately as described in Hong (2012); for binary treatments, only one set of propensity scores are stratified and the subclass-propensity scores for the other treatment are computed as the complement of the propensity scores for the stratified treatment. After the subclass-propensity scores have been computed, the standard propensity score weighting formulas are used to compute the unstabilized MMWS weights. To estimate MMWS weights equivalent to those described in Hong (2010, 2012), <code>stabilize</code> must be set to <code>TRUE</code>, but, as with standard propensity score weights, this is optional. Note that MMWS weights are also known as fine stratification weights and described by Desai et al. (2017).</p>
<p><code>get_w_from_ps</code> is not compatible with continuous treatments.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A vector of weights. When <code>subclass</code> is not <code>NULL</code>, the subclasses are returned as the <code>"subclass"</code> attribute. When <code>estimand = "ATOS"</code>, the chosen value of <code>alpha</code> (the smallest propensity score allowed to remain in the sample) is returned in the <code>"alpha"</code> attribute.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Noah Greifer</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p><strong>Binary treatments</strong></p>
<p>- <code>estimand = "ATO"</code></p>
<p>Li, F., Morgan, K. L., &amp; Zaslavsky, A. M. (2018). Balancing covariates via propensity score weighting. Journal of the American Statistical Association, 113(521), 390–400. doi: <a href='https://doi.org/10.1080/01621459.2016.1260466'>10.1080/01621459.2016.1260466</a></p>
<p>- <code>estimand = "ATM"</code></p>
<p>Li, L., &amp; Greene, T. (2013). A Weighting Analogue to Pair Matching in Propensity Score Analysis. The International Journal of Biostatistics, 9(2). doi: <a href='https://doi.org/10.1515/ijb-2012-0030'>10.1515/ijb-2012-0030</a></p>
<p>- <code>estimand = "ATOS"</code></p>
<p>Crump, R. K., Hotz, V. J., Imbens, G. W., &amp; Mitnik, O. A. (2009). Dealing with limited overlap in estimation of average treatment effects. Biometrika, 96(1), 187–199. doi: <a href='https://doi.org/10.1093/biomet/asn055'>10.1093/biomet/asn055</a></p>
<p>- Other estimands</p>
<p>Austin, P. C. (2011). An Introduction to Propensity Score Methods for Reducing the Effects of Confounding in Observational Studies. Multivariate Behavioral Research, 46(3), 399–424. doi: <a href='https://doi.org/10.1080/00273171.2011.568786'>10.1080/00273171.2011.568786</a></p>
<p>- Marginal mean weighting through stratification (MMWS)</p>
<p>Hong, G. (2010). Marginal mean weighting through stratification: Adjustment for selection bias in multilevel data. Journal of Educational and Behavioral Statistics, 35(5), 499–531. doi: <a href='https://doi.org/10.3102/1076998609359785'>10.3102/1076998609359785</a></p>
<p>Desai, R. J., Rothman, K. J., Bateman, B. . T., Hernandez-Diaz, S., &amp; Huybrechts, K. F. (2017). A Propensity-score-based Fine Stratification Approach for Confounding Adjustment When Exposure Is Infrequent: Epidemiology, 28(2), 249–257. doi: <a href='https://doi.org/10.1097/EDE.0000000000000595'>10.1097/EDE.0000000000000595</a></p>
<p><strong>Multinomial Treatments</strong></p>
<p>- <code>estimand = "ATO"</code></p>
<p>Li, F., &amp; Li, F. (2019). Propensity score weighting for causal inference with multiple treatments. The Annals of Applied Statistics, 13(4), 2389–2415. doi: <a href='https://doi.org/10.1214/19-AOAS1282'>10.1214/19-AOAS1282</a></p>
<p>- <code>estimand = "ATM"</code></p>
<p>Yoshida, K., Hernández-Díaz, S., Solomon, D. H., Jackson, J. W., Gagne, J. J., Glynn, R. J., &amp; Franklin, J. M. (2017). Matching weights to simultaneously compare three treatment groups: Comparison to three-way matching. Epidemiology (Cambridge, Mass.), 28(3), 387–395. doi: <a href='https://doi.org/10.1097/EDE.0000000000000627'>10.1097/EDE.0000000000000627</a></p>
<p>- Other estimands</p>
<p>McCaffrey, D. F., Griffin, B. A., Almirall, D., Slaughter, M. E., Ramchand, R., &amp; Burgette, L. F. (2013). A Tutorial on Propensity Score Estimation for Multiple Treatments Using Generalized Boosted Models. Statistics in Medicine, 32(19), 3388–3414. doi: <a href='https://doi.org/10.1002/sim.5753'>10.1002/sim.5753</a></p>
<p>- Marginal mean weighting through stratification</p>
<p>Hong, G. (2012). Marginal mean weighting through stratification: A generalized method for evaluating multivalued and multiple treatments with nonexperimental data. Psychological Methods, 17(1), 44–60. doi: <a href='https://doi.org/10.1037/a0024918'>10.1037/a0024918</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='method_ps.html'>method_ps</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='st'><a href='https://github.com/ngreifer/cobalt'>"cobalt"</a></span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"lalonde"</span>, package = <span class='st'>"cobalt"</span>)

<span class='kw'>ps.fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span>(<span class='kw'>treat</span> <span class='op'>~</span> <span class='kw'>age</span> <span class='op'>+</span> <span class='kw'>educ</span> <span class='op'>+</span> <span class='kw'>race</span> <span class='op'>+</span> <span class='kw'>married</span> <span class='op'>+</span>
                <span class='kw'>nodegree</span> <span class='op'>+</span> <span class='kw'>re74</span> <span class='op'>+</span> <span class='kw'>re75</span>, data = <span class='kw'>lalonde</span>,
              family = <span class='kw'>binomial</span>)
<span class='kw'>ps</span> <span class='op'>&lt;-</span> <span class='kw'>ps.fit</span><span class='op'>$</span><span class='kw'>fitted.values</span>

<span class='kw'>w1</span> <span class='op'>&lt;-</span> <span class='fu'>get_w_from_ps</span>(<span class='kw'>ps</span>, treat = <span class='kw'>lalonde</span><span class='op'>$</span><span class='kw'>treat</span>,
                    estimand = <span class='st'>"ATT"</span>)

<span class='kw'>treatAB</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='kw'>lalonde</span><span class='op'>$</span><span class='kw'>treat</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='st'>"A"</span>, <span class='st'>"B"</span>))
<span class='kw'>w2</span> <span class='op'>&lt;-</span> <span class='fu'>get_w_from_ps</span>(<span class='kw'>ps</span>, treat = <span class='kw'>treatAB</span>,
                    estimand = <span class='st'>"ATT"</span>, focal = <span class='st'>"A"</span>)
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(<span class='kw'>w1</span>, <span class='kw'>w2</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='kw'>w3</span> <span class='op'>&lt;-</span> <span class='fu'>get_w_from_ps</span>(<span class='kw'>ps</span>, treat = <span class='kw'>treatAB</span>,
                    estimand = <span class='st'>"ATT"</span>, treated = <span class='st'>"A"</span>)
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(<span class='kw'>w1</span>, <span class='kw'>w3</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'>#Using MMWS</span>
<span class='kw'>w4</span> <span class='op'>&lt;-</span> <span class='fu'>get_w_from_ps</span>(<span class='kw'>ps</span>, treat = <span class='kw'>lalonde</span><span class='op'>$</span><span class='kw'>treat</span>,
                    estimand = <span class='st'>"ATE"</span>, subclass = <span class='fl'>20</span>,
                    stabilize = <span class='fl'>TRUE</span>)

<span class='co'>#A multi-category example using GBM predicted probabilities</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'><a href='https://github.com/gbm-developers/gbm'>gbm</a></span>)</div><div class='output co'>#&gt; <span class='message'>Loaded gbm 2.1.8</span></div><div class='input'><span class='kw'>T3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"A"</span>, <span class='st'>"B"</span>, <span class='st'>"C"</span>), <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='kw'>lalonde</span>), replace = <span class='fl'>TRUE</span>))

<span class='kw'>gbm.fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/gbm/man/gbm.html'>gbm</a></span>(<span class='kw'>T3</span> <span class='op'>~</span> <span class='kw'>age</span> <span class='op'>+</span> <span class='kw'>educ</span> <span class='op'>+</span> <span class='kw'>race</span> <span class='op'>+</span> <span class='kw'>married</span> <span class='op'>+</span>
                 <span class='kw'>nodegree</span> <span class='op'>+</span> <span class='kw'>re74</span> <span class='op'>+</span> <span class='kw'>re75</span>, data = <span class='kw'>lalonde</span>,
               distribution = <span class='st'>"multinomial"</span>, n.trees = <span class='fl'>200</span>,
               interaction.depth = <span class='fl'>3</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: Setting `distribution = "multinomial"` is ill-advised as it is currently broken. It exists only for backwards compatibility. Use at your own risk.</span></div><div class='input'><span class='kw'>ps.multi</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/drop.html'>drop</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='kw'>gbm.fit</span>, type = <span class='st'>"response"</span>,
                         n.trees = <span class='fl'>200</span>))
<span class='kw'>w</span> <span class='op'>&lt;-</span> <span class='fu'>get_w_from_ps</span>(<span class='kw'>ps.multi</span>, <span class='kw'>T3</span>, estimand = <span class='st'>"ATE"</span>)
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


